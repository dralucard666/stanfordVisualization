"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[376],{27032:function(e,t,n){n.d(t,{w:function(){return i}});var r=n(77340);const i={index:{execute:e=>{var t;const n=e.raw.length>0?(e.raw[0]+e.index.length)%e.index.length:e.index.length-1,i=null!==(t=e.index[n])&&void 0!==t?t:0;return(0,r.of)([Object.assign(Object.assign({},e),{raw:i})])},includeThis:!1,defaultParameters:[]},id:{execute:e=>(0,r.of)([Object.assign(Object.assign({},e),{raw:e.index.join(",")})]),includeThis:!1,defaultParameters:[]},log:{execute:e=>(0,r.of)([Object.assign(Object.assign({},e),{raw:e.raw[0]})]),includeThis:!0,defaultParameters:[]},select:{execute:e=>{var t;const n=e.raw.length>0?(e.raw[0]+e.index.length)%e.index.length:e.index.length-1,i=null!==(t=e.index[n])&&void 0!==t?t:0,[o,a,s]=e.raw;return(0,r.of)(a<=i&&(null==s||i<s)?[Object.assign(Object.assign({},e),{raw:o})]:[])},includeThis:!0,defaultParameters:[()=>({type:"raw",value:1}),()=>({type:"raw",value:2})]},randomFloat:{execute:(0,n(16195).QV)(((e,t)=>(0,r.of)([e+(t-e)*Math.random()]))),includeThis:!1,defaultParameters:[()=>({type:"raw",value:0}),()=>({type:"raw",value:1})]}}},55050:function(e,t,n){n.d(t,{Js:function(){return ee},Yh:function(){return _},vk:function(){return H},WV:function(){return U},P:function(){return O},eT:function(){return k},QM:function(){return Re},pT:function(){return s},PP:function(){return we},Zj:function(){return ge},i7:function(){return R},Oz:function(){return me},XA:function(){return ye},dc:function(){return fe},ae:function(){return c},gN:function(){return u},Nh:function(){return l},Jy:function(){return Qe},Wq:function(){return Fe},jo:function(){return he},FP:function(){return ve}});var r=n(26173);new r.Box3,new r.Vector3,new r.Vector3;const i=new r.Matrix4,o=new r.Vector3,a=new r.Euler;function s(e,t,n=i){return o.crossVectors(e,t),n.makeBasis(e,t,o)}function l(e,t,n,r=i){return r.makeTranslation(e,t,n)}function c(e,t,n,r=i){return r.makeRotationFromEuler(a.set(e,t,n))}function u(e,t,n,r=i){return r.makeScale(e,t,n)}function p(e,t){let n=0;const r=Math.random()*t;for(let i=0;i<e.length;i++)if(n+=e[i],r<=n)return i;return e.length-1}function d(e,t){var n;const r=e.reduce(((e,t)=>e+t),0),i=[];for(let o=0;o<t;o++){const t=p(e,r);i[t]=(null!==(n=i[t])&&void 0!==n?n:0)+1}return i}function f(e,t,n){return n.a.fromBufferAttribute(t,3*e),n.b.fromBufferAttribute(t,3*e+1),n.c.fromBufferAttribute(t,3*e+2),n}function m(e,t){let n=Math.random(),r=Math.random();return n+r>1&&(n=1-n,r=1-r),t.set(0,0,0).addScaledVector(e.a,n).addScaledVector(e.b,r).addScaledVector(e.c,1-(n+r)),t}const h=new r.Triangle;function v(e,t){null!=e.index&&(e=e.toNonIndexed());const n=e.getAttribute("position"),i=d(new Array(n.count/3).fill(null).map(((e,t)=>f(t,n,h).getArea())),t),o=[];for(let a=0;a<i.length;a++){const e=i[a];if(null!=e){f(a,n,h);for(let t=0;t<e;t++)o.push(m(h,new r.Vector3))}}return o}var y=n(90766),g=n(21283);n(61135);new r.Matrix4;function x(e,t){return e[t]}function b(e,t,n){e[t]=n}function w(e){C.setFromRotationMatrix(e),j.set(0,1,0),j.applyQuaternion(C);const t=Math.abs(j.x),n=Math.abs(j.y),r=Math.abs(j.z),i=Math.max(t,n,r);return t===i?j.x<0?"west":"east":n===i?j.y<0?"down":"up":j.z<0?"south":"north"}const j=new r.Vector3,S=new r.Box3,M=new r.Vector3,E=new r.Box3;function O(e,t,n){e.getBoundingBox(S),M.copy(S.min);let r=0;const i=[];for(;x(S.min,t)<x(S.max,t);){const o=e.matrix.clone();o.multiply(l(S.min.x,S.min.y,S.min.z));const a=n(o,r,S.max.x-S.min.x,S.max.y-S.min.y,S.max.z-S.min.z);i.push(a),a.getBoundingBox(E),E.getSize(j),r++,b(S.min,t,x(S.min,t)+x(j,t))}return i}function N(e,t,n){let r=e[t];null==r&&(r=[],e[t]=r),r.push(n)}function P(e,t,n){let r=e.findIndex((e=>j.copy(e).sub(t).lengthSq()<n));return-1===r&&(r=e.length,e.push(t)),r}function Z(e,t,n,i,o){if(0===e.points.length)return[];const a=new Set;return e.connectionsList.reduce(((n,s,c)=>null==s?n:[...n,...s.map(((n,u)=>{const p=`${n}/${c}`,d=`${c}/${n}`;if(!a.has(p)&&!a.has(d))return a.add(p),function(e,t,n,i,o,a,s,c){const u=n[i],p=new r.Shape,d=new r.Matrix4,f=e.points[t],m=e.points[u];j.copy(m).sub(f).setY(0).normalize(),d.makeBasis(j,k,(new r.Vector3).crossVectors(j,k)),d.premultiply(l(f.x,f.y,f.z)),V.copy(d).invert(),Q(e,p,V,Array.isArray(o)?o[t]:o,f,m,s,i,n,!0);const h=e.connectionsList[u],v=null===h||void 0===h?void 0:h.indexOf(t);return Q(e,p,V,Array.isArray(o)?o[u]:o,m,f,s,v,h,!1),new ee(d,p,c)}(e,c,s,u,t,0,i,o)})).filter(g.Dm)]),[])}const V=new r.Matrix4,C=new r.Quaternion,z=new r.Vector3(1,0,0),k=new r.Vector3(0,1,0),D=new r.Vector3(0,0,1);const B=new r.Vector3,A=new r.Vector3,T=new r.Vector3,L=new r.Vector3,q=new r.Vector3,G=new r.Vector3;function Q(e,t,n,r,i,o,a,s,l,c){if(A.copy(i).applyMatrix4(n),null!=s&&null!=l&&l.length>1){L.copy(o).sub(i).normalize(),q.copy(e.points[l[(s+l.length-1)%l.length]]).sub(i).normalize(),B.copy(L).add(q).normalize().multiplyScalar(r),2===l.length?(G.copy(q),T.copy(B)):(G.copy(e.points[l[(s+1)%l.length]]).sub(i).normalize(),T.copy(L).add(G).normalize().multiplyScalar(r)),j.crossVectors(L,a);j.dot(q)>=0||B.multiplyScalar(-1);j.dot(G)>=0&&T.multiplyScalar(-1)}else B.copy(o).sub(i).cross(a).normalize().multiplyScalar(r),T.copy(B).multiplyScalar(-1);B.add(i).applyMatrix4(n),T.add(i).applyMatrix4(n),c?t.moveTo(B.x,B.z):t.lineTo(B.x,B.z),t.lineTo(A.x,A.z),t.lineTo(T.x,T.z)}function I(e,t,n,r){B.copy(t).sub(e),A.copy(n).sub(e);const i=T.crossVectors(B,r).dot(A)<0;B.projectOnPlane(r),A.projectOnPlane(r);const o=B.angleTo(A);return i?o:2*Math.PI-o}function R(e){return t=>{switch(t){case W.Point:return new r.PointsMaterial({size:3e-8,toneMapped:!1,color:e});case W.Line:return new r.LineBasicMaterial({toneMapped:!1,color:e});case W.Mesh:return new r.MeshPhongMaterial({toneMapped:!1,color:e})}}}const $=new r.Matrix4,Y=new r.Vector3,X=new r.Quaternion;function F(e,t){return e.matrixAutoUpdate=!1,e.matrix=t,e.updateMatrixWorld(!0),e}var W;!function(e){e[e.Point=0]="Point",e[e.Line=1]="Line",e[e.Mesh=2]="Mesh"}(W||(W={}));class U{constructor(){this.geometryCache=null,this.objectCache=null,this.outlineCache=null}getGeometry(){return null===this.geometryCache&&(this.geometryCache=this.computeGeometry()),this.geometryCache}getOutline(){return null==this.outlineCache&&(this.outlineCache=this.computeOutline()),this.outlineCache}getObject(){return null==this.objectCache&&(this.objectCache=this.computeObject3D()),this.objectCache}dispose(){var e;null===(e=this.geometryCache)||void 0===e||e.dispose()}multiplyMatrix(e){return this.changeMatrix(this.matrix.clone().multiply(e))}premultiplyMatrix(e){return this.changeMatrix(this.matrix.clone().premultiply(e))}}class H extends U{changeMaterialGenerator(e){return new H(this.matrix,e)}changeMatrix(e){return new H(e,this.materialGenerator)}multiplyMatrix(e){return new H(this.matrix.clone().multiply(e),this.materialGenerator)}constructor(e,t){super(),this.matrix=e,this.materialGenerator=t}getBoundingBox(e){e.min.set(0,0,0),e.max.set(0,0,0)}getVertecies(){return[new r.Vector3]}extrude(e){return _.fromPoints(this.matrix.clone(),new r.Vector3(0,0,0),new r.Vector3(0,e,0),this.materialGenerator)}components(e){return"points"===e?[this.clone()]:[]}computeObject3D(){return F(new r.Points((new r.BufferGeometry).setFromPoints([new r.Vector3]),this.materialGenerator(W.Point)),this.matrix)}computeOutline(){const e=new r.Points((new r.BufferGeometry).setFromPoints([new r.Vector3]),new r.PointsMaterial({color:0,size:3e-8,transparent:!0,depthTest:!1}));return e.renderOrder=1e3,F(e,this.matrix)}clone(){return new H(this.matrix,this.materialGenerator)}computeGeometry(){}expand(e,t,n){throw new Error("Method not implemented.")}getSize(e){return 0===e?1:0}samplePoints(e){return new Array(e).fill(null).map((()=>this.clone()))}}class _ extends U{changeMaterialGenerator(e){return new _(this.matrix,this.length,e)}getStart(){return new r.Vector3(0,0,0).applyMatrix4(this.matrix)}getEnd(){return new r.Vector3(this.length,0,0).applyMatrix4(this.matrix)}changeMatrix(e){return new _(e,this.length,this.materialGenerator)}constructor(e,t,n){super(),this.matrix=e,this.length=t,this.materialGenerator=n}getVertecies(){return[new r.Vector3,new r.Vector3(this.length,0,0)]}static fromPoints(e,t,n,r){e.multiply(l(t.x,t.y,t.z)),Y.copy(n).sub(t);const i=Y.length();return X.setFromUnitVectors(z,Y.divideScalar(i)),$.makeRotationFromQuaternion(X),e.multiply($),new _(e,i,r)}getBoundingBox(e){e.min.set(0,0,0),e.max.set(this.length,0,0)}clone(){return new _(this.matrix,this.length,this.materialGenerator)}extrude(e){return ee.fromLengthAndHeight(this.matrix.clone(),this.length,e,k,this.materialGenerator)}components(e){switch(e){case"faces":return[];case"lines":return[this.clone()];case"points":{const e=new H(this.matrix.clone().multiply($.makeTranslation(this.length,0,0)),this.materialGenerator);return[new H(this.matrix,this.materialGenerator),e]}}}computeObject3D(){return F(new r.Line((new r.BufferGeometry).setFromPoints([new r.Vector3,new r.Vector3(this.length,0,0)]),this.materialGenerator(W.Line)),this.matrix)}computeOutline(){const e=new r.Line((new r.BufferGeometry).setFromPoints([new r.Vector3,new r.Vector3(this.length,0,0)]),new r.LineBasicMaterial({color:0}));return e.renderOrder=1e3,F(e,this.matrix)}computeGeometry(){}getSize(e){return 1===e?this.length:0}samplePoints(e){return new Array(e).fill(null).map((()=>new H(this.matrix.clone().multiply($.makeTranslation(Math.random()*this.length,0,0)),this.materialGenerator)))}}const J=new r.Box2,K=(new r.Vector2,new r.Matrix4);class ee extends U{changeMaterialGenerator(e){return new ee(this.matrix,this.shape,e)}changeMatrix(e){return new ee(e,this.shape,this.materialGenerator)}getVertecies(){return this.shape.getPoints().map((({x:e,y:t})=>new r.Vector3(e,0,t)))}constructor(e,t,n){super(),this.matrix=e,this.shape=t,this.materialGenerator=n}static fromLengthAndHeight(e,t,n,i,o){const a=[new r.Vector2(t,0),new r.Vector2(t,n),new r.Vector2(0,n),new r.Vector2(0,0)],s=new r.Shape(a);return X.setFromUnitVectors(D,i),$.makeRotationFromQuaternion(X),e.multiply($),new ee(e,s,o)}getBoundingBox(e){J.setFromPoints(this.shape.getPoints()),e.min.set(J.min.x,0,J.min.y),e.max.set(J.max.x,0,J.max.y)}computeGeometry(){const e=new r.ShapeBufferGeometry(this.shape);return function(e){let t;for(let n=0;n<e.index.count;n+=3)t=e.index.getX(n),e.index.setX(n,e.index.getX(n+2)),e.index.setX(n+2,t)}(e),te(e),e}invert(){const e=this.matrix.clone();e.multiply(c(Math.PI,0,0));const t=this.shape.getPoints(5),n=this.shape.holes,i=new r.Shape(t.map((({x:e,y:t})=>new r.Vector2(e,-t))));return i.holes=n.map((e=>new r.Path(e.getPoints().map((({x:e,y:t})=>new r.Vector2(e,-t)))))),new ee(e,i,this.materialGenerator)}extrude(e){K.copy(this.matrix).invert();const t=this.multiplyMatrix(K.multiply(l(0,e,0))),n=this.shape.getPoints(5);return new le(this.matrix,[...n.map(((t,i)=>{const o=n[(i+1)%n.length];Y.set(o.x-t.x,0,o.y-t.y);const a=Y.length(),c=l(t.x,0,t.y,new r.Matrix4);c.multiply(s(Y.normalize(),k));const u=ee.fromLengthAndHeight(c,a,e,k,this.materialGenerator);return e<0?u.invert():u})),t])}components(e){switch(e){case"points":return this.shape.extractPoints(5).shape.map((e=>new H(this.matrix.clone().multiply(l(e.x,0,e.y)),this.materialGenerator)));case"lines":{const e=this.shape.extractPoints(5).shape;return e.map(((t,n)=>{const i=e[(n+1)%e.length];return _.fromPoints(this.matrix.clone(),new r.Vector3(t.x,0,t.y),new r.Vector3(i.x,0,i.y),this.materialGenerator)}))}case"faces":return[this]}}computeObject3D(){return F(new r.Mesh(this.getGeometry(),this.materialGenerator(W.Mesh)),this.matrix)}computeOutline(){const e=this.pathToOutline(this.shape.extractPoints(5).shape),t=this.shape.holes.map((e=>this.pathToOutline(e.getPoints(5)))),n=F(new r.Object3D,this.matrix);return n.renderOrder=1e3,n.add(e,...t),n}pathToOutline(e){if(0===e.length)return new r.Object3D;e.push(e[0]);const t=(new r.BufferGeometry).setFromPoints(e);return te(t),new r.Line(t,new r.MeshBasicMaterial({color:0,transparent:!0}))}expand(e,t,n){throw new Error("not implemented")}getSize(e){if(2===e){const e=r.ShapeUtils.area(this.shape.getPoints(5));return this.shape.holes.reduce(((e,t)=>e-r.ShapeUtils.area(t.getPoints(5))),e)}return 0}samplePoints(e){const t=this.getGeometry();return null==t?[]:v(t,e).map((e=>new H(this.matrix.clone().multiply(l(e.x,e.y,e.z)),this.materialGenerator)))}}function te(e){let t;const n=e.getAttribute("position");for(let r=0;r<n.count;r++)t=n.getY(r),n.setY(r,n.getZ(r)),n.setZ(r,t)}const ne=new r.Box3,re=new r.BoxBufferGeometry(1,1,1),ie=new r.EdgesGeometry(re);class oe extends U{get materialGenerator(){throw new Error("Method not implemented.")}changeMaterialGenerator(e){return this}getVertecies(){throw new Error("Method not implemented.")}changeMatrix(e){return new oe(e,this.object)}constructor(e,t){super(),this.matrix=e,this.object=t,this.computeObject3D()}extrude(e){throw new Error("Method not implemented.")}components(e){throw new Error("Method not implemented.")}computeObject3D(){const e=new r.Object3D;return e.add(this.object),F(e,this.matrix)}computeGeometry(){}getBoundingBox(e){ae(this.object,e)}computeOutline(){this.getBoundingBox(ne),ne.getCenter(Y);const e=new r.LineSegments(ie,new r.LineBasicMaterial({color:0}));return e.matrix.copy(this.matrix).multiply(l(Y.x,Y.y,Y.z)),ne.getSize(Y),e.matrix.multiply(u(Y.x,Y.y,Y.z)),e.renderOrder=1e3,e}expand(e,t,n){throw new Error("Method not implemented.")}getSize(e){throw new Error("Method not implemented.")}samplePoints(e){throw new Error("Method not implemented.")}}function ae(e,t){t=null!==t&&void 0!==t?t:new r.Box3,e instanceof r.Mesh?(e.geometry.computeBoundingBox(),t.copy(e.geometry.boundingBox)):t.makeEmpty();for(const n of e.children){if(0===n.children.length&&!(n instanceof r.Mesh))continue;const e=ae(n).applyMatrix4(n.matrix);t.union(e)}return t}class se extends U{changeMaterialGenerator(e){return new se(this.matrix,this.geometry,e)}changeMatrix(e){return new se(e,this.geometry,this.materialGenerator)}constructor(e,t,n){super(),this.matrix=e,this.geometry=t,this.materialGenerator=n,t.computeBoundingBox()}extrude(e){throw new Error("Method not implemented.")}components(e){throw new Error("Method not implemented.")}computeObject3D(){return F(new r.Mesh(this.getGeometry(),this.materialGenerator(W.Mesh)),this.matrix)}getVertecies(){throw new Error("Method not implemented.")}getBoundingBox(e){e.copy(this.geometry.boundingBox)}computeGeometry(){return this.geometry}computeOutline(){const e=new r.LineSegments(new r.EdgesGeometry(this.geometry),new r.LineBasicMaterial({color:0}));return F(e,this.matrix),e.renderOrder=1e3,e}expand(e,t,n){throw new Error("Method not implemented.")}getSize(e){throw new Error("Method not implemented.")}samplePoints(e){const t=this.getGeometry();return null==t?[]:v(t,e).map((e=>new H(this.matrix.clone().multiply(l(e.x,e.y,e.z)),this.materialGenerator)))}}class le extends U{changeMaterialGenerator(e){return new le(this.matrix,this.primitives.map((t=>t.changeMaterialGenerator(e))))}get materialGenerator(){return this.primitives[0].materialGenerator}changeMatrix(e){return new le(e,this.primitives)}constructor(e,t){super(),this.matrix=e,this.primitives=t}getVertecies(){return this.primitives.reduce(((e,t)=>e.concat(t.getVertecies().map((e=>e.applyMatrix4(t.matrix))))),[])}extrude(e){return new le(this.matrix,this.primitives.map((t=>t.extrude(e))))}components(e){const t=this.primitives.map((t=>t.components(e))).reduce(((e,t)=>e.concat(t)));return t.map((e=>e.premultiplyMatrix(this.matrix)))}computeObject3D(){const e=F(new r.Object3D,this.matrix);return this.primitives.forEach((t=>e.add(t.getObject()))),e}getBoundingBox(e){e.makeEmpty(),this.primitives.forEach((t=>{t.getBoundingBox(ne),ne.applyMatrix4(t.matrix),e.union(ne)}))}computeGeometry(){const e=this.primitives.map((e=>{var t;return null===(t=e.getGeometry())||void 0===t?void 0:t.applyMatrix4(e.matrix)})).filter(g.Dm),t=(0,y.qf)(e);return e.forEach((e=>e.dispose())),t}computeOutline(){const e=F(new r.Object3D,this.matrix);return this.primitives.forEach((t=>e.add(t.getOutline()))),e.renderOrder=1e3,e}getSize(e){return this.primitives.reduce(((t,n)=>n.getSize(e)+t),0)}samplePoints(e){const t=d(this.primitives.map((e=>e.getSize(2))),e),n=[];for(let r=0;r<t.length;r++){const e=t[r];null!=e&&n.push(...this.primitives[r].samplePoints(e))}return n}}var ce=n(7587),ue=n(58882),pe=n.n(ue),de=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{l(r.next(e))}catch(t){o(t)}}function s(e){try{l(r.throw(e))}catch(t){o(t)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}l((r=r.apply(e,t||[])).next())}))};function fe(e,t){return(e+180)/360*Math.pow(2,t)}function me(e,t){return(1-Math.log(Math.tan(e*Math.PI/180)+1/Math.cos(e*Math.PI/180))/Math.PI)/2*Math.pow(2,t)}function he(e,t,n=256){const r=function(e,t){const n=Math.PI-2*Math.PI*e/Math.pow(2,t);return 180/Math.PI*Math.atan(.5*(Math.exp(n)-Math.exp(-n)))}(e,t);return 156543.03*Math.cos(r*Math.PI/180)/Math.pow(2,t)*n}function ve(e,t){return Math.pow(2,t)/Math.pow(2,e)}function ye(e,t,n,r=256){return de(this,void 0,void 0,(function*(){const i=he(t,n,r),o=yield fetch(e),a=yield o.arrayBuffer(),s=new ce.VectorTile(new(pe())(a));return Object.entries(s.layers).reduce(((e,[t,n])=>{const r=i/n.extent;return Object.assign(Object.assign({},e),{[t]:new Array(n.length).fill(null).map(((e,t)=>{const i=n.feature(t),o=i.loadGeometry().map((e=>{const t=new Array(e.length);for(let n=0;n<e.length;n++){const{x:i,y:o}=e[n];t[n]={x:i*r,y:o*r}}return t})).filter((e=>e.length>0));return{properties:i.properties,geometry:o}}))})}),{})}))}function ge(e,t,n,r){return e.road.filter((e=>"street"===e.properties.class)).map((e=>{const t=e.geometry.reduce(((e,t)=>{const i=function(e,t,n){const r=e.slice(0,-1).map(((r,i)=>{let o=e[(i+1)%e.length];switch(t){case"include":break;case"exclude":if(!Se(r.x,r.y,n)||!Se(o.x,o.y,n))return;break;case"clip":{const e=function(e,t,n,r,i,o,a,s){const l=(r-t)/(n-e),c=t-l*e,u=xe(l,c,e,t,i,o,a,s),p=xe(l,c,n,r,i,o,a,s);if(null==u||null==p)return;return{start:u,end:p}}(r.x,r.y,o.x,o.y,0,0,n,n);if(null==e)return;r=e.start,o=e.end}}return{type:"operation",identifier:"line",children:[r,o].map((({x:e,y:t})=>({type:"operation",identifier:"point2",children:[{type:"raw",value:e},{type:"raw",value:t}]})))}})).filter(g.Dm);if(0===r.length)return;return r}(t,n,r);return null==i?e:e.concat(i)}),[]);return 1===t.length?t[0]:{type:"parallel",children:t}}),[]).filter(g.Dm).map(((e,n)=>({name:`Road${n+1}${t}`,step:e})))}function xe(e,t,n,r,i,o,a,s){if(je(n,r,i,o,a,s))return{x:n,y:r};const l=be(r,o,s),c=function(e,t,n){return(e-n)/t}(l,e,t);if(je(c,l,i,o,a,s))return{x:c,y:l};const u=be(n,i,a),p=function(e,t,n){return e*t+n}(u,e,t);return je(u,p,i,o,a,s)?{x:u,y:p}:void 0}function be(e,t,n){return Math.max(Math.min(e,n),t)}function we(e,t,n,r){return e.building.map((e=>{const t=e.geometry.map((e=>function(e,t,n){const r=new Array(e.length-1);for(let i=0;i<e.length-1;i++){const{x:o,y:a}=e[i];if("exclude"===t&&!Se(o,a,n))return;r[i]={type:"operation",identifier:"point2",children:[{type:"raw",value:o},{type:"raw",value:a}]}}return{type:"operation",identifier:"face",children:r}}(e,n,r))).filter(g.Dm);if(0!==t.length)return 1===t.length?t[0]:{type:"parallel",children:t}})).filter(g.Dm).map(((e,n)=>({name:`Building${n+1}${t}`,step:e})))}function je(e,t,n,r,i,o){return n<=e&&r<=t&&e<=i&&t<=o}function Se(e,t,n){return 0<e&&0<t&&e<n&&t<n}var Me=n(77340),Ee=n(18816),Oe=n(80598),Ne=n(82513),Pe=n(27032),Ze=n(68569),Ve=n(41771);class Ce extends r.ExtrudeGeometry{constructor(e,t,n){super(new r.Shape([new r.Vector2(0,0),new r.Vector2(e/2,t),new r.Vector2(e,0)]),{depth:n,bevelEnabled:!1})}}const ze=new r.Box3,ke=new r.Vector3;r.Cache.enabled=!0;const De=new Ze.E,Be=new Ve._;Be.setDecoderPath("/cgv/"),De.setDRACOLoader(Be);const Ae=new r.Vector3;const Te=new r.Vector3,Le=new r.Box3;function qe(e){return Math.PI*e/180}function Ge(e,...t){const n=t.reduce(((t,n)=>[...t,...n.components(e)]),[]);return(0,Me.of)(n)}const Qe=Object.assign(Object.assign({},Pe.w),{translate:{execute:(0,Ne.QV)((function(e,t,n,r){return(0,Me.of)([e.multiplyMatrix(l(t,n,r))])})),includeThis:!0,defaultParameters:[()=>({type:"raw",value:0}),()=>({type:"raw",value:0}),()=>({type:"raw",value:0})]},scale:{execute:(0,Ne.QV)((function(e,t,n,r){return(0,Me.of)([e.multiplyMatrix(u(t,n,r))])})),includeThis:!0,defaultParameters:[()=>({type:"raw",value:1}),()=>({type:"raw",value:1}),()=>({type:"raw",value:1})]},rotate:{execute:(0,Ne.QV)((function(e,t,n,r){return(0,Me.of)([e.multiplyMatrix(c(qe(t),qe(n),qe(r)))])})),includeThis:!0,defaultParameters:[()=>({type:"raw",value:0}),()=>({type:"raw",value:0}),()=>({type:"raw",value:0})]},extrude:{execute:(0,Ne.QV)((function(e,t){return(0,Me.of)([e.extrude(t)])})),includeThis:!0,defaultParameters:[()=>({type:"raw",value:1})]},split:{execute:(0,Ne.QV)((function(e,t,n,...r){if(0===r.length)return(0,Me.of)([e]);const i=O(e,t,((i,o,a,s,l)=>{const c=Math.floor(o/r.length),u=r[o%r.length];if(!1===n&&0==c||!0===n||c<n){const n="x"===t?Math.min(u,a):a,r="z"===t?Math.min(u,l):l;return ee.fromLengthAndHeight(i,n,r,D,e.materialGenerator)}return ee.fromLengthAndHeight(i,a,l,D,e.materialGenerator)}));return(0,Me.of)(i)})),includeThis:!0,defaultParameters:[()=>({type:"raw",value:"x"}),()=>({type:"raw",value:!0}),()=>({type:"raw",value:1})]},toPoints:{execute:(0,Ne.QV)(Ge.bind(null,"points")),includeThis:!0,defaultParameters:[]},toLines:{execute:(0,Ne.QV)(Ge.bind(null,"lines")),includeThis:!0,defaultParameters:[]},toFaces:{execute:(0,Ne.QV)(Ge.bind(null,"faces")),includeThis:!0,defaultParameters:[]},sample:{execute:(0,Ne.QV)((function(e,t){return(0,Me.of)(e.samplePoints(t))})),includeThis:!0,defaultParameters:[()=>({type:"raw",value:10})]},color:{execute:(0,Ne.QV)((function(e,t){return(0,Me.of)([e.changeMaterialGenerator(R(t))])})),includeThis:!0,defaultParameters:[()=>({type:"raw",value:"#ff0000"})]},size:{execute:(0,Ne.QV)((function(e,t){return e.getBoundingBox(Le),Le.getSize(Te),(0,Me.of)([Te[t]])})),includeThis:!0,defaultParameters:[()=>({type:"raw",value:"x"})]},expandGraph:{execute:(0,Ne.QV)((function(e,t,...n){return(0,Me.of)(Z(function(e,t,n){const r=n*n,i=[],o=[];for(const[a,s]of e){const e=P(i,a,r),t=P(i,s,r);N(o,e,t),N(o,t,e)}for(let a=0;a<o.length;a++){const e=o[a],n=e.slice(1).map((n=>({index:n,angle:I(i[a],i[e[0]],i[n],t)}))).sort(((e,t)=>e.angle-t.angle));o[a]=[e[0],...n.map((({index:e})=>e))]}return{connectionsList:o,points:i}}(n.map((e=>[e.getStart(),e.getEnd()])),k,t),t,0,k,e.materialGenerator))})),includeThis:!0,defaultParameters:[()=>({type:"raw",value:3})]},load:{execute:(0,Ne.QV)((function(e,t){return(0,Ee.D)(De.loadAsync(t)).pipe((0,Oe.U)((t=>[new oe(e.matrix,t.scene)])))})),includeThis:!0,defaultParameters:[]},point3:{execute:(0,Ne.QV)((function(e,t,n,i){const o=R(new r.Color(16711680));return(0,Me.of)([new H(l(t,n,i,e.matrix.clone()),o)])})),includeThis:!0,defaultParameters:[()=>({type:"raw",value:0}),()=>({type:"raw",value:0}),()=>({type:"raw",value:0})]},point2:{execute:(0,Ne.QV)((function(e,t,n){const i=R(new r.Color(16711680));return(0,Me.of)([new H(l(t,0,n,e.matrix.clone()),i)])})),includeThis:!0,defaultParameters:[()=>({type:"raw",value:0}),()=>({type:"raw",value:0})]},line:{execute:(0,Ne.QV)((function(e,...t){if(t.length<2)return(0,Me.of)([e]);const[n,i]=t.map((e=>(new r.Vector3).setFromMatrixPosition(e.matrix))),o=R(new r.Color(16711680));return(0,Me.of)([_.fromPoints(e.matrix.clone(),n,i,o)])})),includeThis:!0,defaultParameters:[()=>({type:"operation",identifier:"point3",children:[{type:"raw",value:0},{type:"raw",value:0},{type:"raw",value:0}]}),()=>({type:"operation",identifier:"point3",children:[{type:"raw",value:1},{type:"raw",value:0},{type:"raw",value:0}]})]},face:{execute:(0,Ne.QV)((function(e,...t){if(t.length<3)return(0,Me.of)([e]);const n=t.map((e=>(Ae.setFromMatrixPosition(e.matrix),new r.Vector2(Ae.x,Ae.z))));r.ShapeUtils.isClockWise(n)&&n.reverse();const i=R(new r.Color(16711680));return(0,Me.of)([new ee(e.matrix,new r.Shape(n),i)])})),includeThis:!0,defaultParameters:[]},gableRoof:{execute:(0,Ne.QV)((function(e,t,n,r,i){const o=null==t?0:Math.PI*t/180,a=c(0,-o,0);ze.setFromPoints(e.getVertecies().map((e=>e.applyMatrix4(a)))),ze.getSize(ke);const s=new Ce(null!==n&&void 0!==n?n:ke.x,null!==r&&void 0!==r?r:ke.y,null!==i&&void 0!==i?i:ke.z);return s.translate(ze.min.x,ze.min.y,ze.min.z),s.computeBoundingBox(),s.rotateY(o),(0,Me.of)([new se(e.matrix,s,e.materialGenerator)])})),includeThis:!0,defaultParameters:[()=>({type:"raw",value:0})]},direction:{execute:(0,Ne.QV)((function(e){return(0,Me.of)([w(e.matrix)])})),includeThis:!0,defaultParameters:[]}});var Ie=n(16195);function Re(e,t,n,r){const i=new Map;return e.pipe((0,Ie.TH)()).subscribe({next:e=>{const r=e.index.join(",");if(e.type===Ie.u4.SET){const o=n(e.value);t.add(o),i.set(r,o)}else{const e=i.get(r);null!=e&&(i.delete(r),t.remove(e))}},error:e=>{r(e)}})}var $e=n(91e3);const Ye=e=>w(e.raw.matrix),Xe={generateMatching:(e,t)=>(0,$e.YI)((e=>`where direction is one of ${e.join(", ")}`),e,t,Ye,(e=>({type:"equal",children:[{type:"operation",children:[],identifier:"direction"},{type:"raw",value:Ye(e)}]})),(n=>(0,$e.oc)(e,t,n))),generateContaining:(e,t)=>(0,$e.YI)((e=>`where direction is one of ${e.join(", ")}`),e,t,Ye,(e=>({type:"equal",children:[{type:"operation",children:[],identifier:"direction"},{type:"raw",value:Ye(e)}]})))},Fe=[$e.Ao,$e.TO,$e.au,$e.W9,Xe,$e.z$,$e.Ug]},91e3:function(e,t,n){n.d(t,{Ao:function(){return f},O$:function(){return B},Q:function(){return z},YI:function(){return O},EU:function(){return $},o9:function(){return ie},bp:function(){return L},Db:function(){return T},Eo:function(){return re},TY:function(){return M},Ik:function(){return o},_P:function(){return k},MG:function(){return a},zq:function(){return V},Il:function(){return C},gK:function(){return i},z$:function(){return S},au:function(){return j},TO:function(){return h},Ug:function(){return y},W9:function(){return w},$T:function(){return G},oc:function(){return E},im:function(){return K},tc:function(){return I},lG:function(){return Y},gx:function(){return U},qC:function(){return R}});var r=n(21283);function i(e,t){return"symbol"===e.type?(0,r.nH)(e.identifier,t):"operation"===e.type?e.identifier:"raw"===e.type?e.value.toString():e.type}const o=r.nH;function a(e,t){return"string"===typeof e?o(e,t):i(e,t)}var s=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{l(r.next(e))}catch(t){o(t)}}function s(e){try{l(r.throw(e))}catch(t){o(t)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}l((r=r.apply(e,t||[])).next())}))};const l=e=>e.index[e.index.length-1],c=(e,t)=>l(e)%t;function u(e,t,n,r){return O((e=>`in every set of ${n} select index ${e.join(", ")}`),e,t,(e=>c(e,n)),(e=>((e,t)=>({type:"equal",children:[{type:"modulo",children:[{type:"operation",children:[],identifier:"index"},{type:"raw",value:t}]},{type:"raw",value:c(e,t)}]}))(e,n)),r)}function p(e){return e.map(l).filter(((e,t,n)=>n.indexOf(e)===t)).sort(((e,t)=>e-t))}const d=()=>({description:"everything",isSelected:()=>!0,generateStep:void 0}),f={generateContaining:d,generateMatching:d};function m(e,...t){const n=t.filter(r.Dm);let i;for(const r of n)(null==i||e(r,i))&&(i=r);return i}const h={generateMatching:(e,t)=>{const n=p(t),r=n[0]+1,i=n[1]-n[0];return m(((e,t)=>e.keySize<t.keySize),u(e,t,r,(n=>E(e,t,n))),n.length>=2?u(e,t,i,(n=>E(e,t,n))):void 0)},generateContaining:(e,t)=>{const n=p(t),r=n[0]+1,i=n[1]-n[0];return m(((e,t)=>e.selectionSize<t.selectionSize),u(e,t,r),n.length>=2?u(e,t,i):void 0)}},v=e=>e.index.join(","),y={generateMatching:(e,t)=>O((e=>`where index is one of ${e.join(", ")}`),e,t,l,(e=>({type:"equal",children:[{type:"operation",children:[],identifier:"index"},{type:"raw",value:l(e)}]})),(n=>E(e,t,n))),generateContaining:(e,t)=>O((e=>`where index is one of ${e.join(", ")}`),e,t,l,(e=>({type:"equal",children:[{type:"operation",children:[],identifier:"index"},{type:"raw",value:l(e)}]})))};function g(e,t,n,r){return{description:t(r),isSelected:t=>e(r,l(t)),generateStep:()=>({type:n,children:[{type:"operation",children:[],identifier:"index"},{type:"raw",value:r}]})}}const x=g.bind(null,((e,t)=>t>e),(e=>`where index > ${e}`),"greater"),b=g.bind(null,((e,t)=>t<e),(e=>`where index < ${e}`),"smaller"),w={generateMatching:(e,t)=>{const n=Math.max(...t.map(l))+1,r=e.filter((e=>l(e)<n));if(r.length!==e.length&&E(e,t,r))return b(n)},generateContaining:(e,t)=>{const n=Math.max(...t.map(l))+1;return b(n)}},j={generateMatching:(e,t)=>{const n=Math.min(...t.map(l))-1,r=e.filter((e=>l(e)>n));if(r.length!==e.length&&E(e,t,r))return x(n)},generateContaining:(e,t)=>{const n=Math.min(...t.map(l))-1;return x(n)}},S={generateMatching:(e,t)=>O((e=>"exactly and only my selection"),e,t,v,(e=>({type:"equal",children:[{type:"operation",children:[],identifier:"id"},{type:"raw",value:e.index.join(",")}]})),(n=>E(e,t,n))),generateContaining:()=>{}};function M(e,t,n,i){return s(this,void 0,void 0,(function*(){if(t.length===e.length)return;const o=n.map((n=>n.generateMatching(e,t))).filter(r.Dm);if(0===o.length)throw new Error("no pattern found (missing the allPatternType?)");return function(e){for(const t of e)if(null!=t.generateStep)return!1;return!0}(o)?void 0:i(o)}))}function E(e,t,n){if(n.length!==t.length)return!1;for(const r of t)if(!n.includes(r))return!1;return!0}function O(e,t,n,r,i,o){const a=new Map;for(const c of n){const e=r(c);a.has(e)||a.set(e,c)}const s=Array.from(a.keys()),l=t.filter((e=>s.includes(r(e))));if(l.length!==t.length&&0!==a.size&&(null==o||o(l)))return{description:e(s),isSelected:e=>a.has(r(e)),generateStep:()=>Array.from(a.values()).map((e=>i(e))).reduce(((e,t)=>({type:"or",children:[e,t]}))),keySize:a.size,selectionSize:l.length}}var N=n(65201),P=n(82513),Z=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{l(r.next(e))}catch(t){o(t)}}function s(e){try{l(r.throw(e))}catch(t){o(t)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}l((r=r.apply(e,t||[])).next())}))};function V(e){return"string"===typeof e?e:e.path.join(",")}function C(e){return"string"===typeof e?[e]:e.path}function z(e,t,n){return"string"===typeof e?"string"===typeof t&&e===t:V(e)===(null!==n&&void 0!==n?n:V(t))}function k(e,t,n,i,o){return t.map((t=>{var r;const a=V(t),s=null!==(r=e[a])&&void 0!==r?r:[],l=s.filter((e=>null!=n.find((t=>i(t,e)&&(null==o||o(e))))));if(!(0===l.length&&s.length>0))return{steps:t,values:l,generatePatternCondition:void 0}})).filter(r.Dm)}function D(e,t){if("string"===typeof e){const n=[];for(const{step:r}of t)X(r,e,(e=>n.push(e)));return n}if(e.path.length>1){const n=(0,r.D1)(t,e.path);return null==n?[]:[(0,r.SO)(n,e.path.length-2)]}return[e.path[0]]}function B(e,t,n,i,o){var a;return Z(this,void 0,void 0,(function*(){const l=V(n.steps),c=null!==(a=t[l])&&void 0!==a?a:[];if(0===c.length)return e;const u=yield function(e,t,n,i){return s(this,void 0,void 0,(function*(){if(t.length===e.length)return;const o=n.map((n=>n.generateContaining(e,t))).filter(r.Dm);if(0===o.length)throw new Error("no pattern found (missing the allPatternType?)");return i(o)}))}(c.map((({after:e})=>e)),n.values.map((({after:e})=>e)),i,o);return(0,N.vV)(e.map((e=>e===n?Object.assign(Object.assign({},n),{generatePatternCondition:u.generateStep,values:c.filter((({after:e})=>u.isSelected(e)))}):e)))}))}function A(e,t,n,i,o){var a;const s=V(n),l=t.findIndex((e=>z(e.steps,n,s))),c=null!==(a=e[s])&&void 0!==a?a:[];if(-1===l){if("remove"===o)return;return void t.push({steps:n,values:null==i?c:i})}const u=t[l];if(u.generatePatternCondition=void 0,null!=i){for(const e of i){const t=u.values.findIndex((t=>(0,r.Up)(t.after.index,e.after.index)===r.J.Equal));-1!==t||"toggle"!==o&&"add"!==o||u.values.push(e),-1===t||"toggle"!==o&&"remove"!==o||u.values.splice(t,1)}0===u.values.length&&t.splice(l,1)}else"toggle"===o||"remove"===o?t.splice(l,1):u.values=c}function T(e,t,n,r){return(0,N.ZP)("replace"===r?[]:t,(t=>{for(const{steps:i,values:o}of n)A(e,t,i,o,"replace"===r?"add":r)}))}function L(e,t,n,i,o){return(0,N.ZP)({hovered:n,valueMap:e,selectionsList:t},(e=>{for(const{value:a,steps:s}of i){const{valueMap:i,selectionsList:l,hovered:c}=e,u=s.path.join(","),p=t.findIndex((e=>V(e.steps)===u)),d=l[p];let f=i[u];if(!o){if(null==f)return;const t=f.findIndex((e=>(0,r.Up)(e.after.index,a.after.index)===r.J.Equal));if(f.splice(t,1),null!=d){const e=d.values.findIndex((e=>(0,r.Up)(e.after.index,a.after.index)===r.J.Equal));d.values.splice(e,1),0===d.values.length&&l.splice(p,1)}if((null===n||void 0===n?void 0:n.steps)===s&&null!=c){const t=c.values.findIndex((e=>(0,r.Up)(e.after.index,a.after.index)===r.J.Equal));c.values.splice(t,1),0===c.values.length&&(e.hovered=void 0)}}null==f&&(f=[],i[u]=f),null!=d&&f.length===d.values.length&&d.values.push(a),f.push(a)}}))}var q=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{l(r.next(e))}catch(t){o(t)}}function s(e){try{l(r.throw(e))}catch(t){o(t)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}l((r=r.apply(e,t||[])).next())}))};function G(e,t,n,i,o,a,s){return q(this,void 0,void 0,(function*(){const l=yield(0,N.ZP)({grammar:s,selectionsList:[]},(({grammar:l,selectionsList:c})=>q(this,void 0,void 0,(function*(){var u,p;const d="parallel"===o?"parallel":"sequential";for(const{values:f,steps:m,generatePatternCondition:h}of t){const t="after"===o?[C(m)]:W(m,s);for(const s of t){const t=s.join(","),m=null!==(u=e[t])&&void 0!==u?u:[];if(m.length>0&&0===f.length)return;const v=(0,P.D1)(l,s);if(null==v)continue;const y=a(s),g="parallel"===d?{type:"null"}:{type:"this"},x="parallel"===o?"before":o,b=null!==h&&void 0!==h?h:null===(p=yield(0,P.TY)(m.map((e=>e[x])),f.map((e=>e[x])),n,i))||void 0===p?void 0:p.generateStep,w=null==b?y:{type:"if",children:[b(),y,g]},j=(0,P.SO)(v,s.length-1),S=s.length>1?(0,P.SO)(v,s.length-2):void 0;if((null===S||void 0===S?void 0:S.type)===d){let e=s[s.length-1];"before"!==o&&(e+=1),S.children.splice(e,0,w),(0,r.bp)(S,...s.slice(0,-1))}else(0,P.pt)(s,v,s.length-1,{type:d,children:"before"===o?[w,j]:[j,w]});const M=y;c.push({steps:M,values:[]})}}}))));return Object.assign(Object.assign({},l),{hovered:void 0,dependencyMap:(0,r.aR)(l.grammar)})}))}var Q=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{l(r.next(e))}catch(t){o(t)}}function s(e){try{l(r.throw(e))}catch(t){o(t)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}l((r=r.apply(e,t||[])).next())}))};function I(e,t,n){const i=new Set,o=new Set;for(const{name:a,step:s}of e){const e=(0,r.BZ)(a);o.has(e)||null!=n&&!n.includes(e)||(i.add(a),o.add(e)),(0,r.VB)(s,(e=>{"symbol"===e.type&&e.identifier!==a&&i.add(e.identifier)}))}return{grammar:(0,N.vV)(e.filter((e=>i.has(e.name)))),selectionsList:t.filter((e=>i.has(C(e.steps)[0])))}}function R(e,t,n,i,o,a){return Q(this,void 0,void 0,(function*(){null==(0,r.KD)(o,a)&&(a=(0,N.ZP)(a,(e=>{e.push({name:o,step:{type:"this",path:[o]}})})));const s=yield G(e,t,n,i,"after",(()=>({type:"symbol",identifier:o})),a);return Object.assign(Object.assign({},s),{selectionsList:[{steps:o,values:[]}]})}))}function $(e,t,n,i,o=new Set){const a=(0,r.BW)(t,n),s=(0,r.BW)(t,i),l=e.find((e=>e.name===a));if(null==l)throw new Error(`unknown noun "${a}"`);const c=[],u=(0,N.ZP)(l.step,(t=>((0,r.VB)(t,(t=>{if("symbol"===t.type){const n=(0,r.BZ)(t.identifier);if(n==i)return;const a=(0,r.nH)(t.identifier,n),s=(0,r.BW)(a,i);t.identifier=s,null!=e.find((e=>e.name===s))||o.has(a)||c.push({localNounName:a,descriptionName:n})}})),(0,P.x$)(t,s))));o.add(t);const p={name:s,step:u};return(0,N.vV)(c.reduce(((t,{descriptionName:n,localNounName:r})=>t.concat($(e,r,n,i,o))),[p]))}function Y(e,t,n,i,o,a){return Q(this,void 0,void 0,(function*(){const s=yield(0,N.ZP)({grammar:a,selectionsList:[]},(({grammar:s,selectionsList:l})=>Q(this,void 0,void 0,(function*(){for(const c of t){if("string"!==typeof c.steps)continue;const t=c.steps,u=(0,r.KD)(t,a),p=(0,r.KD)(t,s);if(null!=(0,r.KD)(o,s)||null==u||null==p)continue;const d=(0,P.x$)((0,N.vV)(a[u].step,!1),o);s.splice(p,0,{name:o,step:d});const f=D(t,s);if(f.length>0){const t=k(e,f,c.values,((e,t)=>{const n=(0,r.Up)(e.before.index,t.before.index);return n===r.J.Predecessor||n===r.J.Equal}),void 0);yield H(e,t,n,i,(()=>({type:"symbol",identifier:o})),s)}l.push({steps:o,values:[]})}})))),l=I(s.grammar,s.selectionsList);return Object.assign(Object.assign({hovered:void 0},l),{dependencyMap:(0,r.aR)(l.grammar)})}))}function X(e,t,n){(0,r.VB)(e,(e=>{"symbol"===e.type&&e.identifier===t&&n(e)}))}var F=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{l(r.next(e))}catch(t){o(t)}}function s(e){try{l(r.throw(e))}catch(t){o(t)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}l((r=r.apply(e,t||[])).next())}))};function W(e,t){if("string"===typeof e){const n=[];for(const{step:r}of t)X(r,e,(e=>n.push(e.path)));return n}return[e.path]}function U(e,t,n,i,o,a){return F(this,void 0,void 0,(function*(){const s=yield(0,N.Uy)({grammar:a,selectionsList:[]},(({grammar:r,selectionsList:a})=>H(e,t,n,i,o,r,a)));return Object.assign(Object.assign({},s),{dependencyMap:(0,r.aR)(s.grammar),hovered:void 0})}))}function H(e,t,n,i,o,a,s){var l;return F(this,void 0,void 0,(function*(){for(const{values:c,steps:u,generatePatternCondition:p}of t)for(const t of W(u,a)){const u=t.join(","),d=null!==(l=e[u])&&void 0!==l?l:[],f=(0,r.D1)(a,t);null!=f&&(yield _(d.map((({before:e})=>e)),c.map((({before:e})=>e)),n,i,o,t,f,s,p))}}))}function _(e,t,n,i,o,a,s,l,c){var u,p;return F(this,void 0,void 0,(function*(){if(e.length>0&&0===t.length)return;const d=(0,r.SO)(s,a.length-1),f=null!==(u=o(d,a,s))&&void 0!==u?u:d,m=(0,N.Js)(d),h=null!==c&&void 0!==c?c:null===(p=yield M(e,t,n,i))||void 0===p?void 0:p.generateStep,v=null==h?f:{type:"if",children:[h(),f,m]};(0,r.pt)(a,s,a.length-1,v);const y=f;null===l||void 0===l||l.push({steps:(0,N.vV)(y),values:[]})}))}var J=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{l(r.next(e))}catch(t){o(t)}}function s(e){try{l(r.throw(e))}catch(t){o(t)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}l((r=r.apply(e,t||[])).next())}))};function K(e,t,n,i,o,a){return J(this,void 0,void 0,(function*(){const s=(e,t,n)=>function(e,t,n){if(Array.isArray(e)||"string"==typeof t)return{type:"this"};const r=e.children[t];switch(e.type){case"operation":{const r=n[e.identifier];if(null==r)break;const i=r.defaultParameters[t];return null==i?{type:"null"}:i()}case"sequential":return{type:"this"};case"parallel":case"random":return{type:"this"===r.type?"null":"this"};case"switch":case"if":if(0===t)break;return{type:"this"===r.type?"null":"this"}}}(n[n.length-2],t[t.length-1],o),l=I(yield(0,N.ZP)(a,(o=>J(this,void 0,void 0,(function*(){yield H(e,t,n,i,s,o);for(const e of o)e.step=ee(e.step);return(0,r.l3)(o)})))),[]);return Object.assign(Object.assign({},l),{dependencyMap:(0,r.aR)(l.grammar),hovered:void 0})}))}function ee(e){if(null==e.children)return e;for(let t=e.children.length-1;t>=0;t--)te(e,t)||(e.children[t]=ee(e.children[t]));return function(e){if("if"===e.type&&"this"===e.children[1].type&&"this"===e.children[2].type)return{type:"this"};if(("parallel"===e.type||"sequential"===e.type)&&1===e.children.length)return e.children[0];return e}(e)}function te(e,t){const n=e.children[t];if(null==n)return!1;switch(e.type){case"sequential":if("this"!==n.type||1===e.children.length)return!1;break;case"parallel":if("null"!==n.type||1===e.children.length)return!1;break;case"random":if("null"!==n.type)return!1;e.probabilities.splice(t,1);break;case"switch":if(0===t)return!1;if("null"!==n.type)return!1;e.cases.splice(t-1,1);break;default:return!1}return e.children.splice(t,1),!0}const ne=[{type:"add"},{type:"and"},{type:"divide"},{type:"equal"},{type:"getVariable"},{type:"greater"},{type:"greaterEqual"},{type:"if"},{type:"invert"},{type:"modulo"},{type:"multiply"},{type:"not"},{type:"or"},{type:"parallel"},{type:"random"},{type:"raw"},{type:"return"},{type:"sequential"},{type:"setVariable"},{type:"smaller"},{type:"smallerEqual"},{type:"subtract"},{type:"switch"},{type:"this"},{type:"unequal"},{type:"null"}];function re(e){return[...Object.keys(e).map((e=>({type:"operation",identifier:e}))),...ne]}function ie(e,t){switch(e.type){case"add":case"multiply":case"subtract":case"divide":case"modulo":case"equal":case"unequal":case"greater":case"greaterEqual":case"smaller":case"smallerEqual":return{type:e.type,children:[{type:"raw",value:2},{type:"raw",value:1}]};case"and":case"or":return{type:e.type,children:[{type:"raw",value:!0},{type:"raw",value:!1}]};case"if":return{type:e.type,children:[{type:"raw",value:!0},{type:"this"},{type:"this"}]};case"parallel":case"sequential":case"random":return{type:e.type,children:[],probabilities:[]};case"switch":return{type:e.type,cases:[],children:[{type:"raw",value:0}]};case"operation":{const n=t[e.identifier];if(null==n)throw new Error(`unknown operation "${e.identifier}"`);return{type:e.type,children:n.defaultParameters.map((e=>e())),identifier:e.identifier}}case"raw":return{type:e.type,value:1};case"getVariable":return{type:e.type,identifier:"x"};case"setVariable":return{type:e.type,identifier:"x",children:[{type:"raw",value:1}]};case"not":return{type:e.type,children:[{type:"raw",value:!0}]};case"invert":return{type:e.type,children:[{type:"raw",value:1}]};case"return":case"this":case"null":return{type:e.type}}}},82513:function(e,t,n){n.d(t,{J:function(){return i.J},Ao:function(){return te.Ao},by:function(){return i.by},O$:function(){return te.O$},Q:function(){return te.Q},aR:function(){return i.aR},h$:function(){return K},EU:function(){return te.EU},o9:function(){return te.o9},Qx:function(){return p},br:function(){return M.br},bp:function(){return te.bp},Db:function(){return te.Db},Q3:function(){return i.Q3},Eo:function(){return te.Eo},SO:function(){return i.SO},BZ:function(){return i.BZ},AJ:function(){return i.AJ},Up:function(){return i.Up},Bc:function(){return i.Bc},TY:function(){return te.TY},Ik:function(){return te.Ik},_P:function(){return te._P},MG:function(){return te.MG},zq:function(){return te.zq},Il:function(){return te.Il},gK:function(){return te.gK},z_:function(){return i.z_},BW:function(){return i.BW},IX:function(){return i.IX},hp:function(){return i.hp},z$:function(){return te.z$},au:function(){return te.au},TO:function(){return te.TO},Ug:function(){return te.Ug},W9:function(){return te.W9},$T:function(){return te.$T},Ii:function(){return M.Ii},Lr:function(){return i.Lr},hs:function(){return i.hs},nH:function(){return i.nH},Ej:function(){return i.Ej},lv:function(){return x},Qc:function(){return c},dk:function(){return u},Sg:function(){return i.Sg},im:function(){return te.im},tc:function(){return te.tc},lG:function(){return te.lG},gx:function(){return te.gx},qC:function(){return d},Wv:function(){return S},g3:function(){return f},y0:function(){return j},pt:function(){return i.pt},Sy:function(){return te.qC},wU:function(){return i.wU},QV:function(){return M.QV},Iz:function(){return W},l3:function(){return i.l3},x$:function(){return i.bp},Tn:function(){return M.Tn},D1:function(){return i.D1}});var r=n(67606),i=n(21283),o=n(50985);const a=n.n(o)().compile({returnSymbol:/return/,nullSymbol:/null/,thisSymbol:/this/,ifSymbol:/if/,thenSymbol:/then/,elseSymbol:/else/,switchSymbol:/switch/,caseSymbol:/case/,arrow:/->/,longArrow:/-->/,openBracket:/\(/,closedBracket:/\)/,openCurlyBracket:/{/,closedCurlyBracket:/}/,point:/\./,comma:/,/,colon:/:/,smallerEqual:/<=/,greaterEqual:/>=/,smaller:/</,greater:/>/,doubleEqual:/==/,equal:/=/,unequal:/!=/,and:/&&/,or:/\|\|/,not:/!/,parallel:/\|/,int:/0[Xx][\da-fA-F]+|0[bB][01]+/,number:/-?\d+(?:\.\d+)?/,string:/"[^"]*"/,boolean:/true|false/,plus:/\+/,minus:/-/,multiply:/\*/,percent:/%/,divide:/\//,identifier:/[a-zA-Z_$@']+\w*/,ws:{match:/\s+/,lineBreaks:!0}});var s={Lexer:a,ParserRules:[{name:"GrammarDefinition",symbols:["ws","RuleDefinition","ws"],postprocess:([,e])=>[e]},{name:"GrammarDefinition$ebnf$1",symbols:["RuleDefinitions"]},{name:"GrammarDefinition$ebnf$1",symbols:["GrammarDefinition$ebnf$1","RuleDefinitions"],postprocess:e=>e[0].concat([e[1]])},{name:"GrammarDefinition",symbols:["ws","GrammarDefinition$ebnf$1","RuleDefinition","ws"],postprocess:([,e,t])=>{if(null!=e.find((({name:e})=>e===t.name)))throw new Error(`rule "${identifier}" is already defined`);return[...e,t]}},{name:"GrammarDefinition",symbols:["ws"],postprocess:()=>[]},{name:"RuleDefinitions",symbols:["RuleDefinition",a.has("ws")?{type:"ws"}:ws],postprocess:([e])=>e},{name:"RuleDefinition",symbols:[a.has("identifier")?{type:"identifier"}:identifier,"ws",a.has("longArrow")?{type:"longArrow"}:longArrow,"ws","Steps"],postprocess:([{value:e},,,,t])=>({name:e,step:t})},{name:"Steps",symbols:["ParallelSteps"],postprocess:([e])=>e},{name:"ParallelSteps$ebnf$1",symbols:["ParallelStep"]},{name:"ParallelSteps$ebnf$1",symbols:["ParallelSteps$ebnf$1","ParallelStep"],postprocess:e=>e[0].concat([e[1]])},{name:"ParallelSteps",symbols:["ParallelSteps$ebnf$1","SequentialSteps"],postprocess:([e,t])=>({type:"parallel",children:[...e,t]})},{name:"ParallelSteps",symbols:["SequentialSteps"],postprocess:([e])=>e},{name:"ParallelStep",symbols:["SequentialSteps","ws",a.has("parallel")?{type:"parallel"}:parallel,"ws"],postprocess:([e])=>e},{name:"SequentialSteps$ebnf$1",symbols:["SequentialStep"]},{name:"SequentialSteps$ebnf$1",symbols:["SequentialSteps$ebnf$1","SequentialStep"],postprocess:e=>e[0].concat([e[1]])},{name:"SequentialSteps",symbols:["SequentialSteps$ebnf$1","OrOperation"],postprocess:([e,t])=>({type:"sequential",children:[...e,t]})},{name:"SequentialSteps",symbols:["OrOperation"],postprocess:([e])=>e},{name:"SequentialStep",symbols:["OrOperation","ws",a.has("arrow")?{type:"arrow"}:arrow,"ws"],postprocess:([e])=>e},{name:"OrOperation",symbols:["OrOperation","ws",a.has("or")?{type:"or"}:or,"ws","AndOperation"],postprocess:([e,,,,t])=>({type:"or",children:[e,t]})},{name:"OrOperation",symbols:["AndOperation"],postprocess:([e])=>e},{name:"AndOperation",symbols:["AndOperation","ws",a.has("and")?{type:"and"}:and,"ws","NegateOperation"],postprocess:([e,,,,t])=>({type:"and",children:[e,t]})},{name:"AndOperation",symbols:["NegateOperation"],postprocess:([e])=>e},{name:"NegateOperation",symbols:[a.has("not")?{type:"not"}:not,"ws","NegateOperation"],postprocess:([,,e])=>({type:"not",children:[e]})},{name:"NegateOperation",symbols:["ComparisonOperation"],postprocess:([e])=>e},{name:"ComparisonOperation",symbols:["EquityOperation"],postprocess:([e])=>e},{name:"EquityOperation",symbols:["EqualOperation"],postprocess:([e])=>e},{name:"EquityOperation",symbols:["UnequalOperation"],postprocess:([e])=>e},{name:"EquityOperation",symbols:["RelationalOperation"],postprocess:([e])=>e},{name:"EqualOperation",symbols:["EquityOperation","ws",a.has("doubleEqual")?{type:"doubleEqual"}:doubleEqual,"ws","RelationalOperation"],postprocess:([e,,,,t])=>({type:"equal",children:[e,t]})},{name:"UnequalOperation",symbols:["EquityOperation","ws",a.has("unequal")?{type:"unequal"}:unequal,"ws","RelationalOperation"],postprocess:([e,,,,t])=>({type:"unequal",children:[e,t]})},{name:"RelationalOperation",symbols:["SmallerOperation"],postprocess:([e])=>e},{name:"RelationalOperation",symbols:["SmallerEqualOperation"],postprocess:([e])=>e},{name:"RelationalOperation",symbols:["GreaterOperation"],postprocess:([e])=>e},{name:"RelationalOperation",symbols:["GreaterEqualOperation"],postprocess:([e])=>e},{name:"RelationalOperation",symbols:["ArithmeticOperation"],postprocess:([e])=>e},{name:"SmallerOperation",symbols:["RelationalOperation","ws",a.has("smaller")?{type:"smaller"}:smaller,"ws","ArithmeticOperation"],postprocess:([e,,,,t])=>({type:"smaller",children:[e,t]})},{name:"SmallerEqualOperation",symbols:["RelationalOperation","ws",a.has("smallerEqual")?{type:"smallerEqual"}:smallerEqual,"ws","ArithmeticOperation"],postprocess:([e,,,,t])=>({type:"smallerEqual",children:[e,t]})},{name:"GreaterOperation",symbols:["RelationalOperation","ws",a.has("greater")?{type:"greater"}:greater,"ws","ArithmeticOperation"],postprocess:([e,,,,t])=>({type:"greater",children:[e,t]})},{name:"GreaterEqualOperation",symbols:["RelationalOperation","ws",a.has("greaterEqual")?{type:"greaterEqual"}:greaterEqual,"ws","ArithmeticOperation"],postprocess:([e,,,,t])=>({type:"greaterEqual",children:[e,t]})},{name:"ArithmeticOperation",symbols:["LineOperation"],postprocess:([e])=>e},{name:"LineOperation",symbols:["AddOperation"],postprocess:([e])=>e},{name:"LineOperation",symbols:["SubtractOperation"],postprocess:([e])=>e},{name:"LineOperation",symbols:["PointOperation"],postprocess:([e])=>e},{name:"AddOperation",symbols:["LineOperation","ws",a.has("plus")?{type:"plus"}:plus,"ws","PointOperation"],postprocess:([e,,,,t])=>({type:"add",children:[e,t]})},{name:"SubtractOperation",symbols:["LineOperation","ws",a.has("minus")?{type:"minus"}:minus,"ws","PointOperation"],postprocess:([e,,,,t])=>({type:"subtract",children:[e,t]})},{name:"PointOperation",symbols:["MultiplyOperation"],postprocess:([e])=>e},{name:"PointOperation",symbols:["DivideOperation"],postprocess:([e])=>e},{name:"PointOperation",symbols:["ModuloOperation"],postprocess:([e])=>e},{name:"PointOperation",symbols:["InvertOperation"],postprocess:([e])=>e},{name:"DivideOperation",symbols:["PointOperation","ws",a.has("divide")?{type:"divide"}:divide,"ws","InvertOperation"],postprocess:([e,,,,t])=>({type:"divide",children:[e,t]})},{name:"MultiplyOperation",symbols:["PointOperation","ws",a.has("multiply")?{type:"multiply"}:multiply,"ws","InvertOperation"],postprocess:([e,,,,t])=>({type:"multiply",children:[e,t]})},{name:"ModuloOperation",symbols:["PointOperation","ws",a.has("percent")?{type:"percent"}:percent,"ws","InvertOperation"],postprocess:([e,,,,t])=>({type:"modulo",children:[e,t]})},{name:"InvertOperation",symbols:[a.has("minus")?{type:"minus"}:minus,"ws","InvertOperation"],postprocess:([,,e])=>({type:"invert",children:[e]})},{name:"InvertOperation",symbols:["Step"],postprocess:([e])=>e},{name:"Step",symbols:["Operation"],postprocess:([e])=>e},{name:"Step",symbols:["Symbol"],postprocess:([e])=>e},{name:"Step",symbols:[a.has("thisSymbol")?{type:"thisSymbol"}:thisSymbol],postprocess:()=>({type:"this"})},{name:"Step",symbols:["GetVariable"],postprocess:([e])=>e},{name:"Step",symbols:["SetVariable"],postprocess:([e])=>e},{name:"Step",symbols:["Constant"],postprocess:([e])=>({type:"raw",value:e})},{name:"Step",symbols:["Conditional"],postprocess:([e])=>e},{name:"Step",symbols:[a.has("returnSymbol")?{type:"returnSymbol"}:returnSymbol],postprocess:()=>({type:"return"})},{name:"Step",symbols:[a.has("nullSymbol")?{type:"nullSymbol"}:nullSymbol],postprocess:()=>({type:"null"})},{name:"Step",symbols:[a.has("openBracket")?{type:"openBracket"}:openBracket,"ws","Steps","ws",a.has("closedBracket")?{type:"closedBracket"}:closedBracket],postprocess:([,,e])=>e},{name:"Step",symbols:["Random"],postprocess:([e])=>e},{name:"Random$ebnf$1",symbols:[]},{name:"Random$ebnf$1",symbols:["Random$ebnf$1","RandomStep"],postprocess:e=>e[0].concat([e[1]])},{name:"Random",symbols:[a.has("openCurlyBracket")?{type:"openCurlyBracket"}:openCurlyBracket,"Random$ebnf$1","ws",a.has("closedCurlyBracket")?{type:"closedCurlyBracket"}:closedCurlyBracket],postprocess:([,e])=>({type:"random",probabilities:e.map((({probability:e})=>e)),children:e.map((({steps:e})=>e))})},{name:"RandomStep",symbols:["ws",a.has("number")?{type:"number"}:number,a.has("percent")?{type:"percent"}:percent,"ws",a.has("colon")?{type:"colon"}:colon,"ws","Steps"],postprocess:([,{value:e},,,,,t])=>({probability:Number.parseFloat(e)/100,steps:t})},{name:"Operation",symbols:[a.has("identifier")?{type:"identifier"}:identifier,a.has("openBracket")?{type:"openBracket"}:openBracket,"EmptyParameters","ws",a.has("closedBracket")?{type:"closedBracket"}:closedBracket],postprocess:([{value:e},,t])=>({type:"operation",children:t,identifier:e})},{name:"EmptyParameters",symbols:["ws","Parameters"],postprocess:([,e])=>e},{name:"EmptyParameters",symbols:[],postprocess:()=>[]},{name:"Parameters$ebnf$1",symbols:[]},{name:"Parameters$ebnf$1",symbols:["Parameters$ebnf$1","Parameter"],postprocess:e=>e[0].concat([e[1]])},{name:"Parameters",symbols:["Parameters$ebnf$1","Steps"],postprocess:([e,t])=>[...e,t]},{name:"Parameter",symbols:["Steps","ws",a.has("comma")?{type:"comma"}:comma,"ws"],postprocess:([e])=>e},{name:"Symbol",symbols:[a.has("identifier")?{type:"identifier"}:identifier],postprocess:([{value:e}])=>({type:"symbol",identifier:e})},{name:"ws",symbols:[a.has("ws")?{type:"ws"}:ws]},{name:"ws",symbols:[]},{name:"Constant",symbols:[a.has("boolean")?{type:"boolean"}:boolean],postprocess:([{value:e}])=>"true"===e},{name:"Constant",symbols:[a.has("string")?{type:"string"}:string],postprocess:([{value:e}])=>e.slice(1,-1)},{name:"Constant",symbols:[a.has("number")?{type:"number"}:number],postprocess:([{value:e}])=>Number.parseFloat(e)},{name:"Constant",symbols:[a.has("int")?{type:"int"}:int],postprocess:([{value:e}])=>Number.parseInt(e)},{name:"GetVariable",symbols:[a.has("thisSymbol")?{type:"thisSymbol"}:thisSymbol,a.has("point")?{type:"point"}:point,a.has("identifier")?{type:"identifier"}:identifier],postprocess:([,,{value:e}])=>({type:"getVariable",identifier:e})},{name:"SetVariable",symbols:[a.has("thisSymbol")?{type:"thisSymbol"}:thisSymbol,a.has("point")?{type:"point"}:point,a.has("identifier")?{type:"identifier"}:identifier,"ws",a.has("equal")?{type:"equal"}:equal,"ws","Step"],postprocess:([,,{value:e},,,,t])=>({type:"setVariable",identifier:e,children:[t]})},{name:"Conditional",symbols:["IfThenElse"],postprocess:([e])=>e},{name:"Conditional",symbols:["Switch"],postprocess:([e])=>e},{name:"IfThenElse",symbols:[a.has("ifSymbol")?{type:"ifSymbol"}:ifSymbol,a.has("ws")?{type:"ws"}:ws,"Steps",a.has("ws")?{type:"ws"}:ws,"Then","ws","Else"],postprocess:([,,e,,t,,n])=>({type:"if",children:[e,t,n]})},{name:"Then",symbols:[a.has("thenSymbol")?{type:"thenSymbol"}:thenSymbol,"ws",a.has("openCurlyBracket")?{type:"openCurlyBracket"}:openCurlyBracket,"ws","Steps","ws",a.has("closedCurlyBracket")?{type:"closedCurlyBracket"}:closedCurlyBracket],postprocess:([,,,,e])=>e},{name:"Else",symbols:[a.has("elseSymbol")?{type:"elseSymbol"}:elseSymbol,"ws",a.has("openCurlyBracket")?{type:"openCurlyBracket"}:openCurlyBracket,"ws","Steps","ws",a.has("closedCurlyBracket")?{type:"closedCurlyBracket"}:closedCurlyBracket],postprocess:([,,,,e])=>e},{name:"Switch$ebnf$1",symbols:[]},{name:"Switch$ebnf$1",symbols:["Switch$ebnf$1","SwitchCases"],postprocess:e=>e[0].concat([e[1]])},{name:"Switch",symbols:[a.has("switchSymbol")?{type:"switchSymbol"}:switchSymbol,a.has("ws")?{type:"ws"}:ws,"Steps","ws",a.has("openCurlyBracket")?{type:"openCurlyBracket"}:openCurlyBracket,"Switch$ebnf$1","ws",a.has("closedCurlyBracket")?{type:"closedCurlyBracket"}:closedCurlyBracket],postprocess:([,,e,,,t])=>({type:"switch",cases:t.map((({caseValues:e})=>e)),children:[e,...t.map((({steps:e})=>e))]})},{name:"SwitchCases$ebnf$1",symbols:["SwitchCase"]},{name:"SwitchCases$ebnf$1",symbols:["SwitchCases$ebnf$1","SwitchCase"],postprocess:e=>e[0].concat([e[1]])},{name:"SwitchCases",symbols:["ws","SwitchCases$ebnf$1","Steps"],postprocess:([,e,t])=>({caseValues:e,steps:t})},{name:"SwitchCase",symbols:[a.has("caseSymbol")?{type:"caseSymbol"}:caseSymbol,a.has("ws")?{type:"ws"}:ws,"Constant",a.has("colon")?{type:"colon"}:colon,"ws"],postprocess:([,,e])=>e}],ParserStart:"GrammarDefinition"};const l=r.Grammar.fromCompiled(s);function c(e){const t=new r.Parser(l);if(t.feed(e),0===t.results.length)throw new Error("unexpected end of input");return t.results[0]}function u(e,t){const n=c(e);return(0,i.z_)(n,t)}function p(e,t,n,r){const o={fromStep:(e,n,r)=>function(e,t,n,r,o){if(null!=e&&"string"!=typeof t&&(0,i.rL)(e,t))return n.join(n.fromText("(",t),n.getWhitespace(o+1,t),r(o+1,t),n.getWhitespace(o,t),n.fromText(")",t));return r(o,t)}(n,r,o,t,e),fromText:e,getWhitespace:r,join:n};return o}function d(e,t){return t.join(...e.map((({name:e,step:n},r)=>{const i=t.fromStep(0,void 0,e),o=t.fromText(" --\x3e",e),a=t.getWhitespace(1,n),s=t.fromStep(1,void 0,n);return 0===r?t.join(i,o,a,s):t.join(t.getWhitespace(0,e),i,o,a,s)})))}function f(e,t,n=0){switch(e.type){case"operation":return function(e,t,n){const r=t.getWhitespace(n,e),i=t.getWhitespace(n+1,e);return t.join(t.fromText(`${e.identifier}(`,e),...y(e.children.map((r=>t.join(i,t.fromStep(n+1,e,r)))),t.fromText(",",e)),r,t.fromText(")",e))}(e,t,n);case"parallel":return function(e,t,n){const r=t.getWhitespace(n,e);return t.join(...y(e.children.map((r=>t.fromStep(n,e,r))),t.join(t.fromText(" |",e),r)))}(e,t,n);case"raw":return function(e,t,n){return t.fromText(v(e.value),e)}(e,t);case"sequential":return function(e,t,n){const r=t.getWhitespace(n,e);return t.join(...y(e.children.map((r=>t.fromStep(n,e,r))),t.join(t.fromText(" ->",e),r)))}(e,t,n);case"symbol":return function(e,t,n){return t.fromText(e.identifier,e)}(e,t);case"this":return function(e,t,n){return t.fromText("this",e)}(e,t);case"invert":case"not":return function(e,t,n){switch(e.type){case"invert":return t.join(t.fromText("-",e),t.fromStep(n,e,e.children[0]));case"not":return t.join(t.fromText("!",e),t.fromStep(n,e,e.children[0]))}}(e,t,n);case"add":case"and":case"divide":case"equal":case"greater":case"greaterEqual":case"modulo":case"multiply":case"or":case"smaller":case"smallerEqual":case"subtract":case"unequal":return function(e,t,n){return t.join(t.fromStep(n,e,e.children[0]),t.fromText(` ${h[e.type]} `,e),t.fromStep(n,e,e.children[1]))}(e,t,n);case"if":return function(e,t,n){const[r,i,o]=e.children,a=t.getWhitespace(n+1,r),s=t.getWhitespace(n,r),l=t.getWhitespace(n+1,i,o),c=t.getWhitespace(n,i,o);return t.join(t.fromText("if",e),a,t.fromStep(n+1,e,r),s,t.fromText("then {",e),l,t.fromStep(n+1,e,i),c,t.fromText("} else {",e),l,t.fromStep(n+1,e,o),c,t.fromText("}",e))}(e,t,n);case"switch":return function(e,t,n){const r=t.getWhitespace(n,e),i=t.getWhitespace(n+1,e);return t.join(t.fromText("switch",e),t.getWhitespace(n+1,e.children[0]),t.fromStep(n+1,e,e.children[0]),r,t.fromText("{",e),...e.cases.map(((r,o)=>[...r.reduce(((n,r)=>[...n,i,t.fromText(`case ${v(r)}:`,e)]),[]),t.getWhitespace(n+2,e.children[o+1]),t.fromStep(n+2,e,e.children[o+1])])).reduce(((e,t)=>e.concat(t)),[]),r,t.fromText("}",e))}(e,t,n);case"getVariable":return function(e,t,n){return t.fromText(`this.${e.identifier}`,e)}(e,t);case"setVariable":return function(e,t,n){return t.join(t.fromText(`this.${e.identifier} =`,e),t.getWhitespace(n+1,e.children[0]),t.fromStep(n+1,e,e.children[0]))}(e,t,n);case"return":return function(e,t,n){return t.fromText("return",e)}(e,t);case"random":return function(e,t,n){if(e.children.length!=e.probabilities.length)throw new Error("random step must have the same amount of childrens as the amount of probabilities");const r=t.getWhitespace(n,e),i=t.getWhitespace(n+1,e);return t.join(t.fromText("{",e),...e.children.map(((r,o)=>[i,t.fromText(`${m(100*e.probabilities[o],2)}%:`,e),i,t.fromStep(n+1,e,r)])).reduce(((e,t)=>e.concat(t)),[]),r,t.fromText("}",e))}(e,t,n);case"null":return function(e,t,n){return t.fromText("null",e)}(e,t)}}function m(e,t){const n=Math.pow(10,t);return(Math.round(e*n)/n).toString()}const h={add:"+",and:"&&",divide:"/",equal:"==",greater:">",greaterEqual:">=",modulo:"%",multiply:"*",or:"||",smaller:"<",smallerEqual:"<=",subtract:"-",unequal:"!="};function v(e){switch(typeof e){case"string":return`"${e}"`;case"number":return""+Math.round(100*e)/100;case"boolean":return e.toString();default:throw new Error(`constant "${e}" of unexpected type`)}}function y(e,t){const n=[];for(let r=0;r<e.length;r++)n.push(e[r]),r<e.length-1&&n.push(t);return n}function g(e,...t){return"string"===typeof t[0]?"\n":" "}function x(e,...t){for(const n of t){if("string"===typeof n)return"\n\n";if(b(n)>2)return`\n${"\t".repeat(e)}`}return" "}function b(e){var t,n;return null!==(n=null===(t=e.children)||void 0===t?void 0:t.reduce(((e,t)=>e+b(t)+1),0))&&void 0!==n?n:0}function w(e=(()=>{}),t=g){const n=p((e=>e),((t,r)=>{var i;return null!==(i=e(r))&&void 0!==i?i:"string"===typeof r?r:f(r,n,t)}),((...e)=>e.join("")),t);return n}function j(e,t=(()=>{}),n=g){return d(e,w(t,n))}function S(e,t=0,n=(()=>{}),r=g){return w(n,r).fromStep(t,void 0,e)}var M=n(16195),E=n(96102);class O{constructor(){this.matrix=[]}set(e,t,n){if(t>e){const n=t;t=e,e=n}let r=this.matrix[t];null==r&&(r=[],this.matrix[t]=r),r[e]=n}get(e,t){if(t>e){const n=t;t=e,e=n}return this.matrix[t][e]}}function N(e,t,n,r=0,i=e[0].horizontal.length,o=new Array(e.length).fill(void 0).map(((e,t)=>t)),a=1){if(0===o.length)throw new Error("unable to nest group with a height 0 zero (yList.length == 0)");if(1===o.length)return z(n.nestVerticalGroups(e,t,n,r,i,o,a),n.filterValue);let s,l,c;const u=new O;for(const p of o)for(const d of o){if(d<=p)continue;const o=n.rowSimilarity(e,t,n,a,r,i,p,d);u.set(p,d,o),(null==c||o<c)&&(s=p,l=d,c=o)}return c<n.minRowSimilarity?[C(P(e,t,n,u,s,l,c>=0,r,i,o,a))]:z(n.nestVerticalGroups(e,t,n,r,i,o,a),n.filterValue)}function P(e,t,n,r,i,o,a,s,l,c,u){const p=[i],d=[o],f=new Set(c);f.delete(i),f.delete(o);let m=e[i].probability,h=e[o].probability;for(;f.size>0;){const{similarity:t,y:n}=Z(p,f,r),{similarity:i,y:o}=Z(d,f,r);t>=i?(p.push(n),f.delete(n),m+=e[n].probability):(d.push(o),f.delete(o),h+=e[o].probability)}p.sort(),d.sort();const{child:v,parent:y}=V(m,u),{child:g,parent:x}=V(h,u);return{compatible:a,vertical:[{group:N(e,t,n,s,l,p,v),probability:y},{group:N(e,t,n,s,l,d,g),probability:x}]}}function Z(e,t,n){let r,i;for(const o of t){let t=0;for(const r of e)t+=n.get(o,r);t/=e.length,(null==r||t>r)&&(r=t,i=o)}return{similarity:r,y:i}}function V(e,t){return t*e<=1?{parent:e*t,child:1/e}:{parent:1,child:t}}function C(e,t=1){return{vertical:e.vertical.reduce(((n,{group:r,probability:i})=>{const o=i*t;return Array.isArray(r)&&1===r.length&&r[0].compatible===e.compatible?n.concat(C(r[0],o).vertical):n.concat({group:r,probability:o})}),[]),compatible:e.compatible}}function z(e,t,n=1){return e.reduce(((e,r)=>{if(1===r.vertical.length){const{group:i,probability:o}=r.vertical[0];if(Array.isArray(i)){const r=z(i,t,o*n);return[...e,...r]}if(!t(i))return e}return[...e,{vertical:r.vertical.map((({group:e,probability:t})=>({group:e,probability:t*n}))),compatible:r.compatible}]}),[])}function k(e,t,n){switch(e.type){case"random":return function(e,t,n){return e.children.map(((r,i)=>k(r,t,e.probabilities[i]*n))).reduce(((e,t)=>B(e,t,!0)))}(e,t,n);case"if":return function(e,t,n){return B(A(k(e.children[1],t,n/2),(n=>({horizontal:[{type:"filterStart",children:[k(e.children[0],t,1)],values:[!0],options:2},...n.horizontal,{type:"filterEnd"}],probability:n.probability}))),A(k(e.children[2],t,n/2),(n=>({horizontal:[{type:"filterStart",children:[k(e.children[0],t,1)],values:[!1],options:2},...n.horizontal,{type:"filterEnd"}],probability:n.probability}))),!0)}(e,t,n);case"sequential":return function(e,t,n){const{seperationMatrix:r,vertical:i}=e.children.map((e=>k(e,t,1))).reduce(((e,t)=>function(e,t){const n=[],r=[];for(let i=0;i<e.vertical.length;i++)for(let o=0;o<t.vertical.length;o++){const a=i*t.vertical.length+o;n[a]={horizontal:[...e.vertical[i].horizontal,...t.vertical[o].horizontal],probability:e.vertical[i].probability*t.vertical[o].probability};for(let n=0;n<e.vertical.length;n++)for(let s=0;s<t.vertical.length;s++){const l=n*t.vertical.length+s;let c=r[a],u=r[l];null==c&&(c=[],r[a]=c),null==u&&(u=[],r[l]=u);const p=e.seperationMatrix[i][n]&&t.seperationMatrix[o][s];c[l]=p,u[a]=p}}return{vertical:n,seperationMatrix:r}}(e,t)));return{seperationMatrix:r,vertical:i.map((({horizontal:e,probability:t})=>({horizontal:e,probability:t*n})))}}(e,t,n);case"parallel":return function(e,t,n){return e.children.map((e=>k(e,t,n))).reduce(((e,t)=>B(e,t,!1)))}(e,t,n);case"switch":return function(e,t,n){const r=n/(e.children.length-1),i=k(e.children[0],t,1);return e.children.slice(1).map(((n,o)=>A(k(n,t,r),(t=>({horizontal:[{type:"filterStart",children:[i],values:e.cases[o],options:e.children.length-1},...t.horizontal,{type:"filterEnd"}],probability:t.probability}))))).reduce(((e,t)=>B(e,t,!0)))}(e,t,n);case"symbol":return function(e,t,n){return A(k(t(e.identifier),t,n),(t=>({horizontal:[{type:"nounStart",identifier:e.identifier},...t.horizontal,{type:"nounEnd"}],probability:t.probability})))}(e,t,n);default:return{seperationMatrix:[[!0]],vertical:[{probability:n,horizontal:[D(e,t)]}]}}}function D(e,t){return null!=e.children?Object.assign(Object.assign({},e),{children:e.children.map((e=>k(e,t,1)))}):e}function B(e,t,n){const r=e.seperationMatrix.map((e=>e.concat(new Array(t.vertical.length).fill(n)))),i=t.seperationMatrix.map((t=>new Array(e.vertical.length).fill(n).concat(t)));return{vertical:e.vertical.concat(t.vertical),seperationMatrix:r.concat(i)}}function A(e,t){return{seperationMatrix:e.seperationMatrix,vertical:e.vertical.map(t)}}function T(e,t,n,r,i){const o=[];for(const a of i){let i=o.find((i=>t(e[i[0]].horizontal[r],e[a].horizontal[r])>=n));null==i&&(i=[],o.push(i)),i.push(a)}return o}function L(e,t){if(0===t.length)return{type:"this"};const n=t[0].value;switch(n.type){case"filterStart":case"filterEnd":case"nounStart":case"nounEnd":throw new Error(`unable to combine "${n.type}" here (should be done earlier)`);case"this":case"null":case"raw":case"getVariable":return n;default:return Object.assign(Object.assign({},n),{children:null==n.children?void 0:q(t.map((({value:e})=>e.children)),t.map((({probability:e})=>e)),e.createNoun)})}}function q(e,t,n){const r=Math.max(...e.map((e=>e.length)));return new Array(r).fill(void 0).map(((r,o)=>F(e.map(((e,n)=>{const r=e[o],i=t[n];if(null!=r)return function(e,t){return{seperationMatrix:e.seperationMatrix,vertical:e.vertical.map((e=>({horizontal:e.horizontal,probability:e.probability*t})))}}(r,i)})).filter(i.Dm).reduce(((e,t)=>B(e,t,!0))),n)))}function G(e,t){const{maxSimilarity:n,similarity:r}=Q(e,t);return r/n}function Q(e,t){if(e.type!==t.type)return{similarity:0,maxSimilarity:1};switch(e.type){case"filterStart":if(typeof e.values[0]!==typeof t.values[0])return{similarity:0,maxSimilarity:1};break;case"setVariable":case"operation":if(e.identifier!==t.identifier)return{similarity:0,maxSimilarity:1};break;case"getVariable":case"nounStart":return{similarity:e.identifier===t.identifier?1:0,maxSimilarity:1};case"raw":return{similarity:e.value===t.value?1:0,maxSimilarity:1};case"filterEnd":case"nounEnd":return{similarity:1,maxSimilarity:1}}if(null==e.children)return{similarity:1,maxSimilarity:1};const{maxSimilarity:n,similarity:r}=function(e,t){let n=0,r=0;for(let i=0;i<Math.max(e.length,t.length);i++){const o=e[i],a=t[i];if(null==o||null==a){r++;continue}const{maxSimilarity:s,similarity:l}=I(o,a);n+=l,r+=s}return{similarity:n,maxSimilarity:r}}(e.children,t.children);return{maxSimilarity:n+1,similarity:r+1}}function I(e,t){return 1===e.vertical.length&&1===e.vertical[0].horizontal.length&&1===t.vertical.length&&1===t.vertical[0].horizontal.length?Q(e.vertical[0].horizontal[0],t.vertical[0].horizontal[0]):{similarity:1,maxSimilarity:2}}function R(e,t,n,r,o,a,s,l){let c=0,u=0;for(let p=o;p<a;p++){const t=e[s].horizontal[p],r=e[l].horizontal[p];if(!("filterEnd"===t.type&&"filterEnd"===r.type||"nounEnd"===t.type&&"nounEnd"===r.type||"this"===t.type&&"this"===r.type)&&(++u,!(G(t,r)<n.minValueSimilarity)&&(c++,"filterStart"===t.type&&"filterStart"===r.type&&!(0,i.wU)(t.values,r.values)))){let t=1,n=1;for(;t>0&&n>0&&p<a;){p++;const r=e[s].horizontal[p],i=e[l].horizontal[p];"filterStart"===r.type?t++:"filterEnd"===r.type&&t--,"filterStart"===i.type?n++:"filterEnd"===i.type&&n--}}}return 0===u?c=1:c/=u,t[s][l]?(e[s].probability+e[l].probability)*r>1+i.Ib&&(c=-1.5):c=-3,c}function $(e){if(!Array.isArray(e))return e;const t=e.map((e=>{const t=[],n=new Set(e.vertical);let r,o;for(;n.size>0;){const[a]=n;let s;if(e.compatible&&null!=r&&null!=o&&null!=(s=Y(n,o))){n.delete(s),r.children.push($(s.group)),r.probabilities.push(s.probability),o+=s.probability;continue}n.delete(a);const l=$(a.group);e.compatible?(0,i.Gc)(a.probability,1)?(t.push(l),r=void 0,o=void 0):(r={type:"random",children:[l],probabilities:[a.probability]},o=a.probability,t.push(r)):(t.push((0,i.Gc)(a.probability,1)?l:{type:"random",children:[l],probabilities:[a.probability]}),r=void 0,o=void 0)}return 1===t.length?t[0]:{type:"parallel",children:t}}));return 0===t.length?{type:"this"}:1===t.length?t[0]:{type:"sequential",children:t}}function Y(e,t){if((0,i.Gc)(t,1))return;const n=1-t+i.Ib;let r,o;for(const i of e)i.probability>n||(null==o||i.probability>o)&&(o=i.probability,r=i);return r}const X=(e,t,n,r,o,a,s)=>{var l,c;let u,p;const d=new Array(a.length).fill(!1),f=new Array(a.length).fill(0);for(let i=r;i<o;i++){for(let t=0;t<a.length;t++){const n=a[t],r=e[n].horizontal[i];"filterStart"!==r.type&&"nounStart"!==r.type||(u=i,f[t]=1,p=r,d[t]=!0)}if(null!=u)break}if(null==u||null==p)return function(e,t,n,r,i,o,a,s,l,c){if(s-a<=0)throw new Error("unable to nest vertical groups with with <= 0");let u=T(e,r,i,a,l),p=a;for(let m=a+1;m<s;m++){const t=T(e,r,i,m,l);t.length<u.length&&(u=t,p=m)}const d=[];p-a>0&&d.push(...N(e,t,o,a,p,l,c));const f={compatible:!0,vertical:[]};d.push(f);for(const m of u){const t=m.reduce(((t,n)=>t+e[n].probability),0),r=t*c;f.vertical.push({group:n(o,m.map((n=>({value:e[n].horizontal[p],probability:e[n].probability/t})))),probability:r})}return s-(p+1)>0&&d.push(...N(e,t,o,p+1,s,l,c)),d}(e,t,L,G,n.minValueSimilarity,n,r,o,a,s);const m=a.reduce(((t,n)=>t+e[n].probability),0),h=m*s,v=1/m,y=e.map((e=>({horizontal:[...e.horizontal],probability:e.probability}))),g=[];u-r>0&&g.push(...N(e,t,n,r,u,a,s));let x,b=u+1,w=!1;for(;!w&&b<o;){w=!0;for(let t=0;t<a.length;t++){const n=a[t],r=e[n].horizontal[b];"filterStart"===r.type||"nounStart"===r.type?f[t]++:"filterEnd"!==r.type&&"nounEnd"!==r.type||f[t]--,0===f[t]?d[t]&&(d[t]=!1,y[n].horizontal[b]={type:"this"}):w=!1}b++}if("filterStart"===p.type){const r=[],o=[],p=[];let d=!0;for(let t=0;t<a.length;t++){const n=a[t],s=e[n].horizontal[u];if("filterStart"!==s.type){o.push(t);continue}p[t]=A(s.children[0],(({horizontal:t})=>({horizontal:t,probability:e[n].probability*v}))),1===s.values.length&&"boolean"===typeof s.values[0]||(d=!1);let l=r.find((({values:e})=>(0,i.wU)(e,s.values)));null==l&&(l={values:s.values,yList:[]},r.push(l)),l.yList.push(n)}for(const t of a){"filterStart"===e[t].horizontal[u].type&&(y[t].probability*=r.length)}for(const i of o){const o=a[i];let l,c;for(const e of r){let r=0;for(const i of e.yList)r+=R(y,t,n,s,u+1,b,o,i);r/=e.yList.length,(null==l||r>l)&&(l=r,c=e)}c.yList.push(o),p[i]={vertical:[{horizontal:[{type:"raw",value:c.values[0]}],probability:e[o].probability*v}],seperationMatrix:[[!0]]}}const f=F(p.reduce(((e,t)=>B(e,t,!0))),n.createNoun);if(d){const e=null===(l=r.find((({values:e})=>!0===e[0])))||void 0===l?void 0:l.yList,i=null===(c=r.find((({values:e})=>!1===e[0])))||void 0===c?void 0:c.yList;x={type:"if",children:[f,null==e?{type:"null"}:$(N(y,t,n,u+1,b,e,v)),null==i?{type:"null"}:$(N(y,t,n,u+1,b,i,v))]}}else x={type:"switch",cases:r.map((({values:e})=>e)),children:[f,...r.map((({yList:e})=>$(N(y,t,n,u+1,b,e,v))))]}}else{const e=n.createNoun(p.identifier);e.step=$(N(y,t,n,u+1,b,a,v)),x={type:"symbol",identifier:e.name}}return g.push({compatible:!0,vertical:[{group:x,probability:h}]}),o-b>0&&g.push(...N(e,t,n,b,o,a,s)),g};function F({seperationMatrix:e,vertical:t},n,r=1){return $(N(function(e,t,n){const r=e[0],i=[...r.horizontal],o=[{horizontal:[...r.horizontal],probability:r.probability}];for(let a=1;a<e.length;a++){const r=e[a],s=[...r.horizontal],l=(0,E.Bm)(i,s,{comparator:n});let c=0;for(const e of l){const n=e.value.length;if(e.added){i.splice(c,0,...e.value);for(const e of o)e.horizontal.splice(c,0,...new Array(n).fill(void 0).map((()=>t())))}else e.removed&&s.splice(c,0,...new Array(n).fill(void 0).map((()=>t())));c+=n}o.push({horizontal:s,probability:r.probability})}return o}(t,(()=>({type:"this"})),((e,t)=>G(e,t)>=.1)),e,{createNoun:n,nestVerticalGroups:X,filterValue:e=>"this"!=e.type,minRowSimilarity:.1,minValueSimilarity:.1,rowSimilarity:R},void 0,void 0,void 0,r))}function W(...e){const t=[],n={name:e[0][0].name,step:{type:"this"}};return t.push(n),n.step=function(e,t,n){const r=1/e.length;return F(e.map(((e,t)=>k(e,n[t],r))).reduce(((e,t)=>B(e,t,!0))),t)}(e.map((e=>e[0].step)),(e=>{const n={name:U(e,t),step:{type:"this"}};return t.push(n),n}),e.map((e=>t=>{const n=e.find((({name:e})=>t===e));if(null==n)throw new Error(`unknown noun "${t}"`);return n.step}))),t}function U(e,t){for(const{name:n}of t)if(n===e)return U(`${e}'`,t);return e}var H=n(8867),_=n(77340),J=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{l(r.next(e))}catch(t){o(t)}}function s(e){try{l(r.throw(e))}catch(t){o(t)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}l((r=r.apply(e,t||[])).next())}))};function K(e,t,n,r){return J(this,void 0,void 0,(function*(){const i=yield function(e,t,n,r){return J(this,void 0,void 0,(function*(){const i=new Map;return yield(0,H.n)((0,_.of)(e).pipe((0,M.Tn)(),(0,M.Ii)(t,n,Object.assign(Object.assign({},r),{listeners:{onRandom:(e,t,n)=>{let r=i.get(e);null==r&&(r=[],i.set(e,r)),r.push([t.index.join(","),n])}}})))),i}))}(e,t,n,r);return function(e,t){return e.map((({name:e,step:n})=>({name:e,step:ee(n,t)})))}(t,i)}))}function ee(e,t){if("random"===e.type){const n=t.get(e);if(null==n)return{type:"null"};const r=new Map;for(const[e,t]of n){let n=r.get(t);null==n&&(n=[],r.set(t,n)),n.push(e)}const i=Array.from(r.keys()).map((t=>e.children[t]));return 1===i.length?i[0]:{type:"switch",children:[{type:"operation",children:[],identifier:"id"},...i],cases:Array.from(r.values())}}return null==e.children?e:Object.assign(Object.assign({},e),{children:e.children.map((e=>ee(e,t)))})}var te=n(91e3)},16195:function(e,t,n){n.d(t,{u4:function(){return r},Ht:function(){return Z},br:function(){return E},JY:function(){return V},Ii:function(){return D},QV:function(){return C},Tn:function(){return q},TH:function(){return N}});var r,i=n(18170),o=n(80598),a=n(3184),s=n(25900),l=n(21026),c=n(16621),u=n(36431),p=n(66427),d=n(4534),f=n(71556),m=n(77340),h=n(77506),v=n(85314),y=n(55954),g=n(21283),x=n(62598),b=n(54340),w=n(32384),j=n(41952),S=n(96562),M=n(8167);function E(e){return t=>{const n=new a.t(1);return t.pipe((0,u.b)((()=>n.next())),(0,b.f)(n.pipe((0,w.b)(e))),(0,j.x)((()=>n.complete())))}}function O(e,t,n,i,o,a,s){const l=null==o?e:o(e),c=P(n,i.index),u=t[c];return null!=t[c]&&function(e,t){const n=Math.min(e.length,t.length);for(let r=0;r<n;r++)if(e[r]!=t[r])return!1;return!0}(u,i.index)&&(s(l,c),t.splice(c,1)),i.type===r.SET&&(a(l,i.value,c),t.splice(c,0,i.index)),l}function N(){return e=>e.pipe((0,f.z)((e=>e.invalid.value?S.C:(0,s.T)((0,m.of)({index:e.index,type:r.SET,value:e}),e.invalid.observable.pipe((0,y.q)(1),(0,M.h)({index:e.index,type:r.UNSET}))))))}function P(e,t){if(0===t.length)return 0;if(!Array.isArray(e))return 0;const n=t[0];let r=0;for(let i=0;i<n;i++)r+=V(e[i]);return r+P(e[n],t.slice(1))}function Z(e,t,n=t.index){if(0===n.length)return t.type===r.SET?t.value:void 0;const i=n[0],o=Array.isArray(e)?e:[],a=Z(o[i],t,n.slice(1)),s=[],l=Math.max(o.length,i+1);let c=0,u=0;for(let r=0;r<l;r++){const e=r===i?a:o[r];s[r]=e,void 0!==e&&(c+=V(e),u=r+1)}return 0!==c?(s.splice(u),Object.assign(s,{size:c})):void 0}function V(e){return null==e?0:(Array.isArray(e),1)}function C(e){return t=>e(...t.raw).pipe((0,o.U)((e=>1===e.length?[Object.assign(Object.assign({},t),{raw:e[0]})]:e.map(((e,n)=>Object.assign(Object.assign({},t),{raw:e,index:[...t.index,n]}))))))}function z(e){for(const t of e)if(t.value)return!0;return!1}function k(...e){return{observable:(0,s.T)(...e.map((({observable:e})=>e))).pipe((0,l.d)({refCount:!0,bufferSize:1})),value:z(e)}}function D(e,t,n){var r;if(0===e.length)return e=>e;const i=e[0].name,o={},a=Object.assign(Object.assign({grammar:e,compiledGrammar:o,operations:t},n),{maxSymbolDepth:null!==(r=n.maxSymbolDepth)&&void 0!==r?r:100});for(const{name:s,step:l}of e)o[s]=A(l,a);return o[i]}!function(e){e[e.SET=0]="SET",e[e.UNSET=1]="UNSET"}(r||(r={}));const B=(0,c.h)((({invalid:e})=>!e.value));function A(e,t,n){try{const{delay:r,listeners:a}=t,c=[B];if(null!=(null===a||void 0===a?void 0:a.onAfterStep)){const t=a.onAfterStep.bind(null,e);c.push((0,u.b)(t))}null!=n&&null!=r&&c.push((0,p.g)(r)),null!=n&&c.push(n);const d=function(e,t,n){switch(e.type){case"operation":return function(e,t,n){const r=e.children,i=t.operations[e.identifier];if(null==i)throw new Error(`unknown operation "${e.identifier}"`);const o=r.map((e=>A(e,t)));i.includeThis&&o.unshift((e=>e));return e=>e.pipe(I(...o),(0,f.z)((e=>i.execute(e).pipe((0,f.z)((e=>(0,s.T)(...e.map((e=>(0,m.of)(e).pipe(n))))))))))}(e,t,n);case"parallel":return function(e,t,n){return r=>{const i=r.pipe((0,l.d)({refCount:!0}));return(0,s.T)(...e.children.map(((e,r)=>i.pipe((0,o.U)((e=>Object.assign(Object.assign({},e),{index:[...e.index,r]}))),A(e,t,n)))))}}(e,t,n);case"raw":return function(e,t){return n=>n.pipe((0,o.U)((t=>Object.assign(Object.assign({},t),{raw:e.value}))),t)}(e,n);case"sequential":return function(e,t,n){return Q(0,e.children,t,n)}(e,t,n);case"symbol":return function(e,t,n){if(null==(0,g.KD)(e.identifier,t.grammar))throw new Error(`unknown symbol "${e.identifier}"`);return r=>{const i=r.pipe((0,l.d)({refCount:!0,bufferSize:1}));return i.pipe((0,y.q)(1),(0,f.z)((()=>i.pipe((0,o.U)((n=>{var r;const i=null!==(r=n.symbolDepth[e.identifier])&&void 0!==r?r:0;if(i>=t.maxSymbolDepth)throw new Error(`maximum symbol depth (${t.maxSymbolDepth}) reached for symbol "${e.identifier}"`);return Object.assign(Object.assign({},n),{symbolDepth:Object.assign(Object.assign({},n.symbolDepth),{[e.identifier]:i+1})})})),t.compiledGrammar[e.identifier],n))))}}(e,t,n);case"this":return n;case"invert":case"not":return function(e,t,n){const r=A(e.children[0],t);return t=>t.pipe(r,(0,o.U)((t=>Object.assign(Object.assign({},t),{raw:T[e.type](t.raw)}))),n)}(e,t,n);case"add":case"and":case"divide":case"equal":case"greater":case"greaterEqual":case"modulo":case"multiply":case"or":case"smaller":case"smallerEqual":case"subtract":case"unequal":return function(e,t,n){const r=e.children.map((e=>A(e,t)));return t=>t.pipe(I(...r),(0,o.U)((t=>Object.assign(Object.assign({},t),{raw:L[e.type](t.raw[0],t.raw[1])}))),n)}(e,t,n);case"if":return function(e,t,n){const r=A(e.children[0],t),[i,a]=e.children.slice(1).map((e=>A(e,t,n)));return e=>e.pipe(I((e=>e),r),(0,h.v)((({raw:[,e]})=>e)),(0,f.z)((e=>e.pipe((0,o.U)((e=>Object.assign(Object.assign({},e),{raw:e.raw[0]}))),e.key?i:a))))}(e,t,n);case"switch":return function(e,t,n){const r=A(e.children[0],t),i=e.children.slice(1).map((e=>A(e,t,n)));return t=>t.pipe(I((e=>e),r),(0,h.v)((({raw:[,e]})=>e)),(0,f.z)((t=>{const n=e.cases.findIndex((e=>e.includes(t.key)));return-1===n?v.E:t.pipe((0,o.U)((e=>Object.assign(Object.assign({},e),{raw:e.raw[0]}))),i[n])})))}(e,t,n);case"getVariable":return function(e,t){return(0,f.z)((n=>{var r;return(null!==(r=n.variables[e.identifier])&&void 0!==r?r:(0,m.of)(void 0)).pipe(q(n.invalid,n.index,n.variables),t)}))}(e,n);case"setVariable":return function(e,t,n){const r=A(e.children[0],t);return t=>{const i=t.pipe((0,l.d)({refCount:!0})),a=i.pipe(r);return i.pipe((0,o.U)((t=>Object.assign(Object.assign({},t),{variables:Object.assign(Object.assign({},t.variables),{[e.identifier]:a})}))),n)}}(e,t,n);case"return":return e=>e;case"random":return function(e,t,n){var r;const o=e.children.map((e=>A(e,t,n)));let a;if(null!=(null===(r=t.listeners)||void 0===r?void 0:r.onRandom)){const n=t.listeners.onRandom;a=(0,f.z)((t=>t.pipe((0,u.b)({next:r=>n(e,r,t.key)}),o[t.key])))}else a=(0,f.z)((e=>e.pipe(o[e.key])));return n=>n.pipe((0,h.v)((n=>{const r=(0,i.v3)(n.index.join(","),t.seed)/G;let o=0;for(let t=0;t<e.probabilities.length;t++)if(o+=e.probabilities[t],r<=o)return t;return e.probabilities.length-1})),a)}(e,t,n);case"null":return()=>v.E}}(e,t,(e=>e.pipe(...c)));if(null!=(null===a||void 0===a?void 0:a.onBeforeStep)){const t=a.onBeforeStep.bind(null,e);return e=>e.pipe((0,u.b)(t),d)}return d}catch(r){return()=>(0,d._)((()=>r))}}const T={invert:e=>-e,not:e=>!e};const L={add:(e,t)=>e+t,and:(e,t)=>e&&t,divide:(e,t)=>e/t,equal:(e,t)=>e==t,greater:(e,t)=>e>t,greaterEqual:(e,t)=>e>=t,modulo:(e,t)=>e%t,multiply:(e,t)=>e*t,or:(e,t)=>e||t,smaller:(e,t)=>e<t,smallerEqual:(e,t)=>e<=t,subtract:(e,t)=>e-t,unequal:(e,t)=>e!=t};function q(e,t,n){return r=>{let i;return r.pipe((0,o.U)((r=>(null!=i&&i.invalidate(),i=function(){const e=new a.t(1),t={invalidate:()=>{t.value=!0,e.next()},complete:()=>e.complete(),observable:e,value:!1};return t}(),{raw:r,index:null!==t&&void 0!==t?t:[],invalid:null==e?i:k(i,e),variables:null!==n&&void 0!==n?n:{},symbolDepth:{}}))),(0,u.b)({complete:()=>null===i||void 0===i?void 0:i.complete()}))}}const G=Math.pow(2,32);function Q(e,t,n,r){return e>=t.length?r:A(t[e],n,Q(e+1,t,n,r))}function I(...e){return t=>{const n=t.pipe((0,l.d)({refCount:!0})),r=[e=>e,...e];return(0,s.T)(...r.map(((e,t)=>n.pipe(e,(0,o.U)((e=>Object.assign(Object.assign({},e),{index:[...e.index,t]}))))))).pipe((0,h.v)((e=>e.index.slice(0,-1).join(","))),(0,f.z)((t=>t.pipe(function(){return e=()=>[],t=e=>[...e],n=(e,t,n)=>e.splice(n,0,t),r=(e,t)=>e.splice(t,1),i=>i.pipe(N(),E(0),(0,x.R)((([e,i,o],a)=>{for(const s of a)e=O(e,i,o,s,t,n,r),o=Z(o,s);return[e,i,o]}),[e(),[],void 0]),(0,o.U)((([e])=>e)));var e,t,n,r}(),(0,c.h)((t=>t.length===e.length+1)),(0,o.U)((e=>{const[t,...n]=e;return{variables:t.variables,index:t.index.slice(0,-1),invalid:k(...e.map((({invalid:e})=>e))),raw:n.map((({raw:e})=>e)),symbolDepth:t.symbolDepth}}))))))}}},21283:function(e,t,n){n.d(t,{Ib:function(){return r},J:function(){return D},Gc:function(){return i},by:function(){return T},aR:function(){return y},Q3:function(){return z},Dm:function(){return L},SO:function(){return d},BZ:function(){return Z},AJ:function(){return k},Up:function(){return B},Bc:function(){return x},KD:function(){return q},DQ:function(){return Q},z_:function(){return N},BW:function(){return w},IX:function(){return E},hp:function(){return C},Lr:function(){return b},hs:function(){return P},nH:function(){return j},Ej:function(){return V},Sg:function(){return f},rL:function(){return s},pt:function(){return p},NJ:function(){return G},wU:function(){return A},l3:function(){return v},bp:function(){return h},D1:function(){return u},VB:function(){return I}});const r=.001;function i(e,t){return Math.abs(e-t)<r}const o=["if","switch","random","operation"],a=[["parallel"],["sequential"],["or"],["and"],["not"],["equal","unequal"],["smaller","smallerEqual","greater","greaterEqual"],["add","subtract"],["multiply","divide","modulo"],["invert"],["getVariable","setVariable","if","switch","random","symbol","operation","this","raw","return","null"]].reduce(((e,t,n)=>(t.forEach((t=>e[t]=n)),e)),{});function s(e,t){return!o.includes(e.type)&&(n=t,a[e.type]>a[n.type]);var n}var l=n(65201),c=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};function u(e,[t,...n]){let r=Q(t,e);if(null==r)return;const i=[e,r];for(const o of n){if(null==r.children)return;r=r.children[o],i.push(r)}return i}function p(e,t,n,r){if(0===n){const n=e[0];return void G(n,t[0],h(r,n))}const i=t[n],o=e[n];i.children[o]=h(r,...e.slice(0,n+1))}function d(e,t){if(t<0)throw new Error(`can't retrieve step at path index ${t}`);return e[t+1]}function f(e){return e.map((({name:e,step:t})=>({name:e,step:m(t)})))}function m(e){var{path:t,children:n}=e,r=c(e,["path","children"]);return null==n?r:Object.assign(Object.assign({},r),{children:n.map((e=>m(e)))})}function h(e,...t){if(null==e)throw new Error("can't make undefined hierarchical");const n=e;if(Object.isFrozen(n))return(0,l.ZP)(n,(e=>h(e,...t)));if(null==n.path)n.path=t;else{n.path.length=t.length;for(let e=0;e<t.length;e++)n.path[e]=t[e]}if(null!=e.children)for(let r=0;r<e.children.length;r++)e.children[r]=h(e.children[r],...t,r);return n}function v(e){if(null==e)throw new Error("can't make undefined hierarchical");if(Object.isFrozen(e))return(0,l.ZP)(e,(e=>v(e)));for(const t of e)t.step=h(t.step,t.name);return e}function y(e){const t=new Map;for(const r of e)I(r.step,(e=>{if("symbol"!==e.type)return;let n=t.get(r.name);null==n&&(n=[],t.set(r.name,n)),n.push(e.identifier)}));const n={};for(const[r]of t)n[r]=Array.from(new Set(g(r,t)));return n}function g(e,t,n=new Set){n.add(e);const r=t.get(e);return null==r?[]:r.filter((e=>!n.has(e))).reduce(((e,r)=>e.concat(g(r,t,n))),r)}function x(e,t,n){const r=e.filter((e=>b(n,e.name)));if(null==t)return(0,l.vV)(r);const i=new Set(r.reduce(((e,r)=>{const i=t[r.name];return null==i?e:e.concat(i.filter((e=>!b(n,e))))}),[]));return(0,l.vV)(r.concat(e.filter((e=>i.has(e.name)))))}function b(e,t){return t.endsWith(`@${e}`)}function w(e,t){if(null==t)throw new Error("unable to globalize noun with undefined description name");return e.includes("@")?e:`${e}@${t}`}function j(e,t){return t=null!==t&&void 0!==t?t:Z(e),e.endsWith(`@${t}`)?e.slice(0,-t.length-1):e}function S(e,t,n,...r){return(0,l.ZP)(t,(t=>(M(t,n,e),h(t,...r))))}function M(e,t,n){if("symbol"!==e.type){if(null!=e.children)for(const r of e.children)M(r,t,n)}else e.identifier=n(e.identifier,t)}const E=S.bind(null,w);S.bind(null,j);function O(e,t,n){return(0,l.vV)(t.map((t=>{const r=e(t.name,n);return{name:r,step:S(e,t.step,n,r)}})))}const N=O.bind(null,w),P=O.bind(null,j);function Z(e){const t=e.split("@");if(2!==t.length)throw new Error(`"${e}" expected to have exactly one "@"`);return t[1]}function V(e,t){const n="string"===typeof t?t:"symbol"===t.type?t.identifier:void 0;if(null!=n)return j(n,e)}function C(e,t){const n="string"===typeof t?t:"symbol"===t.type?t.identifier:void 0;if(null!=n)return w(n,e)}function z(e,t,n){return(0,l.vV)(e.filter((e=>!b(n,e.name))).concat(t))}function k(e,t,n){var r;return[e,...null!==(r=n[e])&&void 0!==r?r:[]].map((e=>{const n=t.find((({name:t})=>t===e));if(null==n)throw new Error(`unknown noun "${e}"`);return n}))}var D;function B(e,t){const n=Math.min(e.length,t.length);for(let r=0;r<n;r++)if(e[r]!=t[r])return D.None;return e.length<t.length?D.Successor:e.length===t.length?D.Equal:D.Predecessor}function A(e,t){if(null==e||null==t)return!1;if(e==t)return!0;if(e.length!=t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!=t[n])return!1;return!0}function T(e,t){if(t.type!=e)throw new Error(`expected step "${t}" to have type "${e}"`);return t}function L(e){return null!=e}function q(e,t){const n=t.findIndex((({name:t})=>t===e));return-1===n?void 0:n}function G(e,t,n){const r=q(e,t);null!=r&&(t[r].step=n)}function Q(e,t){const n=q(e,t);return null==n?void 0:t[n].step}function I(e,t){if(t(e),null!=e.children)for(const n of e.children)I(n,t)}!function(e){e[e.Predecessor=0]="Predecessor",e[e.Successor=1]="Successor",e[e.Equal=2]="Equal",e[e.None=3]="None"}(D||(D={}))},82714:function(e,t,n){n.d(t,{i:function(){return v}});var r=n(47568),i=n(14924),o=n(26042),a=n(69396),s=n(828),l=n(29815),c=n(70655),u=n(82513),p=n(55050),d=n(65201),f=n(26173),m=n(14671),h=n(38597);function v(e,t){return(0,m.Z)((0,h.XR)((0,h.$e)({type:"gui",valueMap:{},selectionsList:[],hovered:void 0,grammar:[],dependencyMap:{},descriptions:[],selectedDescriptions:[],interpretationDelay:0,requested:void 0,shift:!1,showTui:!1,graphVisualization:!1},g.bind(null,e,t))))}var y=new p.vk(new f.Matrix4,(0,p.i7)(new f.Color(16711680)));function g(e,t,n,p){var f=function(e,t,r){"gui"==p().type&&n({requested:{type:e,data:r,fulfill:function(e){var r=p().requested;t&&t(e);var i=p();"gui"===i.type&&i.requested===r&&n({requested:void 0})}}})},m=function(e){return function(t){return new Promise((function(n){return f("select-condition",n,{patterns:t,title:e})}))}};return{import:function(e){try{var t=(0,u.l3)((0,u.Qc)(e)),r=new Set,i=!0,o=!1,a=void 0;try{for(var s,l=t[Symbol.iterator]();!(i=(s=l.next()).done);i=!0){var c=s.value.name,p=(0,u.BZ)(c);r.add(p)}}catch(d){o=!0,a=d}finally{try{i||null==l.return||l.return()}finally{if(o)throw a}}n({descriptions:Array.from(r).map((function(e){return{name:e,seed:0}})),grammar:t,selectedDescriptions:[],selectionsList:[],valueMap:{},dependencyMap:(0,u.aR)(t),hovered:void 0,requested:void 0,type:"gui"})}catch(f){console.error(f)}},download:function(){var e=p(),t="gui"===e.type?(0,u.Sg)(e.grammar):e.grammar,n=(0,u.y0)(t,void 0,u.lv),r=document.createElement("a");r.href=window.URL.createObjectURL(new Blob([n],{type:"text/plain"})),r.download="descriptions.cgv",r.click()},setShowTui:function(e){n({showTui:e})},selectDescription:function(e,t){var r=p();if("gui"===r.type){var i,o,a=null===(i=r.grammar.find((function(t){return(0,u.Lr)(e,t.name)})))||void 0===i?void 0:i.name;if(!t){if(1===r.selectedDescriptions.length&&r.selectedDescriptions[0]===e)return;var c=Object.entries(r.valueMap);return void n({selectedDescriptions:[e],selectionsList:null==a?[]:[{steps:a,values:c.filter((function(e){return(0,s.Z)(e,1)[0]==a})).reduce((function(e,t){var n=(0,s.Z)(t,2)[1];return null!=n?e.concat(n):e}),[])}]})}if(!r.selectedDescriptions.includes(e))return void n({selectedDescriptions:(0,l.Z)(r.selectedDescriptions).concat([e]),selectionsList:null==a?r.selectionsList:(0,l.Z)(r.selectionsList).concat([{steps:a,values:[]}])});n({selectedDescriptions:r.selectedDescriptions.filter((function(t){return e!==t})),selectionsList:r.selectionsList.filter((function(t){var n=t.steps;return!(0,u.Lr)(e,(0,u.Il)(n)[0])})),hovered:null!=(null===(o=r.hovered)||void 0===o?void 0:o.steps)&&(0,u.Lr)(e,(0,u.Il)(r.hovered.steps)[0])?void 0:r.hovered})}else 1===r.selectedDescriptions.length&&r.selectedDescriptions[0]===e||n({selectedDescriptions:[e],text:(0,u.y0)((0,u.Bc)(r.grammar,void 0,e),u.Ej.bind(null,e),u.lv)})},clearValueMap:function(e){var t=p();"gui"===t.type&&n({valueMap:Object.entries(t.valueMap).filter((function(t){return!(0,s.Z)(t,1)[0].includes("@"+e)})).reduce((function(e,t){var n=(0,s.Z)(t,2),r=n[0],l=n[1];return(0,a.Z)((0,o.Z)({},e),(0,i.Z)({},r,l))}),{})})},pasteNoun:function(){var e=(0,r.Z)((function(e,r,i){var o,a,s,l,d;return(0,c.__generator)(this,(function(c){switch(c.label){case 0:return"gui"!==(o=p()).type||null==o.selectedDescriptions?[2]:(a=(0,u.BZ)(i),s=(0,u.nH)(i,a),l=(0,u.EU)(o.grammar,s,a,e),d=(0,u.zq)(r),[4,(0,u.gx)(o.valueMap,o.selectionsList.filter((function(e){return(0,u.Q)(e.steps,r,d)})),t,m("On what should this noun be copied to?"),(function(){return{type:"symbol",identifier:(0,u.BW)(s,e)}}),o.grammar.concat(l))]);case 1:return n.apply(void 0,[c.sent()]),[2]}}))}));return function(t,n,r){return e.apply(this,arguments)}}(),addDescriptions:function(e){var t=p(),r=t.descriptions,i=t.grammar,o=t.dependencyMap,a=!0,s=!1,l=void 0;try{for(var c,f=function(){var e=c.value;if(-1!==r.findIndex((function(t){return t.name===e.name})))return"continue";var t,n=(0,u.BW)("Start",e.name);-1===i.findIndex((function(e){return e.name===n}))&&(i=(0,d.vV)((0,u.l3)([{name:n,step:null!==(t=e.step)&&void 0!==t?t:{type:"this"}}]).concat(i)));r=[{name:e.name,seed:0}].concat(r)},m=e[Symbol.iterator]();!(a=(c=m.next()).done);a=!0)f()}catch(h){s=!0,l=h}finally{try{a||null==m.return||m.return()}finally{if(s)throw l}}o=(0,u.aR)(i),n({descriptions:r,grammar:i,dependencyMap:o})},deleteDescription:function(e){var t="ID"+e,r=p(),i=r.descriptions,a=r.selectedDescriptions,s=r.grammar,l=r.selectionsList,c=i.filter((function(n){return n.name!=e&&n.name!==t}));n((0,o.Z)({descriptions:c,selectedDescriptions:a.filter((function(n){return n!==e&&n!==t}))},(0,u.tc)(s,null!==l&&void 0!==l?l:[],c.map((function(e){return e.name})))))},deleteAllDescription:function(){var e=p(),t=e.grammar,r=e.selectionsList;n((0,o.Z)({descriptions:[],selectedDescriptions:[]},(0,u.tc)(t,null!==r&&void 0!==r?r:[],[])))},concretizeDescription:function(){var t=(0,r.Z)((function(t,r){var i,s,f,m,h,v,g;return(0,c.__generator)(this,(function(c){switch(c.label){case 0:return"gui"!==(s=p()).type||null==(f=null===(i=s.grammar.find((function(e){return(0,u.Lr)(t,e.name)})))||void 0===i?void 0:i.name)?[2]:(m=(0,u.AJ)(f,s.grammar,s.dependencyMap),[4,(0,u.h$)(y,m,e,{seed:r})]);case 1:return h=c.sent(),v=(0,u.l3)((0,d.vV)((0,l.Z)(h).concat((0,l.Z)(s.grammar.filter((function(e){return!m.includes(e)})))))),n((0,a.Z)((0,o.Z)({},(0,u.tc)(v,null!==(g=s.selectionsList)&&void 0!==g?g:[],s.descriptions.map((function(e){return e.name})))),{dependencyMap:(0,u.aR)(v)})),[2]}}))}));return function(e,n){return t.apply(this,arguments)}}(),setSeed:function(e,t){n({descriptions:p().descriptions.map((function(n){return n.name===e?{name:n.name,seed:t}:n}))})},setText:function(e){var t=p();if("tui"==t.type&&1==t.selectedDescriptions.length)try{var r=(0,u.dk)(e,t.selectedDescriptions[0]);n({text:e,correct:!0,grammar:(0,u.Q3)(t.grammar,r,t.selectedDescriptions[0])})}catch(i){n({text:e,correct:!1,error:i.message})}},setGraphVisualization:function(e){"gui"===p().type&&n({graphVisualization:e})},setType:function(e){var t=p();if(t.type!==e){var r=(0,u.l3)(t.grammar);"tui"===t.type&&t.correct?n({type:"gui",grammar:r,dependencyMap:(0,u.aR)(r),valueMap:{},selectionsList:[],hovered:void 0,requested:void 0,shift:!1}):1==t.selectedDescriptions.length&&n({type:"tui",grammar:t.grammar,text:null==t.selectedDescriptions?"":(0,u.y0)((0,u.Bc)(t.grammar,void 0,t.selectedDescriptions[0]),u.Ej.bind(null,t.selectedDescriptions[0]),u.lv),correct:!0})}},onStartHover:function(e,t){var r,i=p();"gui"==i.type&&(t=null!==(r=null!==t&&void 0!==t?t:i.valueMap[(0,u.zq)(e)])&&void 0!==r?r:[],n({hovered:{steps:e,values:t}}))},onEndHover:function(e){var t,r=p();"gui"==r.type&&(null===(t=r.hovered)||void 0===t?void 0:t.steps)==e&&n((0,a.Z)((0,o.Z)({},r),{hovered:void 0}))},editIndices:function(e,t){var r=p();"gui"==r.type&&n((0,u.bp)(r.valueMap,r.selectionsList,r.hovered,e,t))},autoSelectPattern:function(){var e=(0,r.Z)((function(e){var r,i;return(0,c.__generator)(this,(function(o){switch(o.label){case 0:return"gui"!=(r=p()).type?[2]:(i={},[4,(0,u.O$)(r.selectionsList,r.valueMap,e,t,m("What should be selected?"))]);case 1:return n.apply(void 0,[(i.selectionsList=o.sent(),i)]),[2]}}))}));return function(t){return e.apply(this,arguments)}}(),select:function(e,t,r){var i=p();"gui"==i.type&&(r=null!==r&&void 0!==r?r:i.shift?"add":"replace",n({selectionsList:(0,u.Db)(i.valueMap,i.selectionsList,[{steps:e,values:null==t?void 0:[t]}],r)}))},selectResult:function(e,t){var r=p();"gui"==r.type&&n({selectionsList:(0,u.Db)(r.valueMap,r.selectionsList,[{steps:e,values:[t]}],r.shift?"toggle":"replace")})},selectChildren:function(e,t,r){var i=p();"gui"==i.type&&n({selectionsList:(0,u.Db)(i.valueMap,(0,u.Db)(i.valueMap,i.selectionsList,[{steps:e,values:t}],"remove"),(0,u._P)(i.valueMap,[r],t,(function(e,t){var n=(0,u.Up)(t.before.index,e.before.index);return n===u.J.Successor||n===u.J.Equal}),void 0),"add")})},selectRelated:function(e,t){var r=p();"gui"==r.type&&n({selectionsList:(0,u.Db)(r.valueMap,(0,u.Db)(r.valueMap,r.selectionsList,[e],"remove"),[t],"add")})},unselectAll:function(){"gui"==p().type&&n({selectionsList:[]})},escape:function(){var e=p();"gui"==e.type&&(null==e.requested?n({selectionsList:[]}):n({requested:void 0}))},request:f,cancelRequest:function(){"gui"==p().type&&n({requested:void 0})},insert:function(){var e=(0,r.Z)((function(e,r,i){var a,s,l,d,f=arguments;return(0,c.__generator)(this,(function(c){switch(c.label){case 0:return a=f.length>3&&void 0!==f[3]&&f[3],"gui"!=(s=p()).type?[2]:(l=s.grammar,null!=i&&(l=s.selectedDescriptions.reduce((function(e,t){var n=i(t);return null==n?e:e.concat(n)}),l)),[4,(0,u.$T)(s.valueMap,s.selectionsList,t,m("On what should this transformation be applied?"),e,r,l)]);case 1:return d=c.sent(),a&&(d=(0,o.Z)({descriptions:s.descriptions.map((function(e){return s.selectedDescriptions.includes(e.name)?{name:e.name,seed:Math.random()*Number.MAX_SAFE_INTEGER}:e}))},d)),n(d),[2]}}))}));return function(t,n,r){return e.apply(this,arguments)}}(),removeStep:(0,r.Z)((function(){var r;return(0,c.__generator)(this,(function(i){switch(i.label){case 0:return"gui"!=(r=p()).type?[2]:[4,(0,u.im)(r.valueMap,r.selectionsList,t,m("From what should this transformation be removed?"),e,r.grammar)];case 1:return n.apply(void 0,[i.sent()]),[2]}}))})),renameNoun:function(){var e=(0,r.Z)((function(e){var r;return(0,c.__generator)(this,(function(i){switch(i.label){case 0:return"gui"!=(r=p()).type?[2]:[4,(0,u.lG)(r.valueMap,r.selectionsList,t,m("What should be renamed?"),e,r.grammar)];case 1:return n.apply(void 0,[i.sent()]),[2]}}))}));return function(t){return e.apply(this,arguments)}}(),setName:function(){var e=(0,r.Z)((function(e){var r,i;return(0,c.__generator)(this,(function(o){switch(o.label){case 0:return"gui"!=(r=p()).type||1!==r.selectedDescriptions.length?[2]:[4,(0,u.Sy)(r.valueMap,r.selectionsList,t,m("What should be named?"),null!==(i=(0,u.hp)(r.selectedDescriptions[0],e))&&void 0!==i?i:e,r.grammar)];case 1:return n.apply(void 0,[o.sent()]),[2]}}))}));return function(t){return e.apply(this,arguments)}}(),replace:function(){var e=(0,r.Z)((function(e,r,i){var a,s,l,d,f,h=arguments;return(0,c.__generator)(this,(function(c){switch(c.label){case 0:return a=h.length>3&&void 0!==h[3]&&h[3],s=null!=r?(0,u.zq)(r):void 0,"gui"!=(l=p()).type?[2]:(d=l.grammar,null!=i&&(d=l.selectedDescriptions.reduce((function(e,t){var n=i(t);return null==n?e:e.concat(n)}),d)),[4,(0,u.gx)(l.valueMap,null==r?l.selectionsList:l.selectionsList.filter((function(e){return(0,u.Q)(e.steps,r,s)})),t,m("For what should the new transformation replace the current?"),e,d)]);case 1:return f=c.sent(),a&&(f=(0,o.Z)({descriptions:l.descriptions.map((function(e){return l.selectedDescriptions.includes(e.name)?{name:e.name,seed:Math.random()*Number.MAX_SAFE_INTEGER}:e}))},f)),n(f),[2]}}))}));return function(t,n,r){return e.apply(this,arguments)}}(),setShift:function(e){"gui"==p().type&&n({shift:e})},setInterpretationDelay:function(e){n({interpretationDelay:e})}}}},20138:function(e,t,n){n.d(t,{K:function(){return l},n:function(){return c}});var r=n(26042),i=n(69396),o=n(99534),a=n(85893),s=n(64774),l=[{title:"721 9th Ave, New York, NY 10019",lat:40.7628862,lon:-73.9894495},{title:"Feuerbachstra\xdfe 25, 60325 Frankfurt am Main",lat:50.1157581,lon:8.6629498}];function c(e){var t=e.className,n=(0,o.Z)(e,["className"]);return(0,a.jsxs)("div",(0,i.Z)((0,r.Z)({},n),{className:"".concat(t," bg-light border rounded shadow"),children:[(0,a.jsx)("div",{className:"py-2 px-3 border-bottom border-2",children:"Adresses"}),l.map((function(e){var t=e.title,n=e.lat,r=e.lon;return(0,a.jsx)("div",{style:{fontSize:"x-small"},className:"pointer border-top py-2 px-3",onClick:function(){return s.D1.getState().setLatLon(n,r)},children:t},t)}))]}))}},7585:function(e,t,n){n.d(t,{t:function(){return a}});var r=n(26042),i=n(69396),o=n(55050),a=JSON.parse('[{"position":[-73.991293,0.2,40.7603894],"rotationOffset":152,"url":"/cgv/panoramas/ny/panorama-@40.7603894,-73.991293,152.png"},{"position":[-73.9911163,0.2,40.7605103],"rotationOffset":-115,"url":"/cgv/panoramas/ny/panorama-@40.7605103,-73.9911163,-115.png"},{"position":[-73.9917221,0.2,40.7605683],"rotationOffset":152,"url":"/cgv/panoramas/ny/panorama-@40.7605683,-73.9917221,152.png"},{"position":[-73.9921399,0.2,40.7607437],"rotationOffset":151,"url":"/cgv/panoramas/ny/panorama-@40.7607437,-73.9921399,151.png"},{"position":[-73.9909371,0.2,40.7607584],"rotationOffset":-117,"url":"/cgv/panoramas/ny/panorama-@40.7607584,-73.9909371,-117.png"},{"position":[-73.9924488,0.2,40.7608757],"rotationOffset":151,"url":"/cgv/panoramas/ny/panorama-@40.7608757,-73.9924488,151.png"},{"position":[-73.9928593,0.2,40.7610493],"rotationOffset":151,"url":"/cgv/panoramas/ny/panorama-@40.7610493,-73.9928593,151,152.png"},{"position":[-73.9913927,0.2,40.7612502],"rotationOffset":-35,"url":"/cgv/panoramas/ny/panorama-@40.7612502,-73.9913927,-35,-31.png"},{"position":[-73.9933606,0.2,40.7612609],"rotationOffset":147,"url":"/cgv/panoramas/ny/panorama-@40.7612609,-73.9933606,147.png"},{"position":[-73.9938411,0.2,40.7614897],"rotationOffset":154,"url":"/cgv/panoramas/ny/panorama-@40.7614897,-73.9938411,154.png"},{"position":[-73.9920941,0.2,40.7615683],"rotationOffset":-26,"url":"/cgv/panoramas/ny/panorama-@40.7615683,-73.9920941,-26.png"},{"position":[-73.9925237,0.2,40.7617265],"rotationOffset":-26,"url":"/cgv/panoramas/ny/panorama-@40.7617265,-73.9925237,-26,-30.png"},{"position":[-73.9929245,0.2,40.7619153],"rotationOffset":-23,"url":"/cgv/panoramas/ny/panorama-@40.7619153,-73.9929245,-23.png"},{"position":[-73.9937505,0.2,40.7619205],"rotationOffset":79,"url":"/cgv/panoramas/ny/panorama-@40.7619205,-73.9937505,79,58.png"},{"position":[-73.9933428,0.2,40.7620772],"rotationOffset":-25,"url":"/cgv/panoramas/ny/panorama-@40.7620772,-73.9933428,-25,-28.png"},{"position":[-73.9894495,0.2,40.7628862],"rotationOffset":153,"url":"/cgv/panoramas/ny/panorama-@40.7628862,-73.9894495,153.png"},{"position":[-73.989556,0.2,40.7629306],"rotationOffset":152,"url":"/cgv/panoramas/ny/panorama-@40.7629306,-73.989556,152.png"},{"position":[-73.98966,0.2,40.7629745],"rotationOffset":152,"url":"/cgv/panoramas/ny/panorama-@40.7629745,-73.98966,152.png"},{"position":[-73.9897629,0.2,40.7630177],"rotationOffset":152,"url":"/cgv/panoramas/ny/panorama-@40.7630177,-73.9897629,152.png"},{"position":[-73.9898661,0.2,40.7630604],"rotationOffset":152,"url":"/cgv/panoramas/ny/panorama-@40.7630604,-73.9898661,152.png"},{"position":[-73.9899691,0.2,40.7631037],"rotationOffset":152,"url":"/cgv/panoramas/ny/panorama-@40.7631037,-73.9899691,152.png"},{"position":[-73.9900702,0.2,40.7631467],"rotationOffset":151,"url":"/cgv/panoramas/ny/panorama-@40.7631467,-73.9900702,151.png"},{"position":[-73.9901697,0.2,40.7631887],"rotationOffset":152,"url":"/cgv/panoramas/ny/panorama-@40.7631887,-73.9901697,152.png"},{"position":[-73.9902683,0.2,40.7632302],"rotationOffset":152,"url":"/cgv/panoramas/ny/panorama-@40.7632302,-73.9902683,152.png"},{"position":[-73.9903677,0.2,40.7632717],"rotationOffset":152,"url":"/cgv/panoramas/ny/panorama-@40.7632717,-73.9903677,152.png"},{"position":[-73.9905082,0.2,40.7633307],"rotationOffset":151,"url":"/cgv/panoramas/ny/panorama-@40.7633307,-73.9905082,151.png"},{"position":[-73.9906086,0.2,40.763374],"rotationOffset":151,"url":"/cgv/panoramas/ny/panorama-@40.763374,-73.9906086,151.png"},{"position":[-73.9907119,0.2,40.7634208],"rotationOffset":151,"url":"/cgv/panoramas/ny/panorama-@40.7634208,-73.9907119,151.png"},{"position":[-73.9908192,0.2,40.7634687],"rotationOffset":151,"url":"/cgv/panoramas/ny/panorama-@40.7634687,-73.9908192,151.png"},{"position":[-73.9909259,0.2,40.7635125],"rotationOffset":151,"url":"/cgv/panoramas/ny/panorama-@40.7635125,-73.9909259,151.png"},{"position":[-73.9910314,0.2,40.7635554],"rotationOffset":152,"url":"/cgv/panoramas/ny/panorama-@40.7635554,-73.9910314,152.png"},{"position":[-73.9911354,0.2,40.7635973],"rotationOffset":152,"url":"/cgv/panoramas/ny/panorama-@40.7635973,-73.9911354,152.png"},{"position":[-73.9912372,0.2,40.7636388],"rotationOffset":152,"url":"/cgv/panoramas/ny/panorama-@40.7636388,-73.9912372,152.png"},{"position":[-73.9913394,0.2,40.7636803],"rotationOffset":152,"url":"/cgv/panoramas/ny/panorama-@40.7636803,-73.9913394,152.png"},{"position":[-73.9914375,0.2,40.7637211],"rotationOffset":152,"url":"/cgv/panoramas/ny/panorama-@40.7637211,-73.9914375,152.png"},{"position":[-73.9915457,0.2,40.763767],"rotationOffset":152,"url":"/cgv/panoramas/ny/panorama-@40.763767,-73.9915457,152.png"},{"position":[-73.9916401,0.2,40.7638439],"rotationOffset":143,"url":"/cgv/panoramas/ny/panorama-@40.7638439,-73.9916401,143.png"},{"position":[-73.9917486,0.2,40.7638941],"rotationOffset":153,"url":"/cgv/panoramas/ny/panorama-@40.7638941,-73.9917486,153.png"},{"position":[-73.9918524,0.2,40.7639381],"rotationOffset":153,"url":"/cgv/panoramas/ny/panorama-@40.7639381,-73.9918524,153.png"},{"position":[-73.9919505,0.2,40.7639785],"rotationOffset":152,"url":"/cgv/panoramas/ny/panorama-@40.7639785,-73.9919505,152.png"},{"position":[-73.9920937,0.2,40.7640343],"rotationOffset":149,"url":"/cgv/panoramas/ny/panorama-@40.7640343,-73.9920937,149.png"},{"position":[-73.9922023,0.2,40.7640409],"rotationOffset":153,"url":"/cgv/panoramas/ny/panorama-@40.7640409,-73.9922023,153.png"},{"position":[8.6623931,0.2,50.1146702],"rotationOffset":-182,"url":"/cgv/panoramas/fm/panorama-@50.1146702,8.6623931,-182.png"},{"position":[8.6625474,0.2,50.1146801],"rotationOffset":-154,"url":"/cgv/panoramas/fm/panorama-@50.1146801,8.6625474,-154.png"},{"position":[8.6622397,0.2,50.1146802],"rotationOffset":-184,"url":"/cgv/panoramas/fm/panorama-@50.1146802,8.6622397,-184.png"},{"position":[8.6621095,0.2,50.1146872],"rotationOffset":-185,"url":"/cgv/panoramas/fm/panorama-@50.1146872,8.6621095,-185.png"},{"position":[8.6619715,0.2,50.1146951],"rotationOffset":-188,"url":"/cgv/panoramas/fm/panorama-@50.1146951,8.6619715,-188.png"},{"position":[8.6618412,0.2,50.1147036],"rotationOffset":174,"url":"/cgv/panoramas/fm/panorama-@50.1147036,8.6618412,174.png"},{"position":[8.6626901,0.2,50.1148191],"rotationOffset":-94,"url":"/cgv/panoramas/fm/panorama-@50.1148191,8.6626901,-94.png"},{"position":[8.6616697,0.2,50.114846],"rotationOffset":-97,"url":"/cgv/panoramas/fm/panorama-@50.114846,8.6616697,-97.png"},{"position":[8.662711,0.2,50.1149033],"rotationOffset":-97,"url":"/cgv/panoramas/fm/panorama-@50.1149033,8.662711,-97.png"},{"position":[8.6616896,0.2,50.1149293],"rotationOffset":-101,"url":"/cgv/panoramas/fm/panorama-@50.1149293,8.6616896,-101.png"},{"position":[8.6627286,0.2,50.1149732],"rotationOffset":-101,"url":"/cgv/panoramas/fm/panorama-@50.1149732,8.6627286,-101.png"},{"position":[8.6617209,0.2,50.1150402],"rotationOffset":-104,"url":"/cgv/panoramas/fm/panorama-@50.1150402,8.6617209,-104.png"},{"position":[8.6627538,0.2,50.1150518],"rotationOffset":-102,"url":"/cgv/panoramas/fm/panorama-@50.1150518,8.6627538,-102.png"},{"position":[8.6617453,0.2,50.1151227],"rotationOffset":-102,"url":"/cgv/panoramas/fm/panorama-@50.1151227,8.6617453,-102.png"},{"position":[8.6627812,0.2,50.1151545],"rotationOffset":-98,"url":"/cgv/panoramas/fm/panorama-@50.1151545,8.6627812,-98.png"},{"position":[8.6617704,0.2,50.1152061],"rotationOffset":-105,"url":"/cgv/panoramas/fm/panorama-@50.1152061,8.6617704,-105.png"},{"position":[8.6628064,0.2,50.1152442],"rotationOffset":-100,"url":"/cgv/panoramas/fm/panorama-@50.1152442,8.6628064,-100.png"},{"position":[8.6617932,0.2,50.1152884],"rotationOffset":-100,"url":"/cgv/panoramas/fm/panorama-@50.1152884,8.6617932,-100.png"},{"position":[8.6618155,0.2,50.115368],"rotationOffset":-97,"url":"/cgv/panoramas/fm/panorama-@50.115368,8.6618155,-97.png"},{"position":[8.662853,0.2,50.1154101],"rotationOffset":-99,"url":"/cgv/panoramas/fm/panorama-@50.1154101,8.662853,-99.png"},{"position":[8.661839,0.2,50.1154461],"rotationOffset":-97,"url":"/cgv/panoramas/fm/panorama-@50.1154461,8.661839,-97.png"},{"position":[8.6628751,0.2,50.1154918],"rotationOffset":-99,"url":"/cgv/panoramas/fm/panorama-@50.1154918,8.6628751,-99.png"},{"position":[8.6618617,0.2,50.1155217],"rotationOffset":-101,"url":"/cgv/panoramas/fm/panorama-@50.1155217,8.6618617,-101.png"},{"position":[8.6628988,0.2,50.1155784],"rotationOffset":-98,"url":"/cgv/panoramas/fm/panorama-@50.1155784,8.6628988,-98.png"},{"position":[8.6618911,0.2,50.1156269],"rotationOffset":-99,"url":"/cgv/panoramas/fm/panorama-@50.1156269,8.6618911,-99.png"},{"position":[8.6629243,0.2,50.115672],"rotationOffset":-100,"url":"/cgv/panoramas/fm/panorama-@50.115672,8.6629243,-100.png"},{"position":[8.6619182,0.2,50.1157194],"rotationOffset":-98,"url":"/cgv/panoramas/fm/panorama-@50.1157194,8.6619182,-98.png"},{"position":[8.6629498,0.2,50.1157581],"rotationOffset":257,"url":"/cgv/panoramas/fm/panorama-@50.1157581,8.6629498,257.png"},{"position":[8.6628525,0.2,50.1158494],"rotationOffset":-11,"url":"/cgv/panoramas/fm/panorama-@50.1158494,8.6628525,-11.png"},{"position":[8.6626738,0.2,50.1158712],"rotationOffset":-4,"url":"/cgv/panoramas/fm/panorama-@50.1158712,8.6626738,-4.png"},{"position":[8.6625303,0.2,50.1158865],"rotationOffset":-6,"url":"/cgv/panoramas/fm/panorama-@50.1158865,8.6625303,-6.png"},{"position":[8.662406,0.2,50.1159013],"rotationOffset":-8,"url":"/cgv/panoramas/fm/panorama-@50.1159013,8.662406,-8.png"},{"position":[8.6619545,0.2,50.1159062],"rotationOffset":-65,"url":"/cgv/panoramas/fm/panorama-@50.1159062,8.6619545,-65.png"},{"position":[8.6622687,0.2,50.1159175],"rotationOffset":-6,"url":"/cgv/panoramas/fm/panorama-@50.1159175,8.6622687,-6.png"},{"position":[8.6621347,0.2,50.1159323],"rotationOffset":-8,"url":"/cgv/panoramas/fm/panorama-@50.1159323,8.6621347,-8.png"},{"position":[8.6630039,0.2,50.1160285],"rotationOffset":-96,"url":"/cgv/panoramas/fm/panorama-@50.1160285,8.6630039,-96,-97.png"},{"position":[8.6631204,0.2,50.1163257],"rotationOffset":-100,"url":"/cgv/panoramas/fm/panorama-@50.1163257,8.6631204,-100,-98.png"},{"position":[8.6632372,0.2,50.1167265],"rotationOffset":-100,"url":"/cgv/panoramas/fm/panorama-@50.1167265,8.6632372,-100,-100.png"},{"position":[8.6586113,0.2,50.1169004],"rotationOffset":73,"url":"/cgv/panoramas/fm/panorama-@50.1169004,8.6586113,73,70.png"},{"position":[8.6633554,0.2,50.1171317],"rotationOffset":-100,"url":"/cgv/panoramas/fm/panorama-@50.1171317,8.6633554,-100,-101.png"},{"position":[8.6588044,0.2,50.1172581],"rotationOffset":71,"url":"/cgv/panoramas/fm/panorama-@50.1172581,8.6588044,71,71.png"},{"position":[8.663442,0.2,50.1174098],"rotationOffset":-100,"url":"/cgv/panoramas/fm/panorama-@50.1174098,8.663442,-100,-101.png"},{"position":[8.6590014,0.2,50.1176176],"rotationOffset":74,"url":"/cgv/panoramas/fm/panorama-@50.1176176,8.6590014,74,72.png"},{"position":[8.6600027,0.2,50.1176976],"rotationOffset":-186,"url":"/cgv/panoramas/fm/panorama-@50.1176976,8.6600027,-186,-189.png"},{"position":[8.6593229,0.2,50.1177469],"rotationOffset":-186,"url":"/cgv/panoramas/fm/panorama-@50.1177469,8.6593229,-186,-189.png"},{"position":[8.660359,0.2,50.1177635],"rotationOffset":261,"url":"/cgv/panoramas/fm/panorama-@50.1177635,8.660359,261,260.png"},{"position":[8.6604327,0.2,50.1180577],"rotationOffset":263,"url":"/cgv/panoramas/fm/panorama-@50.1180577,8.6604327,263,261.png"},{"position":[8.6605192,0.2,50.1184347],"rotationOffset":-97,"url":"/cgv/panoramas/fm/panorama-@50.1184347,8.6605192,-97,-96.png"}]').map((function(e){var t=(0,o.dc)(e.position[0],0),n=(0,o.Oz)(e.position[2],0),a=(0,o.jo)(0,0),s=e.position[1]/a;return(0,i.Z)((0,r.Z)({},e),{position:[t,s,n]})}))},59755:function(e,t,n){n.d(t,{AE:function(){return pt},zf:function(){return ut},vx:function(){return te}});var r=n(47568),i=n(26042),o=n(69396),a=n(99534),s=n(828),l=n(70655),c=n(85893),u=n(53359),p=n(18569),d=n(80896),f=n(6493),m=n(15029),h=n(55050),v=n(67294),y=n(46508),g=n(82906),x=n(7585),b=n(712),w=n(20160),j=n(64774),S=(0,w.q)(b.c);function M(){var e=j.D1.getState();return{position:(0,j.bt)(e),rotation:(0,j.H5)(e)}}function E(e){var t=e.children,n=(0,a.Z)(e,["children"]),r=(0,s.Z)((0,w.q_)(M),1)[0],l=r.position,u=r.rotation,p=(0,v.useRef)();return(0,v.useEffect)((function(){var e=j.D1.subscribe((function(e){return(0,j.H5)(e)}),(function(e){return u.start(e)})),t=j.D1.subscribe((function(e){return(0,j.bt)(e)}),(function(e){return l.start(e)})),n=j.D1.subscribe((function(e){return(0,j.bv)(e)}),(function(e){null!=p.current&&(p.current.fov=e,p.current.updateProjectionMatrix())}),{fireImmediately:!0});return function(){e(),t(),n()}}),[u,l]),(0,c.jsx)(S,(0,o.Z)((0,i.Z)({matrixWorldAutoUpdate:void 0,getObjectsByProperty:void 0},n),{ref:p,far:1e3,near:1e-9,position:l,"rotation-order":"YXZ",children:t,rotation:u,makeDefault:!0}))}var O=n(76008),N=n(97322);function P(){var e=(0,N.z)((function(e){return e.gl.domElement}));return(0,O.T2)({onWheel:function(e){var t=e.first,n=(0,s.Z)(e.xy,2)[1],r=(0,s.Z)(e.previous,2)[1];e.event.preventDefault(),t||j.D1.getState().pinch(1+.002*(n-r))},onDrag:function(t){var n=t.first,r=(0,s.Z)(t.xy,2),i=r[0],o=r[1],a=(0,s.Z)(t.previous,2),l=a[0],c=a[1],u=t.buttons;t.event.preventDefault(),n||2!==u||j.D1.getState().drag((i-l)/e.clientHeight,(o-c)/e.clientHeight)},onPinch:function(t){var n=(0,s.Z)(t.da,1)[0],r=t.event,i=t.origin,o=t.memo;if(r.preventDefault(),null==o)return[n,i];var a=(0,s.Z)(o,2),l=a[0],c=a[1];if(null!=l&&j.D1.getState().pinch(n/l),null!=i&&null!=c){var u=(0,s.Z)(i,2),p=u[0],d=u[1],f=(0,s.Z)(c,2),m=f[0],h=f[1];j.D1.getState().drag((p-m)/e.clientHeight,(d-h)/e.clientHeight)}return[n,i]},onPointerDown:function(t){var n=t.buttons;t.event.preventDefault(),2==n&&"requestPointerLock"in e&&e.requestPointerLock()},onPointerUp:function(e){e.event.preventDefault(),"exitPointerLock"in document&&document.exitPointerLock()}},{domTarget:e,eventOptions:{passive:!1}}),function(){var e=(0,v.useRef)({forward:!1,backward:!1,left:!1,right:!1,up:!1,down:!1});(0,v.useEffect)((function(){var t=function(t){switch(t.key){case"e":e.current.up=!0;break;case"q":e.current.down=!0;break;case"w":case"ArrowUp":e.current.forward=!0;break;case"d":case"ArrowRight":e.current.right=!0;break;case"s":case"ArrowDown":e.current.backward=!0;break;case"a":case"ArrowLeft":e.current.left=!0}},n=function(t){switch(t.key){case"e":e.current.up=!1;break;case"q":e.current.down=!1;break;case"w":case"ArrowUp":e.current.forward=!1;break;case"d":case"ArrowRight":e.current.right=!1;break;case"s":case"ArrowDown":e.current.backward=!1;break;case"a":case"ArrowLeft":e.current.left=!1}};return window.addEventListener("keydown",t),window.addEventListener("keyup",n),function(){window.removeEventListener("keydown",t),window.removeEventListener("keyup",n)}}),[]),(0,N.A)((function(t,n){var r=j.D1.getState();if("fly"==r.viewType){var i=n*Z,o=0,a=0,s=0;e.current.left&&(o-=i),e.current.right&&(o+=i),e.current.forward&&(s-=i),e.current.backward&&(s+=i),e.current.up&&(a+=i),e.current.down&&(a-=i),0==o&&0==a&&0==s||r.moveFlyCamera([o,a,s])}}))}(),(0,v.useEffect)((function(){var e=function(e){return e.preventDefault()};return window.addEventListener("contextmenu",e),function(){return window.removeEventListener("contextmenu",e)}}),[]),null}var Z=1e-6;function V(){return(0,c.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",className:"bi bi-box-arrow-left",viewBox:"0 0 16 16",children:[(0,c.jsx)("path",{fillRule:"evenodd",d:"M6 12.5a.5.5 0 0 0 .5.5h8a.5.5 0 0 0 .5-.5v-9a.5.5 0 0 0-.5-.5h-8a.5.5 0 0 0-.5.5v2a.5.5 0 0 1-1 0v-2A1.5 1.5 0 0 1 6.5 2h8A1.5 1.5 0 0 1 16 3.5v9a1.5 1.5 0 0 1-1.5 1.5h-8A1.5 1.5 0 0 1 5 12.5v-2a.5.5 0 0 1 1 0v2z"}),(0,c.jsx)("path",{fillRule:"evenodd",d:"M.146 8.354a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L1.707 7.5H10.5a.5.5 0 0 1 0 1H1.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3z"})]})}function C(){return(0,c.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",className:"bi bi-check2-all",viewBox:"0 0 16 16",children:[(0,c.jsx)("path",{d:"M12.354 4.354a.5.5 0 0 0-.708-.708L5 10.293 1.854 7.146a.5.5 0 1 0-.708.708l3.5 3.5a.5.5 0 0 0 .708 0l7-7zm-4.208 7-.896-.897.707-.707.543.543 6.646-6.647a.5.5 0 0 1 .708.708l-7 7a.5.5 0 0 1-.708 0z"}),(0,c.jsx)("path",{d:"m5.354 7.146.896.897-.707.707-.897-.896a.5.5 0 1 1 .708-.708z"})]})}var z=n(34609),k=n(68617);function D(){return(0,c.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",className:"bi bi-file-earmark-check",viewBox:"0 0 16 16",children:[(0,c.jsx)("path",{d:"M10.854 7.854a.5.5 0 0 0-.708-.708L7.5 9.793 6.354 8.646a.5.5 0 1 0-.708.708l1.5 1.5a.5.5 0 0 0 .708 0l3-3z"}),(0,c.jsx)("path",{d:"M14 14V4.5L9.5 0H4a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2zM9.5 3A1.5 1.5 0 0 0 11 4.5h2V14a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1h5.5v2z"})]})}function B(){return(0,c.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",className:"bi bi-plus",viewBox:"0 0 16 16",children:(0,c.jsx)("path",{d:"M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z"})})}function A(){return(0,c.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",className:"bi bi-shuffle",viewBox:"0 0 16 16",children:[(0,c.jsx)("path",{fillRule:"evenodd",d:"M0 3.5A.5.5 0 0 1 .5 3H1c2.202 0 3.827 1.24 4.874 2.418.49.552.865 1.102 1.126 1.532.26-.43.636-.98 1.126-1.532C9.173 4.24 10.798 3 13 3v1c-1.798 0-3.173 1.01-4.126 2.082A9.624 9.624 0 0 0 7.556 8a9.624 9.624 0 0 0 1.317 1.918C9.828 10.99 11.204 12 13 12v1c-2.202 0-3.827-1.24-4.874-2.418A10.595 10.595 0 0 1 7 9.05c-.26.43-.636.98-1.126 1.532C4.827 11.76 3.202 13 1 13H.5a.5.5 0 0 1 0-1H1c1.798 0 3.173-1.01 4.126-2.082A9.624 9.624 0 0 0 6.444 8a9.624 9.624 0 0 0-1.317-1.918C4.172 5.01 2.796 4 1 4H.5a.5.5 0 0 1-.5-.5z"}),(0,c.jsx)("path",{d:"M13 5.466V1.534a.25.25 0 0 1 .41-.192l2.36 1.966c.12.1.12.284 0 .384l-2.36 1.966a.25.25 0 0 1-.41-.192zm0 9v-3.932a.25.25 0 0 1 .41-.192l2.36 1.966c.12.1.12.284 0 .384l-2.36 1.966a.25.25 0 0 1-.41-.192z"})]})}function T(e){var t,n=e.createDescriptionRequestData,r=e.style,s=e.className,l=e.children,u=(0,a.Z)(e,["createDescriptionRequestData","style","className","children"]),p=(0,g.EB)(),d=p((function(e){return e.descriptions})),f=p((function(e){return e.selectedDescriptions}));return(0,c.jsxs)("div",(0,o.Z)((0,i.Z)({},u),{style:r,className:"".concat(s," bg-light rounded shadow w-100 overflow-hidden border d-flex flex-column"),children:[(0,c.jsxs)("div",{className:"px-3 py-2 border-bottom d-flex flex-row align-items-center",children:[(0,c.jsx)("span",{children:"Descriptions"}),(0,c.jsx)("div",{className:"flex-grow-1"}),(0,c.jsx)(z.Z,{align:{offset:[0,8]},placement:"top",overlay:"Add Description",children:(0,c.jsx)("button",{onClick:function(){return p.getState().request("create-description",(function(e){return p.getState().addDescriptions([{name:e}])}),null==n?void 0:n())},className:"btn text-primary btn-sm",children:(0,c.jsx)(B,{})})})]}),(0,c.jsx)("div",{className:"d-flex flex-column scroll",children:d.map((function(e,n){var r=e.name,i=e.seed;return(0,c.jsxs)("div",{onClick:function(e){return p.getState().selectDescription(r,null!==(t=p.getState().shift)&&void 0!==t&&t)},className:"pointer py-2 ps-3 pe-2 d-flex flex-row align-items-center border-top border-1 ".concat(f.includes(r)?"border-primary border-3 border":""),children:[(0,c.jsx)("span",{className:"overflow-hidden",style:{textOverflow:"ellipsis"},children:r}),(0,c.jsx)("div",{className:"flex-grow-1"}),(0,c.jsx)(z.Z,{align:{offset:[0,5]},placement:"top",overlay:"Concretize",children:(0,c.jsx)("button",{onClick:function(e){e.stopPropagation(),p.getState().concretizeDescription(r,i)},className:"btn btn-sm",children:(0,c.jsx)(D,{})})}),(0,c.jsx)(z.Z,{placement:"top",align:{offset:[0,5]},overlay:"Randomize",children:(0,c.jsx)("button",{onClick:function(e){e.stopPropagation(),p.getState().setSeed(r,i+1)},className:"btn btn-sm",children:(0,c.jsx)(A,{})})}),(0,c.jsx)(z.Z,{placement:"top",align:{offset:[0,5]},overlay:"Delete Description",children:(0,c.jsx)("button",{onClick:function(e){e.stopPropagation(),p.getState().deleteDescription(r)},className:"btn text-danger btn-sm",children:(0,c.jsx)(k.p,{})})})]},r)}))}),l]}))}var L=n(65509);function q(){return(0,c.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",className:"bi bi-card-text",viewBox:"0 0 16 16",children:[(0,c.jsx)("path",{d:"M14.5 3a.5.5 0 0 1 .5.5v9a.5.5 0 0 1-.5.5h-13a.5.5 0 0 1-.5-.5v-9a.5.5 0 0 1 .5-.5h13zm-13-1A1.5 1.5 0 0 0 0 3.5v9A1.5 1.5 0 0 0 1.5 14h13a1.5 1.5 0 0 0 1.5-1.5v-9A1.5 1.5 0 0 0 14.5 2h-13z"}),(0,c.jsx)("path",{d:"M3 5.5a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5zM3 8a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9A.5.5 0 0 1 3 8zm0 2.5a.5.5 0 0 1 .5-.5h6a.5.5 0 0 1 0 1h-6a.5.5 0 0 1-.5-.5z"})]})}function G(e){var t=e.className,n=(0,a.Z)(e,["className"]),r=(0,g.EB)(),s=r((function(e){return e.showTui}));return(0,c.jsx)(z.Z,{placement:"left",overlay:"Text Interface",children:(0,c.jsx)("div",(0,o.Z)((0,i.Z)({},n),{onClick:function(){return r.getState().setShowTui(!s)},className:"".concat(t," d-flex align-items-center justify-content-center btn ").concat(s?"btn-primary":"btn-secondary"," btn-sm "),children:(0,c.jsx)(q,{})}))})}var Q=n(20138),I=n(26173),R=n(82513),$=n(82670),Y=n(29815),X=n(77340),F=n(66974);var W=n(41046);function U(e){var t=e.value,n=e.getSubstep,r=e.className,i=e.defaultValue,o=n(t),a="raw"===o.children[0].type?o.children[0].value:void 0,s="raw"===o.children[1].type?o.children[1].value:void 0,l="raw"===o.children[2].type?o.children[2].value:void 0,u=(0,g.EB)(),p=function(e,r){return u.getState().replace((function(t){var i=n(t);"operation"===i.type&&(i.children[e]={type:"raw",value:r})}),t)};return(0,c.jsxs)("div",{className:r,children:[(0,c.jsx)(W.A,{value:null!==a&&void 0!==a?a:i,type:"number",className:"flex-grow-1 me-2 flex-basis-0 form-control form-control-sm",onBlur:function(e){return p(0,e.target.valueAsNumber)}}),(0,c.jsx)(W.A,{value:null!==s&&void 0!==s?s:i,type:"number",className:"flex-grow-1 me-2 flex-basis-0 form-control form-control-sm",onBlur:function(e){return p(1,e.target.valueAsNumber)}}),(0,c.jsx)(W.A,{value:null!==l&&void 0!==l?l:i,type:"number",className:"flex-grow-1 flex-basis-0 form-control form-control-sm",onBlur:function(e){return p(2,e.target.valueAsNumber)}})]})}function H(e){var t=e.value,n=e.getSubstep,r=e.className,i=e.defaultValue,o=n(t),a="raw"===o.children[0].type?o.children[0].value:void 0,s="raw"===o.children[1].type?o.children[1].value:void 0,l=(0,g.EB)(),u=function(e,r){return l.getState().replace((function(t){var i=n(t);"operation"===i.type&&(i.children[e]={type:"raw",value:r})}),t)};return(0,c.jsxs)("div",{className:r,children:[(0,c.jsx)(W.A,{value:null!==a&&void 0!==a?a:i,type:"number",className:"flex-grow-1 me-2 flex-basis-0 form-control form-control-sm",onBlur:function(e){return u(0,e.target.valueAsNumber)}}),(0,c.jsx)(W.A,{value:null!==s&&void 0!==s?s:i,type:"number",className:"flex-grow-1 flex-basis-0 form-control form-control-sm",onBlur:function(e){return u(1,e.target.valueAsNumber)}})]})}var _=n(11281);var J=n(40872);function K(e){var t=(0,J.Z)({},e);return(0,c.jsxs)("select",(0,o.Z)((0,i.Z)({},t),{children:[(0,c.jsx)("option",{value:"x",children:"X"}),(0,c.jsx)("option",{value:"y",children:"Y"}),(0,c.jsx)("option",{value:"z",children:"Z"})]}))}var ee=function(){return null},te={color:function(e){var t=e.value,n="raw"===t.children[0].type?t.children[0].value:void 0,r=(0,g.EB)();return(0,c.jsx)("input",{value:null!==n&&void 0!==n?n:16711680,type:"color",className:"mx-3 mb-3 w-auto form-control form-control-sm",onChange:function(e){return r.getState().replace((function(t){t.children[0]={type:"raw",value:e.target.value}}),t)}})},point3:function(e){return U({className:"mb-3 d-flex flex-row mx-3",defaultValue:0,getSubstep:function(e){return e},value:e.value})},point2:function(e){return H({className:"mb-3 d-flex flex-row mx-3",defaultValue:0,getSubstep:function(e){return e},value:e.value})},line:function(e){var t=e.value;return"operation"!==t.children[0].type||"operation"!==t.children[1].type?null:(0,c.jsxs)(c.Fragment,{children:["point3"===t.children[0].identifier?(0,c.jsx)(U,{className:"mb-3 d-flex flex-row mx-3",defaultValue:0,getSubstep:function(e){return(0,R.by)("operation",e.children[0])},value:t}):(0,c.jsx)(H,{className:"mb-3 d-flex flex-row mx-3",defaultValue:0,getSubstep:function(e){return(0,R.by)("operation",e.children[0])},value:t}),"point3"===t.children[1].identifier?(0,c.jsx)(U,{className:"mb-3 d-flex flex-row mx-3",defaultValue:0,getSubstep:function(e){return(0,R.by)("operation",e.children[1])},value:t}):(0,c.jsx)(H,{className:"mb-3 d-flex flex-row mx-3",defaultValue:0,getSubstep:function(e){return(0,R.by)("operation",e.children[1])},value:t})]})},face:function(e){var t=e.value,n=(0,g.EB)();return(0,c.jsxs)("div",{className:"d-flex flex-column mx-3",children:[t.children.map((function(e,r){return(0,c.jsxs)("div",{className:"d-flex flex-row align-items-center mb-3",children:["operation"===e.type&&(0,c.jsx)(H,{className:"d-flex flex-row",defaultValue:0,getSubstep:function(e){return(0,R.by)("operation",e.children[r])},value:t}),(0,c.jsx)(z.Z,{placement:"left",overlay:"Delete Point",children:(0,c.jsx)("div",{onClick:function(){return n.getState().replace((function(e){e.children.splice(r,1)}),t)},className:"ms-2 d-flex align-items-center btn-sm btn btn-outline-danger",children:(0,c.jsx)(k.p,{})})})]},r)})),(0,c.jsx)("div",{className:"btn btn-outline-success mb-3",onClick:function(){return function(e,t){var n=(0,s.Z)((0,j.bt)(j.D1.getState()),3),r=n[0],i=n[2],o=(0,h.FP)(0,18),a=(0,h.jo)(Math.round(i*o),18),l=r*o%1*a,c=i*o%1*a;e.getState().replace((function(e){e.children.push({type:"operation",identifier:"point2",children:[{type:"raw",value:l},{type:"raw",value:c}]})}),t)}(n,t)},children:"Add Point"})]})},extrude:function(e){var t=e.value,n="raw"===t.children[0].type?t.children[0].value:void 0,r=(0,g.EB)();return(0,c.jsx)(W.A,{value:null!==n&&void 0!==n?n:16711680,type:"number",className:"mx-3 mb-3 w-auto form-control form-control-sm",onBlur:function(e){return r.getState().replace((function(t){t.children[0]={type:"raw",value:e.target.valueAsNumber}}),t)}})},rotate:function(e){return U({className:"mb-3 d-flex flex-row mx-3",defaultValue:0,getSubstep:function(e){return e},value:e.value})},translate:function(e){return U({className:"mb-3 d-flex flex-row mx-3",defaultValue:0,getSubstep:function(e){return e},value:e.value})},scale:function(e){return U({className:"mb-3 d-flex flex-row mx-3",defaultValue:0,getSubstep:function(e){return e},value:e.value})},size:function(e){var t=e.value,n="raw"===t.children[0].type?t.children[0].value:void 0,r=(0,g.EB)();return(0,c.jsx)(K,{onChange:function(e){return r.getState().replace((function(t){t.children[0]={type:"raw",value:e.currentTarget.value}}),t)},value:null!==n&&void 0!==n?n:"x",className:"form-select mx-3 mb-3 w-auto form-select-sm"})},toFaces:ee,toLines:ee,toPoints:ee,split:function(e){var t,n=e.value,r=(0,s.Z)(n.children,2),i=r[0],o=r[1],a="raw"===i.type?i.value:void 0,l="raw"===o.type?o.value:void 0,u=(0,g.EB)(),p=(0,v.useCallback)((function(e){u.getState().replace((function(t){t.children[1]={type:"raw",value:e}}),n)}),[u,n]);return(0,c.jsxs)("div",{className:"d-flex flex-column mx-3",children:[(0,c.jsx)(_.w,{value:"Axis",className:"mb-3 ",children:(0,c.jsx)(K,{value:a,onChange:function(e){return u.getState().replace((function(t){t.children[0]={type:"raw",value:e.currentTarget.value}}),n)},className:"flex-grow-1 w-auto form-select form-select-sm"})}),(0,c.jsx)(_.v,{value:"Repeat",className:"mb-3",children:(0,c.jsx)("input",{className:"min-w-0 form-check-input",type:"checkbox",checked:!1!==l,onChange:function(e){return p(!!e.target.checked)}})}),!1!==l&&(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(_.v,{value:"Infinite",className:"mb-3",children:(0,c.jsx)("input",{className:"min-w-0 form-check-input",type:"checkbox",checked:!0===l,onChange:function(e){return p(!!e.target.checked||1)}})}),"number"===typeof l&&(0,c.jsx)(_.w,{value:"Repitions",className:"mb-3",children:(0,c.jsx)(W.A,{className:"min-w-0 form-control form-control-sm",type:"number",value:l,onBlur:function(e){return p(isNaN(e.target.valueAsNumber)?1:e.target.valueAsNumber)}})})]}),n.children.slice(2).map((function(e,r){return(0,c.jsxs)(_.w,{value:"Size",className:"mb-3",children:[(0,c.jsx)(W.A,{className:"min-w-0 form-control form-control-sm",type:"number",value:null!==(t="raw"===e.type?e.value:void 0)&&void 0!==t?t:1,onBlur:function(e){return u.getState().replace((function(t){t.children[r+2]={type:"raw",value:e.target.valueAsNumber}}),n)}}),(0,c.jsx)(z.Z,{placement:"left",overlay:"Delete",children:(0,c.jsx)("div",{onClick:function(){return u.getState().replace((function(e){e.children.splice(r+2,1)}),n)},className:"d-flex align-items-center btn-sm ms-2 btn btn-outline-danger",children:(0,c.jsx)(k.p,{})})})]},r)})),(0,c.jsx)("div",{className:"btn btn-outline-success mb-3",onClick:function(){return u.getState().replace((function(e){e.children.push({type:"raw",value:1})}),n)},children:"Add"})]})},gableRoof:function(e){var t,n=e.value,r="raw"===(null===(t=n.children[0])||void 0===t?void 0:t.type)?n.children[0].value:void 0,i=(0,g.EB)();return(0,c.jsx)(_.w,{className:"mx-3 mb-3",value:"rotation",children:(0,c.jsx)(W.A,{value:null!==r&&void 0!==r?r:0,type:"number",className:"mx-3 mb-3 form-control form-control-sm",onBlur:function(e){return i.getState().replace((function(t){t.children[0]={type:"raw",value:e.target.valueAsNumber}}),n)}})})}},ne=n(89101),re=n(4111),ie=n(51438),oe=n(45785),ae=n(82662),se=n(28668),le=n(26626),ce=function(e){(0,se.Z)(n,e);var t=(0,le.Z)(n);function n(e,r,i){var o,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];(0,ie.Z)(this,n),(o=t.call(this)).isTransformControls=!0,o.visible=!1,o.raycaster=new I.Raycaster,o.tempVector=new I.Vector3,o.tempVector2=new I.Vector3,o.tempQuaternion=new I.Quaternion,o.unit={X:new I.Vector3(1,0,0),Y:new I.Vector3(0,1,0),Z:new I.Vector3(0,0,1)},o.pointStart=new I.Vector3,o.pointEnd=new I.Vector3,o.offset=new I.Vector3,o.rotationAxis=new I.Vector3,o.startNorm=new I.Vector3,o.endNorm=new I.Vector3,o.rotationAngle=0,o.cameraPosition=new I.Vector3,o.cameraQuaternion=new I.Quaternion,o.cameraScale=new I.Vector3,o.parentPosition=new I.Vector3,o.parentQuaternion=new I.Quaternion,o.parentQuaternionInv=new I.Quaternion,o.parentScale=new I.Vector3,o.worldPositionStart=new I.Vector3,o.worldQuaternionStart=new I.Quaternion,o.worldScaleStart=new I.Vector3,o.worldPosition=new I.Vector3,o.worldQuaternion=new I.Quaternion,o.worldQuaternionInv=new I.Quaternion,o.worldScale=new I.Vector3,o.eye=new I.Vector3,o.positionStart=new I.Vector3,o.quaternionStart=new I.Quaternion,o.scaleStart=new I.Vector3,o.enabled=!0,o.axis=null,o.mode="translate",o.translationSnap=null,o.rotationSnap=null,o.scaleSnap=null,o.space="world",o.size=1,o.dragging=!1,o.showX=!0,o.showY=!0,o.showZ=!0,o.changeEvent={type:"change"},o.mouseDownEvent={type:"mouseDown",mode:o.mode},o.mouseUpEvent={type:"mouseUp",mode:o.mode},o.objectChangeEvent={type:"objectChange"},o.intersectObjectWithRay=function(e,t,n){for(var r=t.intersectObject(e,!0),i=0;i<r.length;i++)if(r[i].object.visible||n)return r[i];return!1},o.attach=function(e){return o.object=e,o.visible=!0,(0,re.Z)(o)},o.detach=function(){return o.object=void 0,o.visible=!1,o.axis=null,(0,re.Z)(o)},o.reset=function(){return o.enabled?(o.dragging&&void 0!==o.object&&(o.object.position.copy(o.positionStart),o.object.quaternion.copy(o.quaternionStart),o.object.scale.copy(o.scaleStart),o.dispatchEvent(o.changeEvent),o.dispatchEvent(o.objectChangeEvent),o.pointStart.copy(o.pointEnd)),(0,re.Z)(o)):(0,re.Z)(o)},o.updateMatrixWorld=function(){void 0!==o.object&&(o.object.updateMatrixWorld(),null===o.object.parent?console.error("TransformControls: The attached 3D object must be a part of the scene graph."):o.object.parent.matrixWorld.decompose(o.parentPosition,o.parentQuaternion,o.parentScale),o.object.matrixWorld.decompose(o.worldPosition,o.worldQuaternion,o.worldScale),o.parentQuaternionInv.copy(o.parentQuaternion).invert(),o.worldQuaternionInv.copy(o.worldQuaternion).invert()),o.camera.updateMatrixWorld(),o.camera.matrixWorld.decompose(o.cameraPosition,o.cameraQuaternion,o.cameraScale),o.eye.copy(o.cameraPosition).sub(o.worldPosition).normalize(),(0,oe.Z)(((0,re.Z)(o),(0,ae.Z)(n.prototype)),"updateMatrixWorld",o).call(o)},o.pointerHover=function(e){if(void 0!==o.object&&!0!==o.dragging){o.raycaster.setFromCamera(e,o.camera);var t=o.intersectObjectWithRay(o.gizmo.picker[o.mode],o.raycaster);o.axis=t?t.object.name:null}},o.pointerDown=function(e){if(void 0!==o.object&&!0!==o.dragging&&0===e.button&&null!==o.axis){o.raycaster.setFromCamera(e,o.camera);var t=o.intersectObjectWithRay(o.plane,o.raycaster,!0);if(t){var n=o.space;if("scale"===o.mode?n="local":"E"!==o.axis&&"XYZE"!==o.axis&&"XYZ"!==o.axis||(n="world"),"local"===n&&"rotate"===o.mode){var r=o.rotationSnap;"X"===o.axis&&r&&(o.object.rotation.x=Math.round(o.object.rotation.x/r)*r),"Y"===o.axis&&r&&(o.object.rotation.y=Math.round(o.object.rotation.y/r)*r),"Z"===o.axis&&r&&(o.object.rotation.z=Math.round(o.object.rotation.z/r)*r)}o.object.updateMatrixWorld(),o.object.parent&&o.object.parent.updateMatrixWorld(),o.positionStart.copy(o.object.position),o.quaternionStart.copy(o.object.quaternion),o.scaleStart.copy(o.object.scale),o.object.matrixWorld.decompose(o.worldPositionStart,o.worldQuaternionStart,o.worldScaleStart),o.pointStart.copy(t.point).sub(o.worldPositionStart)}o.dragging=!0,o.mouseDownEvent.mode=o.mode,o.dispatchEvent(o.mouseDownEvent)}},o.pointerMove=function(e){var t=o.axis,n=o.mode,r=o.object,i=o.space;if("scale"===n?i="local":"E"!==t&&"XYZE"!==t&&"XYZ"!==t||(i="world"),void 0!==r&&null!==t&&!1!==o.dragging&&-1===e.button){o.raycaster.setFromCamera(e,o.camera);var a=o.intersectObjectWithRay(o.plane,o.raycaster,!0);if(a){if(o.pointEnd.copy(a.point).sub(o.worldPositionStart),"translate"===n)o.offset.copy(o.pointEnd).sub(o.pointStart),"local"===i&&"XYZ"!==t&&o.offset.applyQuaternion(o.worldQuaternionInv),-1===t.indexOf("X")&&(o.offset.x=0),-1===t.indexOf("Y")&&(o.offset.y=0),-1===t.indexOf("Z")&&(o.offset.z=0),"local"===i&&"XYZ"!==t?o.offset.applyQuaternion(o.quaternionStart).divide(o.parentScale):o.offset.applyQuaternion(o.parentQuaternionInv).divide(o.parentScale),r.position.copy(o.offset).add(o.positionStart),o.translationSnap&&("local"===i&&(r.position.applyQuaternion(o.tempQuaternion.copy(o.quaternionStart).invert()),-1!==t.search("X")&&(r.position.x=Math.round(r.position.x/o.translationSnap)*o.translationSnap),-1!==t.search("Y")&&(r.position.y=Math.round(r.position.y/o.translationSnap)*o.translationSnap),-1!==t.search("Z")&&(r.position.z=Math.round(r.position.z/o.translationSnap)*o.translationSnap),r.position.applyQuaternion(o.quaternionStart)),"world"===i&&(r.parent&&r.position.add(o.tempVector.setFromMatrixPosition(r.parent.matrixWorld)),-1!==t.search("X")&&(r.position.x=Math.round(r.position.x/o.translationSnap)*o.translationSnap),-1!==t.search("Y")&&(r.position.y=Math.round(r.position.y/o.translationSnap)*o.translationSnap),-1!==t.search("Z")&&(r.position.z=Math.round(r.position.z/o.translationSnap)*o.translationSnap),r.parent&&r.position.sub(o.tempVector.setFromMatrixPosition(r.parent.matrixWorld))));else if("scale"===n){if(-1!==t.search("XYZ")){var s=o.pointEnd.length()/o.pointStart.length();o.pointEnd.dot(o.pointStart)<0&&(s*=-1),o.tempVector2.set(s,s,s)}else o.tempVector.copy(o.pointStart),o.tempVector2.copy(o.pointEnd),o.tempVector.applyQuaternion(o.worldQuaternionInv),o.tempVector2.applyQuaternion(o.worldQuaternionInv),o.tempVector2.divide(o.tempVector),-1===t.search("X")&&(o.tempVector2.x=1),-1===t.search("Y")&&(o.tempVector2.y=1),-1===t.search("Z")&&(o.tempVector2.z=1);r.scale.copy(o.scaleStart).multiply(o.tempVector2),o.scaleSnap&&o.object&&(-1!==t.search("X")&&(o.object.scale.x=Math.round(r.scale.x/o.scaleSnap)*o.scaleSnap||o.scaleSnap),-1!==t.search("Y")&&(r.scale.y=Math.round(r.scale.y/o.scaleSnap)*o.scaleSnap||o.scaleSnap),-1!==t.search("Z")&&(r.scale.z=Math.round(r.scale.z/o.scaleSnap)*o.scaleSnap||o.scaleSnap))}else if("rotate"===n){o.offset.copy(o.pointEnd).sub(o.pointStart);var l=20/o.worldPosition.distanceTo(o.tempVector.setFromMatrixPosition(o.camera.matrixWorld));"E"===t?(o.rotationAxis.copy(o.eye),o.rotationAngle=o.pointEnd.angleTo(o.pointStart),o.startNorm.copy(o.pointStart).normalize(),o.endNorm.copy(o.pointEnd).normalize(),o.rotationAngle*=o.endNorm.cross(o.startNorm).dot(o.eye)<0?1:-1):"XYZE"===t?(o.rotationAxis.copy(o.offset).cross(o.eye).normalize(),o.rotationAngle=o.offset.dot(o.tempVector.copy(o.rotationAxis).cross(o.eye))*l):"X"!==t&&"Y"!==t&&"Z"!==t||(o.rotationAxis.copy(o.unit[t]),o.tempVector.copy(o.unit[t]),"local"===i&&o.tempVector.applyQuaternion(o.worldQuaternion),o.rotationAngle=o.offset.dot(o.tempVector.cross(o.eye).normalize())*l),o.rotationSnap&&(o.rotationAngle=Math.round(o.rotationAngle/o.rotationSnap)*o.rotationSnap),"local"===i&&"E"!==t&&"XYZE"!==t?(r.quaternion.copy(o.quaternionStart),r.quaternion.multiply(o.tempQuaternion.setFromAxisAngle(o.rotationAxis,o.rotationAngle)).normalize()):(o.rotationAxis.applyQuaternion(o.parentQuaternionInv),r.quaternion.copy(o.tempQuaternion.setFromAxisAngle(o.rotationAxis,o.rotationAngle)),r.quaternion.multiply(o.quaternionStart).normalize())}o.dispatchEvent(o.changeEvent),o.dispatchEvent(o.objectChangeEvent)}}},o.pointerUp=function(e){0===e.button&&(o.dragging&&null!==o.axis&&(o.mouseUpEvent.mode=o.mode,o.dispatchEvent(o.mouseUpEvent)),o.dragging=!1,o.axis=null)},o.getPointer=function(e){var t;if(o.domElement&&(null===(t=o.domElement.ownerDocument)||void 0===t?void 0:t.pointerLockElement))return{x:0,y:0,button:e.button};var n,r=e.changedTouches?e.changedTouches[0]:e,i=null===(n=o.domElement)||void 0===n?void 0:n.getBoundingClientRect();return{x:(r.clientX-i.left)/i.width*2-1,y:-(r.clientY-i.top)/i.height*2+1,button:e.button}},o.onPointerHover=function(e){if(o.enabled)switch(e.pointerType){case"mouse":case"pen":o.pointerHover(o.getPointer(e))}},o.onPointerDown=function(e){o.enabled&&o.domElement&&(o.domElement.style.touchAction="none",o.domElement.ownerDocument.addEventListener("pointermove",o.onPointerMove),o.pointerHover(o.getPointer(e)),o.pointerDown(o.getPointer(e)))},o.onPointerMove=function(e){o.enabled&&o.pointerMove(o.getPointer(e))},o.onPointerUp=function(e){o.enabled&&o.domElement&&(o.domElement.style.touchAction="",o.domElement.ownerDocument.removeEventListener("pointermove",o.onPointerMove),o.pointerUp(o.getPointer(e)))},o.getMode=function(){return o.mode},o.setMode=function(e){o.mode=e},o.setTranslationSnap=function(e){o.translationSnap=e},o.setRotationSnap=function(e){o.rotationSnap=e},o.setScaleSnap=function(e){o.scaleSnap=e},o.setSize=function(e){o.size=e},o.setSpace=function(e){o.space=e},o.update=function(){console.warn("THREE.TransformControls: update function has no more functionality and therefore has been deprecated.")},o.connect=function(e){e===document&&console.error('THREE.OrbitControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),o.domElement=e,o.domElement.addEventListener("pointerdown",o.onPointerDown),o.domElement.addEventListener("pointermove",o.onPointerHover),o.domElement.ownerDocument.addEventListener("pointerup",o.onPointerUp)},o.dispose=function(){var e,t,n,r,i,a;null===(e=o.domElement)||void 0===e||e.removeEventListener("pointerdown",o.onPointerDown),null===(t=o.domElement)||void 0===t||t.removeEventListener("pointermove",o.onPointerHover),null===(n=o.domElement)||void 0===n||null===(r=n.ownerDocument)||void 0===r||r.removeEventListener("pointermove",o.onPointerMove),null===(i=o.domElement)||void 0===i||null===(a=i.ownerDocument)||void 0===a||a.removeEventListener("pointerup",o.onPointerUp),o.traverse((function(e){var t=e;t.geometry&&t.geometry.dispose(),t.material&&t.material.dispose()}))},o.domElement=i,o.camera=r,o.gizmo=new ue(e,a),o.add(o.gizmo),o.plane=new pe,o.add(o.plane);var s=function(e,t){var n=t;Object.defineProperty((0,re.Z)(o),e,{get:function(){return void 0!==n?n:t},set:function(t){n!==t&&(n=t,this.plane[e]=t,this.gizmo[e]=t,this.dispatchEvent({type:e+"-changed",value:t}),this.dispatchEvent(this.changeEvent))}}),o[e]=t,o.plane[e]=t,o.gizmo[e]=t};return s("camera",o.camera),s("object",o.object),s("enabled",o.enabled),s("axis",o.axis),s("mode",o.mode),s("translationSnap",o.translationSnap),s("rotationSnap",o.rotationSnap),s("scaleSnap",o.scaleSnap),s("space",o.space),s("size",o.size),s("dragging",o.dragging),s("showX",o.showX),s("showY",o.showY),s("showZ",o.showZ),s("worldPosition",o.worldPosition),s("worldPositionStart",o.worldPositionStart),s("worldQuaternion",o.worldQuaternion),s("worldQuaternionStart",o.worldQuaternionStart),s("cameraPosition",o.cameraPosition),s("cameraQuaternion",o.cameraQuaternion),s("pointStart",o.pointStart),s("pointEnd",o.pointEnd),s("rotationAxis",o.rotationAxis),s("rotationAngle",o.rotationAngle),s("eye",o.eye),void 0!==i&&o.connect(i),o}return n}(I.Object3D),ue=function(e){(0,se.Z)(n,e);var t=(0,le.Z)(n);function n(e,r){var i;(0,ie.Z)(this,n),(i=t.call(this)).isTransformControlsGizmo=!0,i.type="TransformControlsGizmo",i.tempVector=new I.Vector3(0,0,0),i.tempEuler=new I.Euler,i.alignVector=new I.Vector3(0,1,0),i.zeroVector=new I.Vector3(0,0,0),i.lookAtMatrix=new I.Matrix4,i.tempQuaternion=new I.Quaternion,i.tempQuaternion2=new I.Quaternion,i.identityQuaternion=new I.Quaternion,i.unitX=new I.Vector3(1,0,0),i.unitY=new I.Vector3(0,1,0),i.unitZ=new I.Vector3(0,0,1),i.rotationAxis=new I.Vector3,i.cameraPosition=new I.Vector3,i.worldPositionStart=new I.Vector3,i.worldQuaternionStart=new I.Quaternion,i.worldPosition=new I.Vector3,i.worldQuaternion=new I.Quaternion,i.eye=new I.Vector3,i.camera=null,i.enabled=!0,i.axis=null,i.mode="translate",i.space="world",i.size=1,i.dragging=!1,i.showX=!0,i.showY=!0,i.showZ=!0,i.updateMatrixWorld=function(){var e=function(e){var t=o[e];t.visible=!0,t.rotation.set(0,0,0),t.position.copy(i.worldPosition);var n=void 0;if(n=i.camera.isOrthographicCamera?(i.camera.top-i.camera.bottom)/i.camera.zoom:i.worldPosition.distanceTo(i.cameraPosition)*Math.min(1.9*Math.tan(Math.PI*i.camera.fov/360)/i.camera.zoom,7),t.scale.set(1,1,1).multiplyScalar(n*i.size/7),"helper"===t.tag)return t.visible=!1,"AXIS"===t.name?(t.position.copy(i.worldPositionStart),t.visible=!!i.axis,"X"===i.axis&&(i.tempQuaternion.setFromEuler(i.tempEuler.set(0,0,0)),t.quaternion.copy(r).multiply(i.tempQuaternion),Math.abs(i.alignVector.copy(i.unitX).applyQuaternion(r).dot(i.eye))>.9&&(t.visible=!1)),"Y"===i.axis&&(i.tempQuaternion.setFromEuler(i.tempEuler.set(0,0,Math.PI/2)),t.quaternion.copy(r).multiply(i.tempQuaternion),Math.abs(i.alignVector.copy(i.unitY).applyQuaternion(r).dot(i.eye))>.9&&(t.visible=!1)),"Z"===i.axis&&(i.tempQuaternion.setFromEuler(i.tempEuler.set(0,Math.PI/2,0)),t.quaternion.copy(r).multiply(i.tempQuaternion),Math.abs(i.alignVector.copy(i.unitZ).applyQuaternion(r).dot(i.eye))>.9&&(t.visible=!1)),"XYZE"===i.axis&&(i.tempQuaternion.setFromEuler(i.tempEuler.set(0,Math.PI/2,0)),i.alignVector.copy(i.rotationAxis),t.quaternion.setFromRotationMatrix(i.lookAtMatrix.lookAt(i.zeroVector,i.alignVector,i.unitY)),t.quaternion.multiply(i.tempQuaternion),t.visible=i.dragging),"E"===i.axis&&(t.visible=!1)):"START"===t.name?(t.position.copy(i.worldPositionStart),t.visible=i.dragging):"END"===t.name?(t.position.copy(i.worldPosition),t.visible=i.dragging):"DELTA"===t.name?(t.position.copy(i.worldPositionStart),t.quaternion.copy(i.worldQuaternionStart),i.tempVector.set(1e-10,1e-10,1e-10).add(i.worldPositionStart).sub(i.worldPosition).multiplyScalar(-1),i.tempVector.applyQuaternion(i.worldQuaternionStart.clone().invert()),t.scale.copy(i.tempVector),t.visible=i.dragging):(t.quaternion.copy(r),i.dragging?t.position.copy(i.worldPositionStart):t.position.copy(i.worldPosition),i.axis&&(t.visible=-1!==i.axis.search(t.name))),"continue";if(t.quaternion.copy(r),"translate"===i.mode||"scale"===i.mode){var a=.99;"X"!==t.name&&"XYZX"!==t.name||Math.abs(i.alignVector.copy(i.unitX).applyQuaternion(r).dot(i.eye))>a&&(t.scale.set(1e-10,1e-10,1e-10),t.visible=!1),"Y"!==t.name&&"XYZY"!==t.name||Math.abs(i.alignVector.copy(i.unitY).applyQuaternion(r).dot(i.eye))>a&&(t.scale.set(1e-10,1e-10,1e-10),t.visible=!1),"Z"!==t.name&&"XYZZ"!==t.name||Math.abs(i.alignVector.copy(i.unitZ).applyQuaternion(r).dot(i.eye))>a&&(t.scale.set(1e-10,1e-10,1e-10),t.visible=!1),"XY"===t.name&&Math.abs(i.alignVector.copy(i.unitZ).applyQuaternion(r).dot(i.eye))<.2&&(t.scale.set(1e-10,1e-10,1e-10),t.visible=!1),"YZ"===t.name&&Math.abs(i.alignVector.copy(i.unitX).applyQuaternion(r).dot(i.eye))<.2&&(t.scale.set(1e-10,1e-10,1e-10),t.visible=!1),"XZ"===t.name&&Math.abs(i.alignVector.copy(i.unitY).applyQuaternion(r).dot(i.eye))<.2&&(t.scale.set(1e-10,1e-10,1e-10),t.visible=!1),-1!==t.name.search("X")&&(i.alignVector.copy(i.unitX).applyQuaternion(r).dot(i.eye)<0?"fwd"===t.tag?t.visible=!1:t.scale.x*=-1:"bwd"===t.tag&&(t.visible=!1)),-1!==t.name.search("Y")&&(i.alignVector.copy(i.unitY).applyQuaternion(r).dot(i.eye)<0?"fwd"===t.tag?t.visible=!1:t.scale.y*=-1:"bwd"===t.tag&&(t.visible=!1)),-1!==t.name.search("Z")&&(i.alignVector.copy(i.unitZ).applyQuaternion(r).dot(i.eye)<0?"fwd"===t.tag?t.visible=!1:t.scale.z*=-1:"bwd"===t.tag&&(t.visible=!1))}else"rotate"===i.mode&&(i.tempQuaternion2.copy(r),i.alignVector.copy(i.eye).applyQuaternion(i.tempQuaternion.copy(r).invert()),-1!==t.name.search("E")&&t.quaternion.setFromRotationMatrix(i.lookAtMatrix.lookAt(i.eye,i.zeroVector,i.unitY)),"X"===t.name&&(i.tempQuaternion.setFromAxisAngle(i.unitX,Math.atan2(-i.alignVector.y,i.alignVector.z)),i.tempQuaternion.multiplyQuaternions(i.tempQuaternion2,i.tempQuaternion),t.quaternion.copy(i.tempQuaternion)),"Y"===t.name&&(i.tempQuaternion.setFromAxisAngle(i.unitY,Math.atan2(i.alignVector.x,i.alignVector.z)),i.tempQuaternion.multiplyQuaternions(i.tempQuaternion2,i.tempQuaternion),t.quaternion.copy(i.tempQuaternion)),"Z"===t.name&&(i.tempQuaternion.setFromAxisAngle(i.unitZ,Math.atan2(i.alignVector.y,i.alignVector.x)),i.tempQuaternion.multiplyQuaternions(i.tempQuaternion2,i.tempQuaternion),t.quaternion.copy(i.tempQuaternion)));t.visible=t.visible&&(-1===t.name.indexOf("X")||i.showX),t.visible=t.visible&&(-1===t.name.indexOf("Y")||i.showY),t.visible=t.visible&&(-1===t.name.indexOf("Z")||i.showZ),t.visible=t.visible&&(-1===t.name.indexOf("E")||i.showX&&i.showY&&i.showZ),t.material.tempOpacity=t.material.tempOpacity||t.material.opacity,t.material.tempColor=t.material.tempColor||t.material.color.clone(),t.material.color.copy(t.material.tempColor),t.material.opacity=t.material.tempOpacity,i.enabled?i.axis&&(t.name===i.axis||i.axis.split("").some((function(e){return t.name===e}))?(t.material.opacity=1,t.material.color.lerp(new I.Color(1,1,1),.5)):(t.material.opacity*=.25,t.material.color.lerp(new I.Color(1,1,1),.5))):(t.material.opacity*=.5,t.material.color.lerp(new I.Color(1,1,1),.5))},t=i.space;"scale"===i.mode&&(t="local");var r="local"===t?i.worldQuaternion:i.identityQuaternion;i.gizmo.translate.visible="translate"===i.mode,i.gizmo.rotate.visible="rotate"===i.mode,i.gizmo.scale.visible="scale"===i.mode,i.helper.translate.visible="translate"===i.mode,i.helper.rotate.visible="rotate"===i.mode,i.helper.scale.visible="scale"===i.mode;var o=[];o=(o=(o=o.concat(i.picker[i.mode].children)).concat(i.gizmo[i.mode].children)).concat(i.helper[i.mode].children);for(var a=0;a<o.length;a++)e(a);(0,oe.Z)(((0,re.Z)(i),(0,ae.Z)(n.prototype)),"updateMatrixWorld",i).call(i)};var o=new I.MeshBasicMaterial({depthTest:r,depthWrite:r,transparent:!0,side:I.DoubleSide,fog:!1,toneMapped:!1}),a=new I.LineBasicMaterial({depthTest:r,depthWrite:r,transparent:!0,linewidth:1,fog:!1,toneMapped:!1}),s=o.clone();s.opacity=.15;var l=o.clone();l.opacity=.33;var c=o.clone();c.color.set(16711680);var u=o.clone();u.color.set(65280);var p=o.clone();p.color.set(255);var d=o.clone();d.opacity=.25;var f=d.clone();f.color.set(16776960);var m=d.clone();m.color.set(65535);var h=d.clone();h.color.set(16711935),o.clone().color.set(16776960);var v=a.clone();v.color.set(16711680);var y=a.clone();y.color.set(65280);var g=a.clone();g.color.set(255);var x=a.clone();x.color.set(65535);var b=a.clone();b.color.set(16711935);var w=a.clone();w.color.set(16776960);var j=a.clone();j.color.set(7895160);var S=w.clone();S.opacity=.25;var M=new I.CylinderGeometry(0,.05,.2,12,1,!1),E=new I.SphereGeometry(.035),O=new I.BoxGeometry(.125,.125,.125),N=new I.BufferGeometry;N.setAttribute("position",new I.Float32BufferAttribute([0,0,0,e,0,0],3));var P=function(e,t){for(var n=new I.BufferGeometry,r=[],i=0;i<=64*t;++i)r.push(0,Math.cos(i/32*Math.PI)*e,Math.sin(i/32*Math.PI)*e);return n.setAttribute("position",new I.Float32BufferAttribute(r,3)),n},Z={X:[[new I.Mesh(M,c),[e,0,0],[0,0,-Math.PI/2],null,"fwd"],[new I.Mesh(M,c),[e,0,0],[0,0,Math.PI/2],null,"bwd"],[new I.Line(N,v)],[new I.Mesh(E,c)]],Y:[[new I.Mesh(M,u),[0,e,0],null,null,"fwd"],[new I.Mesh(M,u),[0,e,0],[Math.PI,0,0],null,"bwd"],[new I.Line(N,y),null,[0,0,Math.PI/2]],[new I.Mesh(E,u)]],Z:[[new I.Mesh(M,p),[0,0,e],[Math.PI/2,0,0],null,"fwd"],[new I.Mesh(M,p),[0,0,e],[-Math.PI/2,0,0],null,"bwd"],[new I.Line(N,g),null,[0,-Math.PI/2,0]],[new I.Mesh(E,p)]],XYZ:[[new I.Mesh(new I.OctahedronGeometry(.1,0),d.clone()),[0,0,0],[0,0,0]]],XY:[[new I.Mesh(new I.PlaneGeometry(.295,.295),f.clone()),[.15,.15,0]],[new I.Line(N,w),[.18,.3,0],null,[.125,1,1]],[new I.Line(N,w),[.3,.18,0],[0,0,Math.PI/2],[.125,1,1]]],YZ:[[new I.Mesh(new I.PlaneGeometry(.295,.295),m.clone()),[0,.15,.15],[0,Math.PI/2,0]],[new I.Line(N,x),[0,.18,.3],[0,0,Math.PI/2],[.125,1,1]],[new I.Line(N,x),[0,.3,.18],[0,-Math.PI/2,0],[.125,1,1]]],XZ:[[new I.Mesh(new I.PlaneGeometry(.295,.295),h.clone()),[.15,0,.15],[-Math.PI/2,0,0]],[new I.Line(N,b),[.18,0,.3],null,[.125,1,1]],[new I.Line(N,b),[.3,0,.18],[0,-Math.PI/2,0],[.125,1,1]]]},V={X:[[new I.Mesh(new I.CylinderGeometry(.1,0,e,4,1,!1),s),[.6*e,0,0],[0,0,-Math.PI/2]]],Y:[[new I.Mesh(new I.CylinderGeometry(.1,0,e,4,1,!1),s),[0,.6*e,0]]],Z:[[new I.Mesh(new I.CylinderGeometry(.1,0,e,4,1,!1),s),[0,0,.6*e],[Math.PI/2,0,0]]],XYZ:[[new I.Mesh(new I.OctahedronGeometry(.2,0),s)]],XY:[[new I.Mesh(new I.PlaneGeometry(.4,.4),s),[.2,.2,0]]],YZ:[[new I.Mesh(new I.PlaneGeometry(.4,.4),s),[0,.2,.2],[0,Math.PI/2,0]]],XZ:[[new I.Mesh(new I.PlaneGeometry(.4,.4),s),[.2,0,.2],[-Math.PI/2,0,0]]]},C={START:[[new I.Mesh(new I.OctahedronGeometry(.01,2),l),null,null,null,"helper"]],END:[[new I.Mesh(new I.OctahedronGeometry(.01,2),l),null,null,null,"helper"]],DELTA:[[new I.Line(function(){var e=new I.BufferGeometry;return e.setAttribute("position",new I.Float32BufferAttribute([0,0,0,1,1,1],3)),e}(),l),null,null,null,"helper"]],X:[[new I.Line(N,l.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new I.Line(N,l.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new I.Line(N,l.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},z={X:[[new I.Line(P(1,.5),v)],[new I.Mesh(new I.OctahedronGeometry(.04,0),c),[0,0,.99],null,[1,3,1]]],Y:[[new I.Line(P(1,.5),y),null,[0,0,-Math.PI/2]],[new I.Mesh(new I.OctahedronGeometry(.04,0),u),[0,0,.99],null,[3,1,1]]],Z:[[new I.Line(P(1,.5),g),null,[0,Math.PI/2,0]],[new I.Mesh(new I.OctahedronGeometry(.04,0),p),[.99,0,0],null,[1,3,1]]],E:[[new I.Line(P(1.25,1),S),null,[0,Math.PI/2,0]],[new I.Mesh(new I.CylinderGeometry(.03,0,.15,4,1,!1),S),[1.17,0,0],[0,0,-Math.PI/2],[1,1,.001]],[new I.Mesh(new I.CylinderGeometry(.03,0,.15,4,1,!1),S),[-1.17,0,0],[0,0,Math.PI/2],[1,1,.001]],[new I.Mesh(new I.CylinderGeometry(.03,0,.15,4,1,!1),S),[0,-1.17,0],[Math.PI,0,0],[1,1,.001]],[new I.Mesh(new I.CylinderGeometry(.03,0,.15,4,1,!1),S),[0,1.17,0],[0,0,0],[1,1,.001]]],XYZE:[[new I.Line(P(1,1),j),null,[0,Math.PI/2,0]]]},k={AXIS:[[new I.Line(N,l.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]]},D={X:[[new I.Mesh(new I.TorusGeometry(1,.1,4,24),s),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],Y:[[new I.Mesh(new I.TorusGeometry(1,.1,4,24),s),[0,0,0],[Math.PI/2,0,0]]],Z:[[new I.Mesh(new I.TorusGeometry(1,.1,4,24),s),[0,0,0],[0,0,-Math.PI/2]]],E:[[new I.Mesh(new I.TorusGeometry(1.25,.1,2,24),s)]],XYZE:[[new I.Mesh(new I.SphereGeometry(.7,10,8),s)]]},B={X:[[new I.Mesh(O,c),[.8,0,0],[0,0,-Math.PI/2]],[new I.Line(N,v),null,null,[.8,1,1]]],Y:[[new I.Mesh(O,u),[0,.8,0]],[new I.Line(N,y),null,[0,0,Math.PI/2],[.8,1,1]]],Z:[[new I.Mesh(O,p),[0,0,.8],[Math.PI/2,0,0]],[new I.Line(N,g),null,[0,-Math.PI/2,0],[.8,1,1]]],XY:[[new I.Mesh(O,f),[.85,.85,0],null,[2,2,.2]],[new I.Line(N,w),[.855,.98,0],null,[.125,1,1]],[new I.Line(N,w),[.98,.855,0],[0,0,Math.PI/2],[.125,1,1]]],YZ:[[new I.Mesh(O,m),[0,.85,.85],null,[.2,2,2]],[new I.Line(N,x),[0,.855,.98],[0,0,Math.PI/2],[.125,1,1]],[new I.Line(N,x),[0,.98,.855],[0,-Math.PI/2,0],[.125,1,1]]],XZ:[[new I.Mesh(O,h),[.85,0,.85],null,[2,.2,2]],[new I.Line(N,b),[.855,0,.98],null,[.125,1,1]],[new I.Line(N,b),[.98,0,.855],[0,-Math.PI/2,0],[.125,1,1]]],XYZX:[[new I.Mesh(new I.BoxGeometry(.125,.125,.125),d.clone()),[1.1,0,0]]],XYZY:[[new I.Mesh(new I.BoxGeometry(.125,.125,.125),d.clone()),[0,1.1,0]]],XYZZ:[[new I.Mesh(new I.BoxGeometry(.125,.125,.125),d.clone()),[0,0,1.1]]]},A={X:[[new I.Mesh(new I.CylinderGeometry(.2,0,.8,4,1,!1),s),[.5,0,0],[0,0,-Math.PI/2]]],Y:[[new I.Mesh(new I.CylinderGeometry(.2,0,.8,4,1,!1),s),[0,.5,0]]],Z:[[new I.Mesh(new I.CylinderGeometry(.2,0,.8,4,1,!1),s),[0,0,.5],[Math.PI/2,0,0]]],XY:[[new I.Mesh(O,s),[.85,.85,0],null,[3,3,.2]]],YZ:[[new I.Mesh(O,s),[0,.85,.85],null,[.2,3,3]]],XZ:[[new I.Mesh(O,s),[.85,0,.85],null,[3,.2,3]]],XYZX:[[new I.Mesh(new I.BoxGeometry(.2,.2,.2),s),[1.1,0,0]]],XYZY:[[new I.Mesh(new I.BoxGeometry(.2,.2,.2),s),[0,1.1,0]]],XYZZ:[[new I.Mesh(new I.BoxGeometry(.2,.2,.2),s),[0,0,1.1]]]},T={X:[[new I.Line(N,l.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new I.Line(N,l.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new I.Line(N,l.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},L=function(e){var t=new I.Object3D;for(var n in e)for(var r=e[n].length;r--;){var i=e[n][r][0].clone(),o=e[n][r][1],a=e[n][r][2],s=e[n][r][3],l=e[n][r][4];i.name=n,i.tag=l,o&&i.position.set(o[0],o[1],o[2]),a&&i.rotation.set(a[0],a[1],a[2]),s&&i.scale.set(s[0],s[1],s[2]),i.updateMatrix();var c=i.geometry.clone();c.applyMatrix4(i.matrix),i.geometry=c,i.renderOrder=1/0,i.position.set(0,0,0),i.rotation.set(0,0,0),i.scale.set(1,1,1),t.add(i)}return t};return i.gizmo={},i.picker={},i.helper={},i.add(i.gizmo.translate=L(Z)),i.add(i.gizmo.rotate=L(z)),i.add(i.gizmo.scale=L(B)),i.add(i.picker.translate=L(V)),i.add(i.picker.rotate=L(D)),i.add(i.picker.scale=L(A)),i.add(i.helper.translate=L(C)),i.add(i.helper.rotate=L(k)),i.add(i.helper.scale=L(T)),i.picker.translate.visible=!1,i.picker.rotate.visible=!1,i.picker.scale.visible=!1,i}return n}(I.Object3D),pe=function(e){(0,se.Z)(n,e);var t=(0,le.Z)(n);function n(){var e;return(0,ie.Z)(this,n),(e=t.call(this,new I.PlaneGeometry(1e5,1e5,2,2),new I.MeshBasicMaterial({visible:!1,wireframe:!0,side:I.DoubleSide,transparent:!0,opacity:.1,toneMapped:!1}))).isTransformControlsPlane=!0,e.type="TransformControlsPlane",e.unitX=new I.Vector3(1,0,0),e.unitY=new I.Vector3(0,1,0),e.unitZ=new I.Vector3(0,0,1),e.tempVector=new I.Vector3,e.dirVector=new I.Vector3,e.alignVector=new I.Vector3,e.tempMatrix=new I.Matrix4,e.identityQuaternion=new I.Quaternion,e.cameraQuaternion=new I.Quaternion,e.worldPosition=new I.Vector3,e.worldQuaternion=new I.Quaternion,e.eye=new I.Vector3,e.axis=null,e.mode="translate",e.space="world",e.updateMatrixWorld=function(){var t=e.space;switch(e.position.copy(e.worldPosition),"scale"===e.mode&&(t="local"),e.unitX.set(1,0,0).applyQuaternion("local"===t?e.worldQuaternion:e.identityQuaternion),e.unitY.set(0,1,0).applyQuaternion("local"===t?e.worldQuaternion:e.identityQuaternion),e.unitZ.set(0,0,1).applyQuaternion("local"===t?e.worldQuaternion:e.identityQuaternion),e.alignVector.copy(e.unitY),e.mode){case"translate":case"scale":switch(e.axis){case"X":e.alignVector.copy(e.eye).cross(e.unitX),e.dirVector.copy(e.unitX).cross(e.alignVector);break;case"Y":e.alignVector.copy(e.eye).cross(e.unitY),e.dirVector.copy(e.unitY).cross(e.alignVector);break;case"Z":e.alignVector.copy(e.eye).cross(e.unitZ),e.dirVector.copy(e.unitZ).cross(e.alignVector);break;case"XY":e.dirVector.copy(e.unitZ);break;case"YZ":e.dirVector.copy(e.unitX);break;case"XZ":e.alignVector.copy(e.unitZ),e.dirVector.copy(e.unitY);break;case"XYZ":case"E":e.dirVector.set(0,0,0)}break;default:e.dirVector.set(0,0,0)}0===e.dirVector.length()?e.quaternion.copy(e.cameraQuaternion):(e.tempMatrix.lookAt(e.tempVector.set(0,0,0),e.dirVector,e.alignVector),e.quaternion.setFromRotationMatrix(e.tempMatrix)),(0,oe.Z)(((0,re.Z)(e),(0,ae.Z)(n.prototype)),"updateMatrixWorld",e).call(e)},e}return n}(I.Mesh);function de(e){var t=e.mode,n=e.set,r=e.value,i=e.matrix,o=e.axis,a=e.child,l=e.length,u=e.depth,p=(0,N.z)((function(e){return[e.camera,e.gl.domElement]})),d=(0,v.useState)(null),f=d[0],m=d[1],h=(0,s.Z)(o,3),y=h[0],g=h[1],x=h[2],b=(0,v.useMemo)((function(){return(0,ne.Z)(ce,[null!==l&&void 0!==l?l:1].concat((0,Y.Z)(p),[u]))}),[u,l].concat((0,Y.Z)(p)));(0,v.useEffect)((function(){if(null!=f)return b.attach(f),function(){b.detach()}}),[f,b]),(0,v.useEffect)((function(){if(null!=b&&null!=f){var e=function(){j.D1.getState().setControlling(!0)},r=function(e){setTimeout((function(){return j.D1.getState().setControlling(!1)}));var r=f[fe[t]],i=r.x,o=r.y,a=r.z;n(i,o,a)};return b.addEventListener("mouseDown",e),b.addEventListener("mouseUp",r),function(){j.D1.getState().setControlling(!1),b.removeEventListener("mouseUp",e),b.removeEventListener("mouseDown",r)}}}),[n,t,f]),null!=f&&f[fe[t]].fromArray(r);var w=(0,N.z)((function(e){return e.scene}));return(0,c.jsxs)("group",{matrixAutoUpdate:!1,matrix:i,children:[null!=f&&(0,N.g)((0,c.jsx)("primitive",{showX:y,showY:g,showZ:x,mode:t,space:"local",object:b}),w),(0,c.jsx)("group",{ref:m,children:null!=a&&(0,c.jsx)("primitive",{object:a})})]})}var fe={rotate:"rotation",scale:"scale",translate:"position"},me=[!0,!0,!0],he=[!0,!1,!0];function ve(e){var t=e.substepValue,n=e.getSubstep,r=e.valueRef,i=e.matrix,o=(0,g.EB)(),a="raw"===t.children[0].type?t.children[0].value:0,s="raw"===t.children[1].type?t.children[1].value:0,l="raw"===t.children[2].type?t.children[2].value:0;return(0,c.jsx)(de,{value:[a,s,l],axis:me,matrix:i,mode:"translate",set:function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return o.getState().replace((function(e){(null==n?e:n(e)).children=t.map((function(e){return{type:"raw",value:e}}))}),r.current)}})}function ye(e){var t=e.substepValue,n=e.getSubstep,r=e.valueRef,i=e.matrix,o=(0,g.EB)(),a="raw"===t.children[0].type?t.children[0].value:0,s="raw"===t.children[1].type?t.children[1].value:0;return(0,c.jsx)(de,{value:[a,0,s],axis:he,matrix:i,mode:"translate",set:function(e,t,i){return o.getState().replace((function(t){(null==n?t:n(t)).children=[e,i].map((function(e){return{type:"raw",value:e}}))}),r.current)}})}function ge(e){var t=e.value,n=e.valueRef,r=e.matrix;return(0,c.jsx)(c.Fragment,{children:t.children.map((function(e,t){return"operation"===e.type&&(0,c.jsx)(xe,{matrix:r,valueRef:n,child:e,index:t},t)}))})}function xe(e){var t=e.index,n=e.child,r=e.valueRef,i=e.matrix,o=(0,v.useCallback)((function(e){return(0,R.by)("operation",e.children[t])}),[t]);return"point3"===n.identifier?(0,c.jsx)(ve,{matrix:i,valueRef:r,getSubstep:o,substepValue:n}):(0,c.jsx)(ye,{matrix:i,valueRef:r,getSubstep:o,substepValue:n})}var be=[!1,!0,!1],we=[!0,!0,!0];function je(e){var t=e.description,n=(0,g.EB)()((function(e){return"gui"===e.type&&null==e.requested?e.selectionsList.filter((function(e){return(0,R.Lr)(t,(0,R.Il)(e.steps)[0])})):void 0}),R.wU);return null==n?null:(0,c.jsx)(c.Fragment,{children:n.map((function(e){return(0,c.jsx)(Me,{values:e.values,step:e.steps},(0,R.zq)(e.steps))}))})}function Se(e){return e}function Me(e){var t=e.step,n=e.values;if("string"==typeof t||"operation"!=t.type)return null;var r=n.map((function(e){return e.before.raw})).filter((function(e,t,n){return n.indexOf(e)===t})).filter(Ee),i=(0,v.useMemo)((function(){return{current:t}}),[]);switch(i.current=t,t.identifier){case"point3":return(0,c.jsx)(c.Fragment,{children:r.map((function(e,n){return(0,c.jsx)(ve,{matrix:e.matrix,valueRef:i,getSubstep:Se,substepValue:t},n)}))});case"point2":return(0,c.jsx)(c.Fragment,{children:r.map((function(e,n){return(0,c.jsx)(ye,{matrix:e.matrix,valueRef:i,getSubstep:Se,substepValue:t},n)}))});case"face":case"line":return(0,c.jsx)(c.Fragment,{children:r.map((function(e,n){return(0,c.jsx)(ge,{matrix:e.matrix,valueRef:i,value:t},n)}))});case"translate":return(0,c.jsx)(c.Fragment,{children:r.map((function(e,n){return(0,c.jsx)(ke,{value:e,step:t},n)}))});case"split":return(0,c.jsx)(c.Fragment,{children:r.map((function(e,n){return(0,c.jsx)(Pe,{value:e,step:t},n)}))});case"extrude":return(0,c.jsx)(c.Fragment,{children:r.map((function(e,n){return(0,c.jsx)(ze,{value:e,step:t},n)}))});default:return null}}function Ee(e){return(0,$.Z)(e,h.WV)}var Oe=new I.Box3,Ne=new I.Vector3;function Pe(e){for(var t=e.value,n=e.step,r=(0,g.EB)(),i="raw"===n.children[0].type?n.children[0].value:"x",o=Ve[i],a=Ce[i],s=n.children.length-2,l=new Array(s),u=new Array(s),p=(0,v.useMemo)((function(){return t.getBoundingBox(Oe),Oe.getCenter(Ne),Ne[i]=Oe.min[i],Ne.toArray()}),[t]),d=p[0],f=p[1],m=p[2],y=(0,v.useMemo)((function(){var e=t.getOutline().clone();e.matrix.copy((0,h.Nh)(-d,-f,-m));var n=[1,1,1];return n[o]=0,e.matrix.multiply(h.gN.apply(void 0,(0,Y.Z)(n))),e}),[t,o,d,f,m]),x=0,b=0;b<n.children.length-2;b++){var w=n.children[b+2],j="raw"===w.type?w.value:0;l[b]=j,u[b]=x,x+=j}var S=(0,v.useRef)([]);return(0,v.useEffect)((function(){for(;S.current.length<s;)S.current.push(y.clone());S.current.splice(s,Number.MAX_SAFE_INTEGER)}),[y,s]),(0,c.jsx)(c.Fragment,{children:l.map((function(e,i){return(0,c.jsx)(Ze,{index:i,axisEnabled:a,axisIndex:o,matrix:t.matrix,offset:u[i],outline:y,size:e,step:n,store:r,x:d,y:f,z:m},i)}))})}function Ze(e){var t=e.size,n=e.offset,r=e.x,i=e.y,o=e.z,a=e.axisEnabled,s=e.axisIndex,l=e.matrix,u=e.outline,p=e.store,d=e.step,f=e.index,m=(0,v.useMemo)((function(){return u.clone()}),[u]);return(0,v.useMemo)((function(){var e=[r,i,o];return e[s]+=t+n,(0,c.jsx)(de,{length:.3,value:e,axis:a,matrix:l,depth:!0,child:m,mode:"translate",set:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return p.getState().replace((function(e){e.children[f+2]={type:"raw",value:Math.max(0,t[s]-n)}}),d)}})}),[f,t,n,r,i,o,a,s,l,m,p,d])}var Ve={x:0,y:1,z:2},Ce={x:[!0,!1,!1],y:[!1,!0,!1],z:[!1,!1,!0]};function ze(e){var t=e.value,n=e.step,r=(0,g.EB)(),i="raw"===n.children[0].type?n.children[0].value:0,o=(0,v.useMemo)((function(){return t.getBoundingBox(Oe),Oe.getCenter(Ne),Ne.toArray()}),[t]),a=o[0],s=o[1],l=o[2],u=(0,v.useMemo)((function(){var e=t.getOutline().clone();return e.matrix.copy((0,h.Nh)(-a,-s,-l)),e}),[t,a,s,l]);return(0,c.jsx)(de,{value:[a,i+s,l],axis:be,matrix:t.matrix,mode:"translate",child:u,set:function(e,t,i){return r.getState().replace((function(e){e.children=[{type:"raw",value:t-s}]}),n)}})}function ke(e){var t=e.value,n=e.step,r=(0,g.EB)(),i="raw"===n.children[0].type?n.children[0].value:0,o="raw"===n.children[1].type?n.children[1].value:0,a="raw"===n.children[2].type?n.children[2].value:0,s=(0,v.useMemo)((function(){return t.getBoundingBox(Oe),Oe.getCenter(Ne),Ne.toArray()}),[t]),l=s[0],u=s[1],p=s[2],d=(0,v.useMemo)((function(){var e=t.getOutline().clone();return e.matrix.copy((0,h.Nh)(-l,-u,-p)),e}),[t,l,u,p]);return(0,c.jsx)(de,{value:[l+i,u+o,p+a],axis:we,matrix:t.matrix,mode:"translate",child:d,set:function(e,t,i){return r.getState().replace((function(n){n.children=[{type:"raw",value:e-l},{type:"raw",value:t-u},{type:"raw",value:i-p}]}),n)}})}var De=new h.vk(new I.Matrix4,(0,h.i7)(new I.Color(16711680)));function Be(e){var t=ct(e.x,e.y),n=(0,g.g4)((function(e){return e.descriptions.filter((function(e){return e.name.endsWith(t)}))}),R.wU);return(0,c.jsx)(c.Fragment,{children:n.map((function(e){var t=e.seed,n=e.name;return(0,c.jsx)(Ae,{seed:t,name:n},n)}))})}function Ae(e){var t=e.seed,n=e.name,r=(0,g.EB)(),i=r((function(e){return e.selectedDescriptions.includes(n)})),o=r((function(e){var t;return null===(t=e.grammar.find((function(e){var t=e.name;return(0,R.Lr)(n,t)})))||void 0===t?void 0:t.name}));return null==o?null:i?(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(je,{description:n}),(0,c.jsx)(Qe,{rootNode:o}),(0,c.jsx)(Ie,{seed:t,name:n}),(0,c.jsx)(Te,{description:n})]}):(0,c.jsx)(Ge,{seed:t,name:n})}function Te(e){var t=e.description,n=(0,g.EB)()((function(e){if("gui"===e.type)return Array.from(new Set((null!=e.hovered?e.selectionsList.concat(e.hovered):e.selectionsList).filter((function(e){var n=e.steps;return(0,R.Lr)(t,(0,R.Il)(n)[0])})).reduce((function(e,t){return e.concat(t.values.filter((function(e){return null!=e.object})).map((function(e){return e.object})))}),[])))}),R.wU);return null==n?null:(0,c.jsx)(c.Fragment,{children:n.map((function(e){return(0,c.jsx)(Le,{object:e,colorAdd:.25},e.uuid)}))})}function Le(e){var t=e.object,n=e.colorAdd;return(0,v.useEffect)((function(){return t.traverse((function(e){"material"in e&&e.material.color.addScalar(n)})),function(){t.traverse((function(e){"material"in e&&e.material.color.addScalar(-n)}))}}),[t]),null}function qe(e,t){return e((function(e){return"gui"===e.type?(0,R.Bc)(e.grammar,e.dependencyMap,t):void 0}),R.wU)}function Ge(e){var t=e.name,n=e.seed,r=(0,v.useRef)(null),i=(0,g.EB)();return function(e,t,n){var r=(0,g.EB)();(0,v.useEffect)((function(){if(null!=n.current&&null!=e){var i=(0,h.QM)((0,X.of)(De).pipe((0,R.Tn)(),(0,R.Ii)(e,h.Jy,{delay:r.getState().interpretationDelay,seed:t})),n.current,(function(e){return j.D1.getState().setError(void 0),e.raw.getObject()}),(function(e){console.error(e),j.D1.getState().setError(e.message)}));return function(){var e,t;null===(t=n.current)||void 0===t||(e=t).remove.apply(e,(0,Y.Z)(n.current.children)),i.unsubscribe()}}}),[r,e,t])}(qe(i,t),n,r),(0,c.jsx)("group",{onClick:function(e){var n;null==e.intersections[0].object.userData.steps&&(e.stopPropagation(),i.getState().selectDescription(t,null!==(n=i.getState().shift)&&void 0!==n&&n))},ref:r})}function Qe(e){var t=e.rootNode,n=(0,g.EB)()((function(e){var n;if("gui"===e.type)return null===(n=e.valueMap[t])||void 0===n?void 0:n.filter((function(e){return(0,$.Z)(e.after.raw,h.WV)})).map((function(e){return e.after.raw.getOutline()}))}),R.wU);return null==n?null:(0,c.jsx)(c.Fragment,{children:n.map((function(e){return(0,c.jsx)("primitive",{object:e},e.uuid)}))})}function Ie(e){var t=e.name,n=e.seed,r=(0,g.EB)(),i=qe(r,t),o=(0,v.useRef)(null);return function(e,t,n,r){var i=(0,g.EB)();(0,v.useEffect)((function(){if(null!=r.current&&null!=e){var o,a=new Map,s=new Map,l=new F.x,c=l.pipe((0,R.br)(300)).subscribe((function(e){return i.getState().editIndices(e,!0)}));try{o=(0,h.QM)((0,X.of)(De).pipe((0,R.Tn)(),(0,R.Ii)(e,h.Jy,{delay:i.getState().interpretationDelay,seed:n,listeners:{onAfterStep:function(e,t){var n=a.get(e),r=null===n||void 0===n?void 0:n.find((function(e){var n=(0,R.Up)(t.index,e.index);return n===R.J.Predecessor||n===R.J.Equal}));null!=r&&l.next({steps:e,value:{after:t,before:r,object:(0,$.Z)(t.raw,h.WV)?t.raw.getObject():void 0}});var i=t.index.join(","),o=s.get(i);null!=o&&(o.path[0]!==e.path[0]||function(e,t){if(e===t)return!0;if(e.length<t.length)return!1;for(var n=0;n<t.length;n++)if(e[n]!=t[n])return!1;return!0}(o.path,e.path)&&(0,L.I)(te,e))||s.set(i,e)},onBeforeStep:function(e,t){var n=a.get(e);if(null==n&&(n=[],a.set(e,n)),n.push(t),"symbol"===e.type){var r=t.index.join(",");s.delete(r)}}}})),r.current,(function(e){var t=s.get(e.index.join(",")),n=e.raw.getObject();if(null!=t){var r=a.get(t),i=null===r||void 0===r?void 0:r.find((function(t){var n=(0,R.Up)(e.index,t.index);return n===R.J.Predecessor||n===R.J.Equal}));if(null!=i&&null!=t){var o={after:e,before:i,object:n};n.traverse((function(e){e.userData.steps=t,e.userData.value=o}))}}return n}),(function(e){console.error(e),j.D1.getState().setError(e.message)}))}catch(u){j.D1.getState().setError(u.message)}return function(){var e,n;i.getState().clearValueMap(t),null===(n=r.current)||void 0===n||(e=n).remove.apply(e,(0,Y.Z)(r.current.children)),null===o||void 0===o||o.unsubscribe(),null===c||void 0===c||c.unsubscribe()}}}),[i,e,n])}(i,t,n,o),null==i?null:(0,c.jsx)("object3D",{onPointerMove:function(e){if(0!==e.intersections.length){var t=e.intersections[0].object,n=t.userData.steps,i=t.userData.value;null!=n&&null!=i&&(e.stopPropagation(),r.getState().onStartHover(n,[i]))}},onPointerOut:function(e){var t=e.object,n=t.userData.steps,i=t.userData.value;null!=n&&null!=i&&(e.stopPropagation(),r.getState().onEndHover(n))},onClick:function(e){var t=e.intersections[0].object,n=t.userData.steps,i=t.userData.value;if(null!=n&&null!=i){e.stopPropagation();var o=r.getState();"gui"==o.type&&null==o.requested&&r.getState().selectResult(n,i)}},ref:o})}var Re=(0,Y.Z)(Ye(77188,98509,77198,98516,18)).concat((0,Y.Z)(Ye(137374,88769,137385,88778,18))),$e=new Set(Re.map((function(e){var t=e.x,n=e.y,r=e.zoom;return"".concat(r,"/").concat(t,"/").concat(n)})));function Ye(e,t,n,r,i){var o=r+1-t;return new Array((n+1-e)*o).fill(void 0).map((function(n,r){return{x:e+Math.floor(r/o),y:t+r%o,zoom:i}}))}function Xe(e,t,n,r){if(function(e,t,n){return $e.has("".concat(e,"/").concat(t,"/").concat(n))}(e,t,n))return"/cgv/tiles/_".concat(e,"-").concat(t,"-").concat(n,".").concat(r)}function Fe(e){var t=e.tile,n=(0,N.z)().size,r=(0,s.Z)((0,j.D1)((function(e){var t=(0,s.Z)((0,j.bt)(e),3),r=t[0],i=t[1],o=t[2];if("satelite"!==e.viewType){var a=(0,h.FP)(0,18),l=Math.floor(a*r),c=Math.floor(a*o);return[l,c,l-1,c-1,l+1,c+1,18]}return function(e,t,n,r,i){var o=(0,h.FP)(0,18),a=Math.tan(r/180*Math.PI/2)*t,s=a*i,l=Math.floor(o*e),c=Math.floor(o*n),u=(0,j.oq)(e-s,0,1),p=(0,j.oq)(e+s,0,1),d=(0,j.oq)(n-a,0,1),f=(0,j.oq)(n+a,0,1);return[l,c,Math.floor(o*u),Math.floor(o*d),Math.floor(o*p),Math.floor(o*f),18]}(r,i,o,j.xg,n.width/n.height)}),R.wU),7),i=r[0],o=r[1],a=r[2],l=r[3],u=r[4],p=r[5],d=r[6],f=u+1-a,m=p+1-l;return(0,c.jsx)(c.Fragment,{children:new Array(f*m).fill(null).map((function(e,n){var r=a+Math.floor(n/m),s=l+n%m;return(0,c.jsx)(t,{highlighted:r===i&&s===o,x:r,y:s,zoom:d},"".concat(r,"/").concat(s))}))})}function We(e,t,n){return(0,v.useMemo)((function(){var r=(0,h.FP)(0,n);return{position:[e/r,0,t/r],scale:1/((0,h.jo)(t,n)*r)}}),[e,t,n])}function Ue(e){var t=e.x,n=e.y,r=e.zoom,i=We(t,n,r),o=i.position,a=i.scale;return 18!=r?null:(0,v.useMemo)((function(){return(0,c.jsx)("group",{scale:a,position:o,children:(0,c.jsx)(Be,{x:t,y:n})})}),[t,n,a,o])}function He(e){var t=e.x,n=e.y,r=e.zoom,i=e.highlighted,o=(0,j.D1)((function(e){return"panorama"!==e.viewType?e.visualType:0})),a=(0,j.eG)(o),s=We(t,n,r),l=s.position,u=s.scale,p=Xe(r,t,n,"png");return 0===a||null==p?null:(0,c.jsx)("group",{scale:u,position:l,children:(0,c.jsx)(v.Suspense,{fallback:null,children:(0,c.jsx)(Je,{highlighted:i,url:p,y:n,zoom:r})})})}var _e=new I.PlaneBufferGeometry(1,1);function Je(e){var t=e.url,n=e.y,r=e.zoom,i=e.highlighted,o=(0,N.D)(I.TextureLoader,t),a=(0,h.jo)(n,r);return(0,c.jsx)("mesh",{scale:[a,1,a],geometry:_e,position:[0,0,0],children:(0,c.jsx)("meshBasicMaterial",{color:i?16777215:12303291,side:I.DoubleSide,depthWrite:!1,depthTest:!1,map:o})})}_e.translate(.5,-.5,0),_e.rotateX(-Math.PI/2);var Ke=n(85769),et=new I.SphereBufferGeometry(500,60,40);function tt(){var e=(0,j.D1)((function(e){var t=e.viewType,n=e.panoramaIndex;return"panorama"===t?n:void 0})),t=(0,j.D1)((function(e){return"panorama"===e.viewType?e.visualType:0})),n=(0,j.eG)(t),r=null!=e?x.t[e]:void 0;return null==r||0===n?null:(0,c.jsx)(v.Suspense,{fallback:null,children:(0,c.jsx)(nt,{url:r.url,rotationOffset:r.rotationOffset/180*Math.PI})})}function nt(e){var t=e.url,n=e.rotationOffset,r=(0,Ke.m)(t);return(0,c.jsx)("mesh",{scale:[1,1,-1],geometry:et,"rotation-y":n,children:(0,c.jsx)("meshBasicMaterial",{depthWrite:!1,depthTest:!1,map:r,side:I.DoubleSide})})}function rt(){return(0,c.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",className:"bi bi-download",viewBox:"0 0 16 16",children:[(0,c.jsx)("path",{d:"M.5 9.9a.5.5 0 0 1 .5.5v2.5a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-2.5a.5.5 0 0 1 1 0v2.5a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2v-2.5a.5.5 0 0 1 .5-.5z"}),(0,c.jsx)("path",{d:"M7.646 11.854a.5.5 0 0 0 .708 0l3-3a.5.5 0 0 0-.708-.708L8.5 10.293V1.5a.5.5 0 0 0-1 0v8.793L5.354 8.146a.5.5 0 1 0-.708.708l3 3z"})]})}function it(){var e=new I.BufferGeometry,t=new Float32Array([-1,-1,1,3,-1,1,-1,3,1]),n=new Float32Array([0,0,2,0,0,2]);return e.setAttribute("position",new I.BufferAttribute(t,3)),e.setAttribute("uv",new I.BufferAttribute(n,2)),e}function ot(e){var t=e.children,n=(0,a.Z)(e,["children"]),r=(0,v.useMemo)(it,[]);return(0,c.jsx)("mesh",(0,o.Z)((0,i.Z)({geometry:r,frustumCulled:!1},n),{children:t}))}function at(){return(0,c.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",className:"bi bi-image",viewBox:"0 0 16 16",children:[(0,c.jsx)("path",{d:"M6.002 5.5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0z"}),(0,c.jsx)("path",{d:"M2.002 1a2 2 0 0 0-2 2v10a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V3a2 2 0 0 0-2-2h-12zm12 1a1 1 0 0 1 1 1v6.5l-3.777-1.947a.5.5 0 0 0-.577.093l-3.71 3.71-2.66-1.772a.5.5 0 0 0-.63.062L1.002 12V3a1 1 0 0 1 1-1h12z"})]})}function st(e){var t=e.className,n=(0,a.Z)(e,["className"]),r=(0,v.useState)(!1),s=r[0],l=r[1],u=(0,v.useState)(!1),p=u[0],d=u[1],f=(0,j.D1)((function(e){return e.visualType}));return(0,c.jsxs)("div",(0,o.Z)((0,i.Z)({},n),{className:"".concat(t," d-flex flex-column align-items-center"),children:[s&&(0,c.jsxs)("div",{style:{bottom:45},className:"rounded bg-light text-dark flex-row align-items-center px-2 border d-flex rounded position-absolute text-light",children:["+",(0,c.jsx)("input",{style:{minWidth:50},type:"range",value:f,className:"mb-0 mx-2 form-range",onChange:function(e){return j.D1.getState().setVisualType(e.target.valueAsNumber)},min:0,step:.01,max:1}),"-"]}),(0,c.jsx)(z.Z,{placement:"top",onVisibleChange:d,visible:p&&!s,overlay:"Background",children:(0,c.jsx)("div",{onClick:function(){return l((function(e){return!e}))},className:"btn btn-sm ".concat(s?"btn-primary":"btn-secondary"," d-flex align-items-center"),children:(0,c.jsx)(at,{})})})]}))}function lt(){return(0,c.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",className:"bi bi-camera-reels",viewBox:"0 0 16 16",children:[(0,c.jsx)("path",{d:"M6 3a3 3 0 1 1-6 0 3 3 0 0 1 6 0zM1 3a2 2 0 1 0 4 0 2 2 0 0 0-4 0z"}),(0,c.jsx)("path",{d:"M9 6h.5a2 2 0 0 1 1.983 1.738l3.11-1.382A1 1 0 0 1 16 7.269v7.462a1 1 0 0 1-1.406.913l-3.111-1.382A2 2 0 0 1 9.5 16H2a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h7zm6 8.73V7.27l-3.5 1.555v4.35l3.5 1.556zM1 8v6a1 1 0 0 0 1 1h7.5a1 1 0 0 0 1-1V8a1 1 0 0 0-1-1H2a1 1 0 0 0-1 1z"}),(0,c.jsx)("path",{d:"M9 6a3 3 0 1 0 0-6 3 3 0 0 0 0 6zM7 3a2 2 0 1 1 4 0 2 2 0 0 1-4 0z"})]})}function ct(e,t){return"_".concat(e,"_").concat(t)}function ut(e,t){var n;t.stopPropagation(),t.preventDefault(),1===(null===(n=t.dataTransfer)||void 0===n?void 0:n.files.length)&&t.dataTransfer.files[0].text().then((function(t){return e.getState().import(t)}))}function pt(e){var t=e.className,r=e.children,l=(0,a.Z)(e,["className","children"]),d=(0,u.j)(g.op),f=(0,g.EB)(),h=(0,v.useState)(),y=h[0],x=h[1];return(0,c.jsxs)("div",(0,o.Z)((0,i.Z)({onDragOver:function(e){return e.preventDefault()},onDrop:ut.bind(null,f)},l),{className:"".concat(t," position-relative"),children:[(0,c.jsx)(m.Xz,{style:{touchAction:"none",userSelect:"none",WebkitUserSelect:"none"},events:function(e){return(0,o.Z)((0,i.Z)({},(0,m.U3)(e)),{priority:1,filter:function(e){return j.D1.getState().controlling?[]:e.sort((function(e,t){return e.distance-t.distance}))}})},dpr:null==n.g.window?1:window.devicePixelRatio,children:(0,c.jsxs)(d,{children:[(0,c.jsxs)(p.T,(0,o.Z)((0,i.Z)({ref:x,attach:"map"},{}),{children:[(0,c.jsx)(E,{}),(0,c.jsx)(tt,{}),(0,c.jsx)(ft,{}),(0,c.jsx)(Fe,{tile:He})]})),(0,c.jsx)(P,{}),(0,c.jsx)("ambientLight",{intensity:.5}),(0,c.jsx)("directionalLight",{position:[10,10,10],intensity:.5}),(0,c.jsx)(St,{}),(0,c.jsx)(Fe,{tile:Ue}),(0,c.jsxs)(E,{children:[null!=y&&(0,c.jsx)(vt,{texture:y}),null!=y&&(0,c.jsx)(yt,{texture:y})]})]})}),(0,c.jsxs)("div",{className:"d-flex flex-row justify-content-between position-absolute",style:{pointerEvents:"none",inset:0,left:0,right:0,top:0,bottom:0},children:[(0,c.jsxs)("div",{className:"d-flex flex-column my-3 ms-3",style:{maxWidth:200},children:[(0,c.jsx)(Q.n,{style:{pointerEvents:"all"},className:"mb-3"}),(0,c.jsx)(T,{createDescriptionRequestData:function(){var e=(0,s.Z)((0,j.bt)(j.D1.getState()),3),t=e[0],n=(e[1],e[2]);return{suffix:ct(Math.floor(t*xt),Math.floor(n*xt))}},style:{pointerEvents:"all"},className:"mb-3",children:(0,c.jsxs)("div",{className:"p-2 border-top border-1",children:[(0,c.jsx)("div",{className:"w-100 btn-sm btn btn-outline-secondary",onClick:function(){return function(e){return bt.apply(this,arguments)}(f)},children:"Generate Lots"}),(0,c.jsx)("div",{className:"w-100 btn-sm btn mt-2 btn-outline-secondary",onClick:function(){return function(e){return wt.apply(this,arguments)}(f)},children:"Generate Roads"}),(0,c.jsx)(dt,{})]})}),(0,c.jsx)("div",{className:"flex-grow-1"}),(0,c.jsxs)("div",{style:{pointerEvents:"all"},className:"d-flex flex-row",children:[(0,c.jsx)(Ot,{className:"me-2"}),(0,c.jsx)(st,{className:"me-2"}),(0,c.jsx)(Nt,{className:"me-2"}),(0,c.jsx)(Mt,{className:"me-2"}),(0,c.jsx)(Et,{className:"me-2"}),(0,c.jsx)(jt,{})]})]}),(0,c.jsxs)("div",{className:"d-flex flex-column align-items-end m-3",children:[(0,c.jsx)(L.X,{className:"bg-light border rounded shadow w-100 mb-3 overflow-hidden",style:{maxWidth:"16rem",pointerEvents:"all"}}),(0,c.jsx)("div",{className:"flex-grow-1"}),(0,c.jsx)("div",{className:"d-flex flex-row",style:{pointerEvents:"all"},children:(0,c.jsx)(G,{className:"me-2"})})]})]}),r]}))}function dt(){var e=(0,g.EB)(),t=e((function(e){return e.selectedDescriptions.length>1}));return(0,c.jsx)("div",{className:"w-100 btn-sm btn mt-2 btn-outline-secondary ".concat(t?"":"disabled"),onClick:function(){return e.getState().request("summarize",void 0,e.getState().selectedDescriptions)},children:"Summarize"})}function ft(){return(0,j.D1)((function(e){return"fly"===e.viewType}))?(0,c.jsx)(d.q,{turbidity:10,rayleigh:.4,mieCoefficient:.001,mieDirectionalG:.74,inclination:.62,azimuth:.13}):null}var mt="\nuniform sampler2D map;\nuniform float opacity;\nvarying vec2 vUv;\n\nvec4 fromLinear(vec4 linearRGB)\n{\n    bvec4 cutoff = lessThan(linearRGB, vec4(0.0031308));\n    vec4 higher = vec4(1.055)*pow(linearRGB, vec4(1.0/2.4)) - vec4(0.055);\n    vec4 lower = linearRGB * vec4(12.92);\n\n    return mix(higher, lower, cutoff);\n}\n\nvoid main() {\n    vec4 textureColor = texture2D( map, vUv );\n    gl_FragColor = fromLinear(textureColor);\n    gl_FragColor.a *= opacity;\n}",ht="\nvarying vec2 vUv;\n\nvoid main() {\n    vUv = uv;\n    gl_Position = vec4(position, 1.0);\n}\n";function vt(e){var t=e.texture,n=(0,j.D1)((function(e){return e.visualType})),r=(0,j.eG)(n),i=(0,v.useMemo)((function(){return{map:{value:t},opacity:{value:0}}}),[t]);return i.opacity.value=r,(0,c.jsx)(ot,{children:(0,c.jsx)("shaderMaterial",{uniforms:i,vertexShader:ht,fragmentShader:mt,toneMapped:!0,attach:"material",depthTest:!0,depthWrite:!1,transparent:!0})})}function yt(e){var t=e.texture,n=(0,j.D1)((function(e){return e.visualType})),r=(0,j.Yc)(n),i=(0,v.useMemo)((function(){return{map:{value:t},opacity:{value:0}}}),[t]);return i.opacity.value=r,(0,c.jsx)(ot,{renderOrder:2e3,children:(0,c.jsx)("shaderMaterial",{uniforms:i,vertexShader:ht,fragmentShader:mt,toneMapped:!0,attach:"material",depthTest:!1,opacity:r,depthWrite:!1,transparent:!0})})}var gt=18,xt=(0,h.FP)(0,gt);function bt(){return(bt=(0,r.Z)((function(e){var t,n,r,i,o,a,c,u,p;return(0,l.__generator)(this,(function(l){switch(l.label){case 0:return t=(0,s.Z)((0,j.bt)(j.D1.getState()),3),n=t[0],r=t[2],i=Math.floor(n*xt),o=Math.floor(r*xt),null==(a=Xe(gt,i,o,"mvt"))?[2]:[4,(0,h.XA)(a,o,gt)];case 1:return c=l.sent(),u=(0,h.jo)(o,gt),p=(0,h.PP)(c,ct(i,o),"exclude",u),e.getState().addDescriptions(p),[2]}}))}))).apply(this,arguments)}function wt(){return(wt=(0,r.Z)((function(e){var t,n,r,i,o,a,c,u,p;return(0,l.__generator)(this,(function(l){switch(l.label){case 0:return t=(0,s.Z)((0,j.bt)(j.D1.getState()),3),n=t[0],r=t[2],i=Math.floor(n*xt),o=Math.floor(r*xt),null==(a=Xe(gt,i,o,"mvt"))?[2]:[4,(0,h.XA)(a,o,gt)];case 1:return c=l.sent(),u=(0,h.jo)(o,gt),p=(0,h.Zj)(c,ct(i,o),"clip",u),e.getState().addDescriptions(p),[2]}}))}))).apply(this,arguments)}function jt(){var e=(0,j.D1)((function(e){return e.error}));return null==e?null:(0,c.jsx)(y.B,{message:e,align:"left"})}function St(){return(0,c.jsx)(c.Fragment,{children:x.t.map((function(e,t){var n=e.position;return(0,c.jsx)(f.aL,{position:n,onClick:function(e){e.stopPropagation(),j.D1.getState().changePanoramaView(t)},scale:3e-8,matrixWorldAutoUpdate:void 0,getObjectsByProperty:void 0,getVertexPosition:void 0,children:(0,c.jsx)("meshBasicMaterial",{color:255})},t)}))})}function Mt(e){var t=e.className,n=(0,a.Z)(e,["className"]),r=(0,g.EB)();return(0,c.jsx)(z.Z,{placement:"top",overlay:"Download",children:(0,c.jsx)("div",(0,o.Z)((0,i.Z)({},n),{onClick:function(){return r.getState().download()},className:"".concat(t," d-flex align-items-center justify-content-center btn btn-primary btn-sm "),children:(0,c.jsx)(rt,{})}))})}function Et(e){var t=e.className,n=(0,a.Z)(e,["className"]),r=(0,j.D1)((function(e){return"fly"===e.viewType}));return(0,c.jsx)(z.Z,{placement:"top",overlay:"Fly Camera",children:(0,c.jsx)("div",(0,o.Z)((0,i.Z)({},n),{onClick:function(){return r?j.D1.getState().backToSateliteView():j.D1.getState().enterFlyCamera()},className:"".concat(t," d-flex align-items-center justify-content-center btn ").concat(r?"btn-secondary":"btn-primary"," btn-sm "),children:(0,c.jsx)(lt,{})}))})}function Ot(e){var t=e.className,n=(0,a.Z)(e,["className"]),r=(0,g.EB)(),s=r((function(e){return"gui"===e.type&&e.shift}));return(0,c.jsx)(z.Z,{placement:"topLeft",overlay:"Hold for multiselect",children:(0,c.jsx)("div",(0,o.Z)((0,i.Z)({},n),{onPointerDown:function(){return r.getState().setShift(!0)},onPointerUp:function(){return r.getState().setShift(!1)},className:"".concat(t," d-flex align-items-center justify-content-center btn ").concat(s?"btn-primary":"btn-secondary"," btn-sm "),children:(0,c.jsx)(C,{})}))})}function Nt(e){var t=e.className,n=(0,a.Z)(e,["className"]);return"panorama"!=(0,j.D1)((function(e){return e.viewType}))?null:(0,c.jsx)(z.Z,{placement:"top",overlay:"Exit Street View",children:(0,c.jsx)("div",(0,o.Z)((0,i.Z)({},n),{className:"".concat(t," d-flex align-items-center justify-content-center btn btn-sm btn-primary"),onClick:function(){return j.D1.getState().backToSateliteView()},children:(0,c.jsx)(V,{})}))})}},64774:function(e,t,n){n.d(t,{D1:function(){return N},H5:function(){return Z},Yc:function(){return w},bt:function(){return P},bv:function(){return V},eG:function(){return j},oq:function(){return S},xg:function(){return p}});var r=n(828),i=n(29815),o=n(26173),a=n(14671),s=n(38597),l=n(7585),c=n(55050),u=n(20138),p=60;var d,f=new o.Euler(0,0,0,"YXZ"),m=[0,0,0],h=[(d=new o.Euler(-Math.PI/2,0,0)).x,d.y,d.z],v=(0,c.jo)(0,0),y=.1/v,g=1/v,x=10/v,b=40/v;function w(e){return Math.min(2*e-1,1)}function j(e){return Math.max(2*e,0)}function S(e,t,n){return Math.min(Math.max(e,t),n)}var M=new o.Vector3,E=new o.Euler(void 0,void 0,void 0,"YXZ");function O(e,t,n){var o,a,s=(0,r.Z)(e,3),l=s[0],c=s[1],u=s[2];return(o=M).set.apply(o,(0,i.Z)(t)),(a=E).set.apply(a,(0,i.Z)(n)),M.applyEuler(E),M.x+=l,M.y+=c,M.z+=u,M.y=S(M.y,y,b),M.toArray()}var N=(0,a.Z)((0,s.XR)((0,s.$e)({viewType:"satelite",position:[(0,c.dc)(u.K[0].lon,0),x,(0,c.Oz)(u.K[0].lat,0)],error:void 0,visualType:0,controlling:!1},(function(e,t){return{setControlling:function(t){return e({controlling:t})},setLatLon:function(t,n){e({viewType:"satelite",position:[(0,c.dc)(n,0),x,(0,c.Oz)(t,0)]})},drag:function(n,o){var a=t(),s=V(a)/180*Math.PI;if(a.viewType,"satelite"==a.viewType){var l=(0,r.Z)(a.position,3),c=l[0],u=l[1],p=l[2],d=2*Math.tan(s/2)*a.position[1];e({position:[S(c-n*d,0,1),u,S(p-o*d,0,1)]})}else{var m;(m=f).set.apply(m,(0,i.Z)(a.rotation)),f.x=S(f.x+o*s,-Math.PI/2,Math.PI/2),f.y+=n*s,e({rotation:[f.x,f.y,f.z]})}},moveFlyCamera:function(n){var r=t();"fly"===r.viewType&&e({position:O(r.position,n,r.rotation)})},pinch:function(n){var i=t();switch(i.viewType){case"satelite":var o=(0,r.Z)(i.position,3),a=o[0],s=o[1],l=o[2];e({position:[a,S(s/n,g,b),l]});break;case"panorama":var c=S(i.fov/((2+n)/3),5,120);e({fov:c});break;case"fly":e({position:O(i.position,[0,0,1e-6*(1-n)],i.rotation)})}},changeView:function(t){return e(t)},enterFlyCamera:function(){var n=t();if("fly"!==n.viewType){var r=P(n),i=Z(n);e({viewType:"fly",position:r,rotation:i})}},backToSateliteView:function(){var n=t();if("satelite"!==n.viewType){var i=(0,r.Z)(P(n),3),o=i[0],a=i[1],s=i[2];e({viewType:"satelite",position:[o,S(a,g,b),s]})}},changePanoramaView:function(n){var r=t(),i="satelite"===r.viewType?m:r.rotation,o="panorama"===r.viewType?r.fov:p;e({viewType:"panorama",panoramaIndex:n,rotation:i,fov:o})},setError:function(t){e({error:t})},setVisualType:function(t){e({visualType:t})}}}))));function P(e){return"panorama"!==e.viewType?e.position:l.t[e.panoramaIndex].position}function Z(e){return"satelite"===e.viewType?h:e.rotation}function V(e){return"panorama"===e.viewType?e.fov:p}},56118:function(e,t,n){n.d(t,{M:function(){return J}});var r=n(85893),i=n(67294),o=n(26042),a=n(69396),s=n(29815),l=n(82513),c=n(82906);function u(){return(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",className:"bi bi-pencil",viewBox:"0 0 16 16",children:(0,r.jsx)("path",{d:"M12.146.146a.5.5 0 0 1 .708 0l3 3a.5.5 0 0 1 0 .708l-10 10a.5.5 0 0 1-.168.11l-5 2a.5.5 0 0 1-.65-.65l2-5a.5.5 0 0 1 .11-.168l10-10zM11.207 2.5 13.5 4.793 14.793 3.5 12.5 1.207 11.207 2.5zm1.586 3L10.5 3.207 4 9.707V10h.5a.5.5 0 0 1 .5.5v.5h.5a.5.5 0 0 1 .5.5v.5h.293l6.5-6.5zm-9.761 5.175-.106.106-1.528 3.821 3.821-1.528.106-.106A.5.5 0 0 1 5 12.5V12h-.5a.5.5 0 0 1-.5-.5V11h-.5a.5.5 0 0 1-.468-.325z"})})}var p=n(65509);function d(){return(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",className:"bi bi-diagram-3-fill",viewBox:"0 0 16 16",children:(0,r.jsx)("path",{fillRule:"evenodd",d:"M6 3.5A1.5 1.5 0 0 1 7.5 2h1A1.5 1.5 0 0 1 10 3.5v1A1.5 1.5 0 0 1 8.5 6v1H14a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-1 0V8h-5v.5a.5.5 0 0 1-1 0V8h-5v.5a.5.5 0 0 1-1 0v-1A.5.5 0 0 1 2 7h5.5V6A1.5 1.5 0 0 1 6 4.5v-1zm-6 8A1.5 1.5 0 0 1 1.5 10h1A1.5 1.5 0 0 1 4 11.5v1A1.5 1.5 0 0 1 2.5 14h-1A1.5 1.5 0 0 1 0 12.5v-1zm6 0A1.5 1.5 0 0 1 7.5 10h1a1.5 1.5 0 0 1 1.5 1.5v1A1.5 1.5 0 0 1 8.5 14h-1A1.5 1.5 0 0 1 6 12.5v-1zm6 0a1.5 1.5 0 0 1 1.5-1.5h1a1.5 1.5 0 0 1 1.5 1.5v1a1.5 1.5 0 0 1-1.5 1.5h-1a1.5 1.5 0 0 1-1.5-1.5v-1z"})})}var f=n(34609);function m(){var e=(0,c.EB)(),t=e((function(e){return e.selectedDescriptions})),n=e((function(e){return"gui"!==e.type||e.graphVisualization||1!==e.selectedDescriptions.length?void 0:(0,l.Bc)(e.grammar,e.dependencyMap,e.selectedDescriptions[0])}),l.wU);return 1!=t.length?(0,r.jsx)("div",{className:"d-flex align-items-center justify-content-center flex-grow-1",children:(0,r.jsx)("span",{children:0===t.length?"Nothing Selected":"Multiple Descriptions Selected"})}):null==n?null:(0,r.jsx)("div",{className:"position-relative flex-grow-1",children:(0,r.jsxs)("div",{style:{whiteSpace:"pre-wrap",tabSize:2},className:"m-3",children:[(0,l.qC)(n,g(t[0]))(0),(0,r.jsxs)("div",{style:{position:"fixed",right:"1rem",bottom:"1rem"},className:"d-flex flex-row align-items-center",children:[(0,r.jsx)(f.Z,{placement:"top",overlay:"Toggle Graph",children:(0,r.jsx)("button",{className:"d-flex align-items-center btn btn-sm btn-secondary me-2",onClick:function(){return e.getState().setGraphVisualization(!0)},children:(0,r.jsx)(d,{})})}),(0,r.jsx)(f.Z,{placement:"topRight",overlay:"Edit Text",children:(0,r.jsx)("button",{className:"d-flex align-items-center btn btn-sm btn-secondary",onClick:function(){return e.getState().setType("tui")},children:(0,r.jsx)(u,{})})})]})]})})}function h(e){var t=e.value,n=e.description,s=e.indentation,u=(0,c.EB)(),d=(0,i.useMemo)((function(){var e=u.getState(),n=e.onEndHover,r=e.onStartHover,i=e.select;return{onMouseLeave:n.bind(null,t,void 0),onMouseEnter:r.bind(null,t,void 0),onClick:i.bind(null,t,void 0,void 0)}}),[u,t]),f=(0,c.HY)().operationGuiMap,m=u(x.bind(null,t)),h=y(t,n);return h&&(d=void 0,m=(null!==m&&void 0!==m?m:"")+" text-muted"),"string"===typeof t?(0,r.jsx)("span",(0,a.Z)((0,o.Z)({},d),{className:m,children:(0,l.nH)(t,n)})):"symbol"===t.type?(0,r.jsx)("span",(0,a.Z)((0,o.Z)({},d),{className:m,children:(0,l.nH)(t.identifier,n)})):!(0,p.I)(f,t)||h?(0,r.jsx)("span",(0,a.Z)((0,o.Z)({},d),{className:m,children:(0,r.jsx)(v,{indentation:s,description:n,value:t})})):(0,r.jsx)("span",{className:m,children:(0,l.g3)(t,g(n),s)(0,d)})}function v(e){var t=e.value,n=e.description,i=e.indentation;return(0,r.jsx)(r.Fragment,{children:(0,l.Wv)(t,i,l.Ej.bind(null,n),l.lv)})}function y(e,t){return(0,l.BZ)((0,l.Il)(e)[0])!==t}function g(e){return(0,l.Qx)((function(t,n){return function(r,s){var l=y(n,e);return(0,i.createElement)("span",(0,a.Z)((0,o.Z)({className:l?"text-muted":void 0},l?{}:s),{key:r}),t)}}),(function(t,n){return function(i){return(0,r.jsx)(h,{indentation:t,description:e,value:n},i)}}),(function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(e,n){return(0,r.jsx)(i.Fragment,{children:t.map((function(e,t){return e(t,n)}))},e)}}),(function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return function(t,r){return(0,i.createElement)("span",(0,a.Z)((0,o.Z)({},r),{key:t}),l.lv.apply(void 0,[e].concat((0,s.Z)(n))))}}))}function x(e,t){if("gui"==t.type)return-1!=t.selectionsList.findIndex((function(t){return t.steps==e}))?"selected":null!=t.hovered&&t.hovered.steps===e?"hovered":void 0}var b=n(46508);function w(){var e=(0,c.EB)(),t=e((function(e){return"tui"===e.type?e.text:void 0})),n=e((function(e){return"tui"!==e.type||e.correct?void 0:e.error}));return null==t&&null==n?null:(0,r.jsxs)("div",{className:"d-flex position-relative flex-grow-1",children:[(0,r.jsx)("textarea",{autoFocus:!0,style:{resize:"none",outline:0,tabSize:2},value:t,onKeyDown:function(t){return function(e,t){if("Tab"===e.code){e.preventDefault();var n=e.currentTarget.value,r=e.currentTarget.selectionStart,i=e.currentTarget.selectionEnd;return t(n.substring(0,r)+"\t"+n.substring(i)),!1}}(t,e.getState().setText)},spellCheck:!1,onChange:function(t){return e.getState().setText(t.target.value)},className:"bg-transparent p-3 border-0 flex-basis-0 flex-grow-1 text-light"}),null==n?(0,r.jsx)("button",{className:"d-flex align-items-center btn btn-sm btn-primary",style:{position:"absolute",right:"1rem",bottom:"1rem"},onClick:function(){return e.getState().setType("gui")},children:(0,r.jsx)(u,{})}):(0,r.jsx)(b.B,{style:{position:"fixed",bottom:"1rem",right:"1rem"},align:"right",message:n})]})}var j=n(61916);function S(){return(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",className:"bi bi-x",viewBox:"0 0 16 16",children:(0,r.jsx)("path",{d:"M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z"})})}function M(e){var t=e.fulfill,n=e.data,o=(0,c.EB)(),a=(0,i.useState)(""),s=a[0],l=a[1],u=(0,i.useMemo)((function(){if(0===s.length)return!1;var e=o.getState();return"gui"!=e.type||Object.keys(e.grammar).includes(s)}),[s]),p=(0,i.useCallback)((function(e){var r;null!=t&&t("".concat(e).concat(null!==(r=null===n||void 0===n?void 0:n.suffix)&&void 0!==r?r:""))}),[t,null===n||void 0===n?void 0:n.suffix]);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("input",{onKeyDown:function(e){return"Enter"===e.key&&p(s)},autoFocus:!0,type:"text",className:"form-control form-control-sm mb-3",onChange:function(e){return l(e.target.value)},value:s,placeholder:"Description name"}),(0,r.jsxs)("div",{className:"d-flex flex-row align-items-center justify-content-end",children:[(0,r.jsx)("button",{className:"d-flex align-items-center ms-3 btn btn-sm btn-outline-secondary",onClick:o.getState().cancelRequest,children:(0,r.jsx)(S,{})}),(0,r.jsx)("button",{className:"d-flex align-items-center ms-3 btn btn-sm btn-outline-secondary",onClick:function(){return p(s)},disabled:u,children:(0,r.jsx)(j.n,{})})]})]})}var E=n(47568),O=n(70655),N=n(65201),P=n(67551);function Z(e){var t=e.fulfill,n=(0,c.EB)(),o=(0,c.HY)().operations,a=(0,i.useState)(""),u=a[0],p=a[1],d=(0,i.useMemo)((function(){return function(e,t){return(0,l.Eo)(e).filter((function(e){var t=e.type;return"parallel"!=t&&"sequential"!=t})).map((function(e){return{label:"operation"===e.type?e.identifier:e.type,onSelect:t.bind(null,e)}}))}(o,(function(e){return t({step:function(){return(0,l.o9)(e,o)}})}))}),[t,o]),f=(0,i.useCallback)(function(){var e=(0,E.Z)((function(e){var n;return(0,O.__generator)(this,(function(r){switch(r.label){case 0:return[4,navigator.clipboard.readText()];case 1:n=r.sent();try{t({randomize:e,step:function(e){return l.IX.apply(void 0,[JSON.parse(n).step,(0,l.BZ)(e[0])].concat((0,s.Z)(e)))},dependencies:function(e){var t=JSON.parse(n);if(null!=t.dependencies)return(0,l.l3)((0,l.z_)((0,N.vV)(t.dependencies),e))}})}catch(i){}return[2]}}))}));return function(t){return e.apply(this,arguments)}}(),[n]),m=(0,i.useMemo)((function(){return d.filter((function(e){return e.label.toLocaleLowerCase().includes(u.toLocaleLowerCase())}))}),[u,d]);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"d-flex flex-row mb-2",children:[(0,r.jsx)("input",{onKeyDown:function(e){return"Enter"===e.key&&1===m.length&&m[0].onSelect()},autoFocus:!0,type:"text",className:"form-control form-control-sm",onChange:function(e){return p(e.target.value)},value:u,placeholder:"Search"}),(0,r.jsx)("button",{className:"d-flex h-100 align-items-center ms-3 btn btn-sm btn-outline-secondary",onClick:n.getState().cancelRequest,children:(0,r.jsx)(S,{})})]}),(0,r.jsxs)("div",{className:"d-flex flex-row",children:[(0,r.jsx)(P.l9,{className:"mb-2 btn-btn-sm button-secondary btn-outline-secondary flex-grow-1",onPaste:f.bind(null,!1),children:"Paste Unrandomized"}),(0,r.jsx)(P.l9,{className:"mb-2 btn-btn-sm button-secondary btn-outline-secondary ms-2 flex-grow-1",onPaste:f.bind(null,!0),children:"Paste Randomized"})]}),(0,r.jsx)("div",{className:"d-flex flex-column",style:{overflowY:"auto"},children:m.map((function(e){var t=e.label,n=e.onSelect;return(0,r.jsx)("div",{className:"rounded pointer p-3 border-bottom",onClick:n,children:t},t)}))})]})}function V(e){var t=e.data,n=t.patterns,i=t.title,o=e.fulfill,a=(0,c.EB)();return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"d-flex flex-row align-items-center",children:[(0,r.jsx)("h5",{children:i}),(0,r.jsx)("div",{className:"flex-grow-1"}),(0,r.jsx)("button",{className:"d-flex align-items-center ms-3 btn btn-sm btn-outline-secondary",onClick:a.getState().cancelRequest,children:(0,r.jsx)(S,{})})]}),(0,r.jsx)("div",{className:"d-flex flex-column",style:{overflowY:"auto"},children:n.map((function(e,t){return(0,r.jsx)("button",{onClick:o.bind(null,e),className:"mt-3 btn btn-outline-primary w-100",children:e.description},t)}))})]})}function C(e){var t=e.fulfill,n=(0,c.EB)(),o=(0,i.useState)(""),a=o[0],s=o[1],l=(0,i.useMemo)((function(){if(0===a.length)return!1;var e=n.getState();return"gui"!=e.type||Object.keys(e.grammar).includes(a)}),[a]),u=(0,i.useCallback)((function(e){null!=t&&t(e)}),[t]);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("input",{onKeyDown:function(e){return"Enter"===e.key&&u(a)},autoFocus:!0,type:"text",className:"form-control form-control-sm mb-3",onChange:function(e){return s(e.target.value)},value:a,placeholder:"Noun name"}),(0,r.jsxs)("div",{className:"d-flex flex-row align-items-center justify-content-end",children:[(0,r.jsx)("button",{className:"d-flex align-items-center ms-3 btn btn-sm btn-outline-secondary",onClick:n.getState().cancelRequest,children:(0,r.jsx)(S,{})}),(0,r.jsx)("button",{className:"d-flex align-items-center ms-3 btn btn-sm btn-outline-secondary",onClick:function(){return u(a)},disabled:l,children:(0,r.jsx)(j.n,{})})]})]})}var z=n(11281);function k(e){var t=e.data,n=(0,i.useState)(void 0),o=n[0],a=n[1];return null==o?(0,r.jsx)(B,{descriptions:t,onSummary:a}):(0,r.jsx)(D,{summary:o})}function D(e){var t=e.summary,n=(0,c.EB)();return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"d-flex flex-row mb-3",children:[(0,r.jsx)("div",{className:"flex-grow-1"}),(0,r.jsx)("button",{className:"d-flex h-100 align-items-center ms-3 btn btn-sm btn-outline-secondary",onClick:n.getState().cancelRequest,children:(0,r.jsx)(S,{})})]}),(0,r.jsx)("span",{style:{overflowY:"auto",whiteSpace:"pre-wrap"},className:"p-3 rounded mb-3 text-light bg-dark text-editor p-1",children:(0,l.y0)(t,void 0,l.lv)}),(0,r.jsx)(P.qi,{className:"btn btn-sm btn-outline-primary",onCopy:function(){return JSON.stringify({step:{type:"symbol",identifier:t[0].name},dependencies:t})},children:"Copy"})]})}function B(e){var t=e.descriptions,n=e.onSummary,o=(0,c.EB)(),a=(0,i.useState)(""),u=a[0],p=a[1],d=o((function(e){return e.grammar.map((function(e){return e.name}))}),l.wU),f=(0,i.useState)([]),m=f[0],h=f[1],v=(0,i.useMemo)((function(){return d.filter((function(e){return t.includes((0,l.BZ)(e))&&e.toLocaleLowerCase().includes(u.toLocaleLowerCase())}))}),[u,d]),y=(0,i.useCallback)((function(){return h((function(e){var t=(0,s.Z)(e),n=!0,r=!1,i=void 0;try{for(var o,a=v[Symbol.iterator]();!(n=(o=a.next()).done);n=!0){var l=o.value;t.includes(l)||t.push(l)}}catch(c){r=!0,i=c}finally{try{n||null==a.return||a.return()}finally{if(r)throw i}}return t}))}),[v]),g=(0,i.useCallback)((function(){return h((function(e){return e.filter((function(e){return!v.includes(e)}))}))}),[v]);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"d-flex flex-row mb-3",children:[(0,r.jsx)("input",{onKeyDown:function(e){return"Enter"===e.key&&m.length>=1&&null},autoFocus:!0,type:"text",className:"form-control form-control-sm",onChange:function(e){return p(e.target.value)},value:u,placeholder:"Search"}),(0,r.jsx)("button",{className:"d-flex h-100 align-items-center ms-3 btn btn-sm btn-outline-secondary",onClick:function(){return n(function(e,t){var n=e.getState();if("gui"!==n.type)return;var r=n.dependencyMap,i=t.map((function(e){return(0,l.hs)((0,l.AJ)(e,n.grammar,r),void 0)}));return l.Iz.apply(void 0,(0,s.Z)(i))}(o,m))},children:(0,r.jsx)(j.n,{})}),(0,r.jsx)("button",{className:"d-flex h-100 align-items-center ms-3 btn btn-sm btn-outline-secondary",onClick:o.getState().cancelRequest,children:(0,r.jsx)(S,{})})]}),(0,r.jsxs)("div",{className:"d-flex flex-column",style:{overflowY:"auto"},children:[(0,r.jsxs)("div",{className:"btn-group w-100 mb-2",children:[(0,r.jsx)("button",{className:"btn btn-sm btn-outline-secondary",onClick:y,children:"Select All"}),(0,r.jsx)("button",{className:"btn btn-sm btn-outline-secondary",onClick:g,children:"Unselect All"})]}),v.map((function(e){var t=m.includes(e);return(0,r.jsx)("div",{className:"m-2",children:(0,r.jsx)(z.v,{value:e,children:(0,r.jsx)("input",{onChange:function(){return h(t?m.filter((function(t){return t!=e})):m.concat(e))},type:"checkbox",checked:t})})},e)}))]})]})}function A(){var e=(0,c.g4)((function(e){return"gui"===e.type?e.requested:void 0}));return null==e?null:(0,r.jsx)("div",{className:"position-absolute d-flex flex-column align-items-center overflow-hidden",style:{top:0,right:0,bottom:0,left:0,zIndex:2,background:"rgba(0,0,0,0.3)"},children:(0,r.jsx)("div",{style:{maxWidth:"40rem",margin:"0 auto"},className:"rounded overflow-hidden shadow d-flex flex-column m-3 p-3 w-100 bg-light",children:T(e.data,e.type,e.fulfill)})})}function T(e,t,n){switch(t){case"summarize":return(0,r.jsx)(k,{data:e});case"create-step":return(0,r.jsx)(Z,{fulfill:n});case"create-description":return(0,r.jsx)(M,{data:e,fulfill:n});case"set-name":return(0,r.jsx)(C,{fulfill:n});case"select-condition":return(0,r.jsx)(V,{data:e,fulfill:n})}}var L=n(69647),q=n(24528),G=n(70681);function Q(e,t,n,r,i,o,a){if("sequential"!==r.type)if("parallel"!==r.type){var s=Y(r,o,a);if(I(r,"step",{content:(0,l.gK)(r,i),hasParameters:null!=s.find((function(e){return!e.isMain}))},e,n),R(s,t,n),null!=r.children)for(var c=function(e){return"random"===e.type||"if"===e.type||"switch"===e.type}(r),u=0;u<r.children.length;u++)$(r,u,o)&&Q(e,t,n,r.children[u],i,o,c?a:void 0)}else{var p=!0,d=!1,f=void 0;try{for(var m,h=r.children[Symbol.iterator]();!(p=(m=h.next()).done);p=!0){Q(e,t,n,m.value,i,o,a)}}catch(g){d=!0,f=g}finally{try{p||null==h.return||h.return()}finally{if(d)throw f}}}else for(var v=0;v<r.children.length;v++){var y;Q(e,t,n,r.children[v],i,o,null!==(y=r.children[v+1])&&void 0!==y?y:a)}}function I(e,t,n,r,i){var s=W(e);r.push({data:(0,a.Z)((0,o.Z)({},n),{value:e}),type:t,id:s,position:{x:0,y:0},connectable:!1,selectable:!1,draggable:!1}),i.setNode(s,{width:130,height:70})}function R(e,t,n){var r=!0,i=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(r=(a=s.next()).done);r=!0){var l=a.value,c=l.isMain,u=l.label,p=l.source,d=l.target,f=W(p),m=W(d);n.setEdge(f,m,{}),t.push({id:F(f,m),sourceHandle:c?"main":"parameter",source:f,target:m,label:u,animated:!0,style:c?{stroke:"#88f",strokeWidth:4}:{stroke:"#999",strokeWidth:2}})}}catch(h){i=!0,o=h}finally{try{r||null==s.return||s.return()}finally{if(i)throw o}}}function $(e,t,n){switch(e.type){case"switch":case"if":return t>0;case"operation":return(0,p.I)(n,e);default:return!0}}function Y(e,t,n){if("name"in e)return X(e.step).map((function(t){return{isMain:!0,label:void 0,source:e.name,target:t}}));var r=null==n?[]:X(n).map((function(t){return{isMain:!0,label:void 0,source:e,target:t}}));switch(e.type){case"random":return e.children.reduce((function(t,n,r){return t.concat(X(n).map((function(t){return{source:e,label:"".concat((100*e.probabilities[r]).toFixed(),"%"),isMain:!0,target:t}})))}),[]);case"if":return X(e.children[1]).map((function(t){return{source:e,label:"then",isMain:!0,target:t}})).concat(X(e.children[2]).map((function(t){return{source:e,label:"else",isMain:!0,target:t}})));case"switch":return e.children.slice(1).reduce((function(t,n,r){return t.concat(X(n).map((function(t){return{source:e,label:"case ".concat(e.cases[r]),isMain:!0,target:t}})))}),[]);default:var i="operation"!==e.type||(0,p.I)(t,e)?e.children:void 0;return null!=i?r.concat(i.reduce((function(t,n){return t.concat(X(n).map((function(t){return{isMain:!1,label:void 0,source:e,target:t}})))}),[])):r}}function X(e){return"parallel"===e.type?e.children.reduce((function(e,t){return e.concat(X(t))}),[]):"sequential"===e.type?X(e.children[0]):[e]}function F(e,t){return"".concat(e,"-").concat(t)}function W(e){return"string"===typeof e?"noun-".concat(e):"step-".concat(e.path.join(","))}var U={step:function(e){var t=e.data,n=t.value,i=t.content,o=t.hasParameters,a=(0,c.g4)((function(e){return H(n,e)}));return(0,r.jsxs)("div",{style:{width:100,height:40,overflow:"hidden"},className:"".concat(a," align-items-center justify-content-center p-2 text-light position-relative border rounded d-flex flex-row align-items-center"),children:[(0,r.jsx)(L.HH,{type:"target",position:q.P.Left}),(0,r.jsx)("span",{children:i}),(0,r.jsx)(L.HH,{type:"source",id:"main",position:q.P.Right}),o&&(0,r.jsx)(L.HH,{type:"source",id:"parameter",position:q.P.Bottom})]})},noun:function(e){var t=e.data,n=t.content,i=t.value,o=(0,c.g4)((function(e){return H(i,e)}));return(0,r.jsxs)("div",{style:{padding:8,width:100,height:40,overflow:"hidden"},className:"".concat(o," align-items-center justify-content-center text-light position-relative border rounded scroll d-flex flex-row align-items-center"),children:[(0,r.jsx)("span",{style:{fontSize:16},children:n}),(0,r.jsx)(L.HH,{type:"source",position:q.P.Right})]})}};function H(e,t){if("gui"==t.type)return-1!=t.selectionsList.findIndex((function(t){return t.steps==e}))?"bg-selected":null!=t.hovered&&t.hovered.steps===e?"bg-hovered":void 0}function _(){var e=(0,c.EB)(),t=e((function(e){return e.selectedDescriptions})),n=e((function(e){return"gui"===e.type&&e.graphVisualization&&1===e.selectedDescriptions.length?(0,l.Bc)(e.grammar,e.dependencyMap,e.selectedDescriptions[0]):void 0}),l.wU),o=(0,c.HY)().operationGuiMap,a=(0,i.useMemo)((function(){if(null==n||1!=t.length)return[];var e=[],r=[];return function(e,t,n,r,i){var o=new G.graphlib.Graph;o.setGraph({rankdir:"LR"});var a=!0,s=!1,c=void 0;try{for(var u,p=n[Symbol.iterator]();!(a=(u=p.next()).done);a=!0){var d=u.value,f=(0,l.Ik)(d.name,r);I(d.name,"noun",{content:f},e,o),R(Y(d,i,void 0),t,o),Q(e,t,o,d.step,r,i,void 0)}}catch(E){s=!0,c=E}finally{try{a||null==p.return||p.return()}finally{if(s)throw c}}(0,G.layout)(o);var m=!0,h=!1,v=void 0;try{for(var y,g=e[Symbol.iterator]();!(m=(y=g.next()).done);m=!0){var x=y.value,b=o.node(x.id),w=b.x,j=b.y,S=b.width,M=b.height;x.targetPosition=q.P.Left,x.sourcePosition=q.P.Right,x.position.x=w-S/2,x.position.y=j-M/2}}catch(E){h=!0,v=E}finally{try{m||null==g.return||g.return()}finally{if(h)throw v}}}(e,r,n,t[0],o),[e,r]}),[n,t,o]),s=a[0],p=a[1];return 1!=t.length?(0,r.jsx)("div",{className:"d-flex align-items-center justify-content-center flex-grow-1",children:(0,r.jsx)("span",{children:0===t.length?"Nothing Selected":"Multiple Descriptions Selected"})}):null==n?null:(0,r.jsxs)("div",{className:"position-relative flex-grow-1",children:[(0,r.jsx)(L.ZP,{nodeTypes:U,style:{zIndex:0},nodes:s,edges:p,onNodeClick:function(t,n){return e.getState().select(n.data.value,void 0,e.getState().shift?"add":"replace")},onNodeMouseEnter:function(t,n){return e.getState().onStartHover(n.data.value,void 0)},onNodeMouseLeave:function(t,n){return e.getState().onEndHover(n.data.value)},connectionLineType:q.q.SmoothStep}),(0,r.jsxs)("div",{style:{position:"fixed",right:"1rem",bottom:"1rem"},className:"d-flex flex-row align-items-center",children:[(0,r.jsx)(f.Z,{placement:"top",overlay:"Toggle Graph",children:(0,r.jsx)("button",{className:"d-flex align-items-center btn btn-sm btn-primary me-2",onClick:function(){return e.getState().setGraphVisualization(!1)},children:(0,r.jsx)(d,{})})}),(0,r.jsx)(f.Z,{placement:"topRight",overlay:"Edit Text",children:(0,r.jsx)("button",{className:"d-flex align-items-center btn btn-sm btn-secondary",onClick:function(){return e.getState().setType("tui")},children:(0,r.jsx)(u,{})})})]})]})}function J(){var e=(0,c.EB)();(0,i.useEffect)((function(){var t=function(t){switch(t.key){case"Shift":case"Control":e.getState().setShift(!1)}},n=function(t){switch(t.key){case"Escape":e.getState().escape();break;case"Delete":t.target==document.body&&e.getState().removeStep();break;case"Shift":case"Control":e.getState().setShift(!0)}};return window.addEventListener("keydown",n),window.addEventListener("keyup",t),function(){window.removeEventListener("keydown",n),window.removeEventListener("keyup",t)}}),[e]);var t=(0,c.HY)().Viewer;return(0,r.jsxs)("div",{className:"d-flex responsive-flex-direction overflow-hidden position-absolute noselect",style:{top:0,right:0,left:0,bottom:0},children:[(0,r.jsx)(A,{}),(0,r.jsx)(t,{style:{whiteSpace:"pre-line",top:0,left:0,right:0,bottom:0},className:"flex-basis-0 flex-grow-1 bg-white"}),(0,r.jsx)(K,{})]})}function K(){var e=(0,c.g4)((function(e){return e.showTui?"tui"===e.type?w:e.graphVisualization?_:m:void 0}));return null==e?null:(0,r.jsx)("div",{className:"max-responsive-size-35 scroll text-editor text-light flex-basis-0 flex-grow-1 bg-dark d-flex",children:(0,r.jsx)(e,{})})}},46508:function(e,t,n){n.d(t,{B:function(){return c}});var r=n(26042),i=n(69396),o=n(99534),a=n(85893),s=n(67294);function l(){return(0,a.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",className:"bi bi-exclamation-octagon",viewBox:"0 0 16 16",children:[(0,a.jsx)("path",{d:"M4.54.146A.5.5 0 0 1 4.893 0h6.214a.5.5 0 0 1 .353.146l4.394 4.394a.5.5 0 0 1 .146.353v6.214a.5.5 0 0 1-.146.353l-4.394 4.394a.5.5 0 0 1-.353.146H4.893a.5.5 0 0 1-.353-.146L.146 11.46A.5.5 0 0 1 0 11.107V4.893a.5.5 0 0 1 .146-.353L4.54.146zM5.1 1 1 5.1v5.8L5.1 15h5.8l4.1-4.1V5.1L10.9 1H5.1z"}),(0,a.jsx)("path",{d:"M7.002 11a1 1 0 1 1 2 0 1 1 0 0 1-2 0zM7.1 4.995a.905.905 0 1 1 1.8 0l-.35 3.507a.552.552 0 0 1-1.1 0L7.1 4.995z"})]})}function c(e){var t=e.align,n=e.message,c=e.className,u=(0,o.Z)(e,["align","message","className"]),p=(0,s.useState)(!1),d=p[0],f=p[1];return(0,a.jsxs)("div",(0,i.Z)((0,r.Z)({},u),{className:"".concat(c," d-flex flex-column ").concat("left"===t?"align-items-start":"align-items-end"),children:[d&&(0,a.jsx)("div",{style:{overflowY:"auto",fontSize:"0.8rem",overflowX:"hidden",maxWidth:"20rem",maxHeight:"8rem",whiteSpace:"pre-line",bottom:24},className:"rounded position-absolute mb-2 p-2 bg-danger text-light",children:n}),(0,a.jsx)("div",{onClick:function(){return f((function(e){return!e}))},className:"btn btn-sm btn-danger d-flex align-items-center",children:(0,a.jsx)(l,{})})]}))}},82906:function(e,t,n){n.d(t,{EB:function(){return l},HY:function(){return s},g4:function(){return c},gb:function(){return u},op:function(){return a}});var r=n(99534),i=n(85893),o=n(67294),a=(0,o.createContext)(null),s=function(){return(0,o.useContext)(a)};function l(){return(0,o.useContext)(a).store}function c(e,t){return l()(e,t)}function u(e){var t=e.children,n=(0,r.Z)(e,["children"]);return(0,i.jsx)(a.Provider,{value:n,children:t})}},41046:function(e,t,n){n.d(t,{A:function(){return l}});var r=n(26042),i=n(69396),o=n(99534),a=n(85893),s=n(67294);function l(e){var t=e.value,n=e.onBlur,l=(0,o.Z)(e,["value","onBlur"]),c=(0,s.useState)(t),u=c[0],p=c[1];return(0,s.useEffect)((function(){return p(t)}),[t]),(0,a.jsx)("input",(0,i.Z)((0,r.Z)({},l),{value:u,onChange:function(e){return p(e.target.value)},onKeyDown:function(e){return"Enter"===e.key&&e.currentTarget.blur()},onBlur:function(e){null!=n&&e.target.value!=t&&n(e)}}))}},65509:function(e,t,n){n.d(t,{X:function(){return z},I:function(){return P}});var r=n(26042),i=n(69396),o=n(99534),a=n(85893),s=n(82513),l=n(67294),c=n(82906),u=n(61916),p=n(68617),d=n(34609);function f(){return(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",className:"bi bi-arrow-left-right",viewBox:"0 0 16 16",children:(0,a.jsx)("path",{fillRule:"evenodd",d:"M1 11.5a.5.5 0 0 0 .5.5h11.793l-3.147 3.146a.5.5 0 0 0 .708.708l4-4a.5.5 0 0 0 0-.708l-4-4a.5.5 0 0 0-.708.708L13.293 11H1.5a.5.5 0 0 0-.5.5zm14-7a.5.5 0 0 1-.5.5H2.707l3.147 3.146a.5.5 0 1 1-.708.708l-4-4a.5.5 0 0 1 0-.708l4-4a.5.5 0 1 1 .708.708L2.707 4H14.5a.5.5 0 0 1 .5.5z"})})}var m=n(11281);function h(e){var t=e.step,n=e.values,r=(0,c.EB)();return(0,a.jsxs)("div",{className:"d-flex flex-column mb-3 mx-3",children:[(0,a.jsx)(m.w,{onClick:function(e){return r.getState().selectChildren(t,n,t.children[0])},value:"Condition",className:"pointer mb-3",children:(0,a.jsx)("div",{className:"flex-grow-1 text-end px-2",children:(0,s.Wv)(t.children[0])})}),(0,a.jsxs)(m.w,{onClick:function(e){return r.getState().selectChildren(t,n,t.children[1])},value:"Then",className:"pointer mb-3",children:[(0,a.jsx)("div",{className:"flex-grow-1 text-end px-2",children:(0,s.Wv)(t.children[1])}),(0,a.jsx)(d.Z,{placement:"left",overlay:"Replace with this",children:(0,a.jsx)("button",{onClick:function(){return r.getState().replace((function(){return t.children[1]}),t)},className:"btn btn-sm btn-outline-primary",children:(0,a.jsx)(f,{})})})]}),(0,a.jsxs)(m.w,{onClick:function(e){return r.getState().selectChildren(t,n,t.children[2])},value:"Else",className:"pointer mb-3",children:[(0,a.jsx)("div",{className:"flex-grow-1 text-end px-2",children:(0,s.Wv)(t.children[2])}),(0,a.jsx)(d.Z,{placement:"left",overlay:"Replace with this",children:(0,a.jsx)("button",{onClick:function(){return r.getState().replace((function(){return t.children[2]}),t)},className:"btn btn-sm btn-outline-primary",children:(0,a.jsx)(f,{})})})]})]})}var v=n(828);function y(e){var t,n,r=e.label,i=e.className,o=e.values,s=e.onChange,c=e.selectAll,u=e.unselectAll,p=(0,l.useState)(!1),d=p[0],f=p[1],h=(0,l.useState)(),y=h[0],g=h[1],x=null===y||void 0===y?void 0:y.getBoundingClientRect();return(0,a.jsxs)("div",{className:"".concat(i," d-flex"),children:[(0,a.jsx)("button",{ref:g,onClick:function(){return f((function(e){return!e}))},className:"btn-sm btn-outline-secondary btn flex-grow-1 dropdown-toggle",type:"button",children:r}),o.length>0&&(0,a.jsx)("div",{style:{width:null===x||void 0===x?void 0:x.width,top:(null!==(t=null===x||void 0===x?void 0:x.top)&&void 0!==t?t:0)+(null!==(n=null===x||void 0===x?void 0:x.height)&&void 0!==n?n:0),bottom:"4rem"},className:"d-flex flex-column overflow-hidden position-absolute ".concat(d?"":"visually-hidden"),children:(0,a.jsxs)("div",{className:"overflow-hidden d-flex flex-column w-100 pt-2 bg-light rounded border",children:[(0,a.jsxs)("div",{className:"btn-group w-100 px-2 mb-2",children:[(0,a.jsx)("button",{className:"btn btn-sm btn-outline-secondary",onClick:c,children:"Select All"}),(0,a.jsx)("button",{className:"btn btn-sm btn-outline-secondary",onClick:u,children:"Unselect All"})]}),(0,a.jsx)("div",{className:"d-flex flex-column scroll",children:o.map((function(e,t){var n=(0,v.Z)(e,3),r=n[0],i=n[1],o=n[2];return(0,a.jsx)("div",{className:"mx-3 mb-2",children:(0,a.jsx)(m.v,{value:r,children:(0,a.jsx)("input",{onChange:function(e){return s(o,e.target.checked,t)},type:"checkbox",checked:i})})},r)}))})]})})]})}var g=n(41046),x=n(67551);function b(e){var t=e.value,n=e.descriptionName,r=(0,c.EB)(),i=(0,s.BZ)(t);return(0,a.jsxs)("div",{className:"d-flex flex-column",children:[(0,a.jsxs)("div",{className:"d-flex flex-row align-items-center mx-3 mb-2 w-auto",children:[(0,a.jsx)(g.A,{value:(0,s.nH)(t,i),className:"flex-grow-1 form-control form-control-sm",onBlur:function(e){return r.getState().renameNoun((0,s.BW)(e.target.value,i))}}),i!==n&&(0,a.jsxs)("span",{className:"ms-1",children:["@",n]})]}),(0,a.jsx)(x.qi,{className:"mb-3 mx-3 btn btn-sm btn-outline-secondary",onCopy:function(){return function(e,t){if("gui"!==e.getState().type)return"";return JSON.stringify({step:{type:"symbol",identifier:t}})}(r,t)},children:"Copy Reference"})]})}function w(e){var t,n=e.step,r=e.values,i=(0,c.HY)(),o=i.operationGuiMap,s=i.operations,l=o[n.identifier];return null!=l?(0,a.jsx)(l,{value:n}):void 0!=(null===(t=s[n.identifier])||void 0===t?void 0:t.defaultParameters)?(0,a.jsx)(j,{value:n,values:r}):null}function j(e){var t=e.value,n=e.values,r=(0,c.EB)();return(0,a.jsxs)("div",{className:"d-flex flex-column mx-3 mb-3",children:[t.children.map((function(e,i){return(0,a.jsxs)("div",{className:"d-flex flex-row align-items-center border-bottom",children:[(0,a.jsx)("div",{className:"flex-grow-1 p-3 pointer",onClick:function(i){return r.getState().selectChildren(t,n,e)},children:(0,s.Wv)(e)}),(0,a.jsx)(d.Z,{placement:"left",overlay:"Delete",children:(0,a.jsx)("div",{onClick:function(){return r.getState().replace((function(e){e.children.splice(i,1)}),t)},className:"d-flex align-items-center ms-2 btn btn-sm btn-outline-danger",children:(0,a.jsx)(p.p,{})})})]},i)})),(0,a.jsx)("div",{className:"btn btn-outline-success",onClick:function(){return r.getState().replace((function(e){e.children.push({type:"this"})}),t)},children:"Add Parameter"})]})}function S(e){var t=e.step,n=e.values,r=(0,c.EB)();return(0,a.jsxs)("div",{className:"d-flex flex-column mx-3 mb-3",children:[t.children.map((function(e,i){return(0,a.jsxs)("div",{className:"d-flex flex-row align-items-center border-bottom",children:[(0,a.jsx)(g.A,{className:"form-control form-control-sm",type:"text",value:100*t.probabilities[i],onBlur:function(e){return r.getState().replace((function(t){var n;t.probabilities[i]=(n=e.target.value,parseFloat(n)/100)}),t)}}),(0,a.jsx)("div",{className:"flex-grow-1 ms-2 p-3 pointer",onClick:function(i){return r.getState().selectChildren(t,n,e)},children:(0,s.Wv)(e)}),(0,a.jsx)(d.Z,{placement:"left",overlay:"Replace with this",children:(0,a.jsx)("button",{onClick:function(){return r.getState().replace((function(){return e}),t)},className:"btn ms-2 btn-sm btn-outline-primary",children:(0,a.jsx)(f,{})})}),(0,a.jsx)(d.Z,{placement:"left",overlay:"Delete",children:(0,a.jsx)("div",{onClick:function(){return r.getState().replace((function(e){e.children.splice(i,1),e.probabilities.splice(i,1)}),t)},className:"d-flex align-items-center ms-2 btn btn-sm btn-outline-danger",children:(0,a.jsx)(p.p,{})})})]},i)})),(0,a.jsx)("div",{onClick:function(){return r.getState().replace((function(e){e.children.push({type:"this"}),e.probabilities.push(0)}),t)},className:"btn btn-outline-success",children:"Add"})]})}function M(e){if("true"===e||"false"===e)return"true"===e;var t=parseInt(e);return isNaN(t)?e:t}function E(e){var t=e.step,n=(0,c.EB)();return(0,a.jsx)(g.A,{value:t.value,className:"mx-3 mb-3 w-auto form-control form-control-sm",onBlur:function(e){return n.getState().replace((function(t){t.value=M(e.target.value)}),t)}})}function O(e){var t=e.step,n=e.values,r=(0,c.EB)();return(0,a.jsxs)("div",{className:"d-flex flex-column mb-3 mx-3",children:[(0,a.jsx)(m.w,{onClick:function(e){return r.getState().selectChildren(t,n,t.children[0])},value:"Condition",className:"pointer mb-3",children:(0,a.jsx)("div",{className:"flex-grow-1 text-end px-2",children:(0,s.Wv)(t.children[0])})}),t.children.slice(1).map((function(e,i){return(0,a.jsxs)("div",{className:"d-flex flex-row align-items-center border-bottom mb-3",children:[(0,a.jsx)(g.A,{className:"form-control form-control-sm",type:"text",value:t.cases[i],onBlur:function(e){return r.getState().replace((function(t){t.cases[i]=[M(e.target.value)]}),t)}}),(0,a.jsx)("div",{className:"flex-grow-1 ms-2 p-3 pointer",onClick:function(i){return r.getState().selectChildren(t,n,e)},children:(0,s.Wv)(e)}),(0,a.jsx)(d.Z,{placement:"left",overlay:"Replace with this",children:(0,a.jsx)("button",{onClick:function(){return r.getState().replace((function(){return e}),t)},className:"btn btn-sm btn-outline-primary ms-2",children:(0,a.jsx)(f,{})})}),(0,a.jsx)(d.Z,{placement:"left",overlay:"Delete",children:(0,a.jsx)("div",{onClick:function(){r.getState().replace((function(e){e.children.splice(i,1),e.cases.splice(i,1)}),t)},className:"d-flex align-items-center ms-2 btn btn-sm btn-outline-danger",children:(0,a.jsx)(p.p,{})})})]},i)})),(0,a.jsx)("div",{onClick:function(){return r.getState().replace((function(e){e.children.push({type:"this"}),e.cases.push([0])}),t)},className:"btn btn-outline-success",children:"Add Case"})]})}function N(e){var t=e.step,n=e.description,r=(0,c.EB)(),i=r((function(e){return"gui"===e.type&&null!=e.selectedDescriptions?(0,s.nH)(t.identifier,n):void 0})),o=r((function(e){return"gui"===e.type&&null!=e.selectedDescriptions?e.grammar.map((function(e){return(0,s.nH)(e.name,n)})):void 0}));return null==o?null:(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(m.w,{value:"Noun",className:"mb-3 mx-3",children:(0,a.jsx)("select",{value:i,onChange:function(e){return r.getState().replace((function(t){t.identifier=e.currentTarget.value}),t)},className:"flex-grow-1 form-select form-select-sm",children:o.map((function(e){return(0,a.jsx)("option",{value:e,children:e},e)}))})}),null!=i&&i.includes("@")&&(0,a.jsxs)("div",{className:"mb-3 mx-3 btn btn-outline-secondary",onClick:function(){return r.getState().pasteNoun(n,t,i)},children:["Paste to ",n]})]})}function P(e,t){return"string"==typeof t||"operation"!==t.type||null==e[t.identifier]}function Z(e,t){e.getState().request("create-step",(function(n){var r=n.step,i=n.dependencies,o=n.randomize;return e.getState().insert(t,r,i,o)}))}function V(e){e.getState().request("create-step",(function(t){var n=t.step,r=t.dependencies,i=t.randomize;return e.getState().replace((function(e,t){return n(t)}),void 0,r,i)}))}function C(e){e.getState().request("set-name",(function(t){return e.getState().setName(t)}))}function z(e){var t=e.className,n=(0,o.Z)(e,["className"]),l=(0,c.EB)(),d=l((function(e){return e.selectedDescriptions})),f=l((function(e){return"gui"===e.type&&null==e.requested?e.selectionsList:void 0}));return null==f||0===f.length||null==d?null:(0,a.jsx)("div",(0,i.Z)((0,r.Z)({},n),{className:"".concat(t," d-flex flex-column px-0 pt-3"),children:(0,a.jsxs)("div",{className:"d-flex flex-column overflow-hidden",children:[(0,a.jsxs)("div",{style:{whiteSpace:"pre"},className:"btn-group mx-3 mb-1 d-flex",children:[(0,a.jsx)("button",{onClick:Z.bind(null,l,"before"),className:"btn btn-sm btn-outline-success flex-grow-1 flex-basis-0",children:"+ Before"}),(0,a.jsx)("button",{onClick:Z.bind(null,l,"parallel"),className:"btn btn-sm btn-outline-success flex-grow-1 flex-basis-0",children:"+ Parllel"}),(0,a.jsx)("button",{onClick:Z.bind(null,l,"after"),className:"btn btn-sm btn-outline-success flex-grow-1 flex-basis-0",children:"+ After"})]}),(0,a.jsxs)("div",{style:{whiteSpace:"pre"},className:"btn-group mx-3 mb-1 d-flex",children:[(0,a.jsx)("button",{onClick:V.bind(null,l),className:"btn btn-sm btn-outline-secondary flex-grow-1 flex-basis-0",children:"Replace"}),(0,a.jsx)(k,{})]}),(0,a.jsxs)("div",{style:{whiteSpace:"pre"},className:"btn-group mx-3 mb-3 d-flex",children:[(0,a.jsx)("button",{onClick:function(){l.getState().unselectAll()},className:"d-flex align-items-center justify-content-center btn btn-sm btn-outline-primary flex-grow-1 flex-basis-0",children:(0,a.jsx)(u.n,{})}),(0,a.jsx)("button",{onClick:l.getState().removeStep.bind(null,void 0),className:"d-flex align-items-center justify-content-center btn btn-sm btn-outline-danger flex-grow-1 flex-basis-0",children:(0,a.jsx)(p.p,{})})]}),(0,a.jsx)("div",{className:"scroll",children:d.map((function(e){var t=f.filter((function(t){return(0,s.Lr)(e,(0,s.Il)(t.steps)[0])}));return 0===t.length?null:(0,a.jsxs)("div",{className:"d-flex flex-column",children:[(0,a.jsx)("span",{style:{fontWeight:500},className:"text-bold mx-3 mb-2",children:e}),t.map((function(t){return(0,a.jsx)(D,{descriptionName:e,selections:t},(0,s.zq)(t.steps))}))]},e)}))})]})}))}function k(){var e=(0,c.EB)(),t=e((function(e){return 1===e.selectedDescriptions.length}));return(0,a.jsx)("button",{onClick:C.bind(null,e),className:"".concat(t?"":"disabled"," btn btn-sm btn-outline-secondary flex-grow-1 flex-basis-0"),children:"Set-Name"})}function D(e){var t=e.selections,n=e.descriptionName,r=(0,c.EB)(),i=(0,s.zq)(t.steps),o=r((function(e){return"gui"===e.type?e.valueMap:void 0})),u=(0,l.useMemo)((function(){return null!=o?o[i]:void 0}),[o]);return(0,a.jsxs)("div",{className:"d-flex flex-column",children:[(0,a.jsx)("label",{className:"mb-3 mx-3",children:(0,s.MG)(t.steps,n)}),(0,a.jsx)(A,{descriptionName:n,step:t.steps,values:t.values}),null!=u&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("button",{onClick:function(){return r.getState().autoSelectPattern(t)},className:"btn mx-3 btn-outline-secondary btn-sm mb-2",children:"auto-select pattern"}),(0,a.jsx)(y,{selectAll:function(){return r.getState().select(t.steps,void 0,"add")},unselectAll:function(){return r.getState().select(t.steps,void 0,"remove")},className:"mb-3 mx-3",label:"".concat(t.values.length,"/").concat(u.length," selected"),onChange:function(e,n){r.getState().select(t.steps,e,n?"add":"remove")},values:B(t,u)})]})]})}function B(e,t){return t.map((function(t){return["".concat(t.before.index.join(",")," -> ").concat(t.after.index.join(",")),null!=e.values.find((function(e){return(0,s.Up)(e.after.index,t.after.index)===s.J.Equal})),t]}))}function A(e){var t=e.step,n=e.values,r=e.descriptionName;if("string"===typeof t)return(0,a.jsx)(b,{descriptionName:r,value:t});switch(t.type){case"raw":return(0,a.jsx)(E,{step:t});case"symbol":return(0,a.jsx)(N,{description:r,step:t});case"operation":return(0,a.jsx)(w,{step:t,values:n});case"random":return(0,a.jsx)(S,{step:t,values:n});case"switch":return(0,a.jsx)(O,{step:t,values:n});case"if":return(0,a.jsx)(h,{step:t,values:n});default:return null}}},11281:function(e,t,n){n.d(t,{v:function(){return l},w:function(){return s}});var r=n(26042),i=n(69396),o=n(99534),a=n(85893);function s(e){var t=e.className,n=e.value,s=e.children,l=(0,o.Z)(e,["className","value","children"]);return(0,a.jsxs)("div",(0,i.Z)((0,r.Z)({className:"".concat(t," d-flex flex-row")},l),{children:[(0,a.jsx)("label",{style:{width:"4rem"},className:"mb-0 flex-shrink-0 form-label me-2",children:n}),s]}))}function l(e){var t=e.className,n=e.value,s=e.children,l=(0,o.Z)(e,["className","value","children"]);return(0,a.jsxs)("div",(0,i.Z)((0,r.Z)({className:"".concat(t," d-flex flex-row")},l),{children:[s,(0,a.jsx)("label",{className:"mb-0 flex-shrink-0 form-label ms-2",children:n})]}))}},67551:function(e,t,n){n.d(t,{l9:function(){return d},qi:function(){return f}});var r=n(47568),i=n(26042),o=n(69396),a=n(99534),s=n(70655),l=n(85893),c=n(67294),u=n(61916);function p(e){var t=e.asyncFn,n=e.shortcutKey,p=e.className,d=e.children,f=(0,a.Z)(e,["asyncFn","shortcutKey","className","children"]),m=(0,c.useState)(void 0),h=m[0],v=m[1],y=(0,c.useRef)();y.current=h;var g=(0,c.useCallback)((0,r.Z)((function(){return(0,s.__generator)(this,(function(e){switch(e.label){case 0:return[4,t()];case 1:return e.sent(),v(setTimeout((function(){return v(void 0)}),1e3)),[2]}}))})),[t]);return(0,c.useEffect)((function(){var e=function(e){e.key===n&&e.ctrlKey&&(e.stopPropagation(),e.preventDefault(),g())};return window.addEventListener("keydown",e),function(){null!=y.current&&clearTimeout(y.current),window.removeEventListener("keydown",e)}}),[]),null!=h?(0,l.jsx)("div",(0,o.Z)((0,i.Z)({},f),{className:"".concat(p," btn btn-success h1 btn-outline-success btn-sm text-light"),children:(0,l.jsx)(u.n,{})})):(0,l.jsx)("div",(0,o.Z)((0,i.Z)({},f),{className:"".concat(p," btn btn-sm"),onClick:g,children:d}))}function d(e){var t=e.onPaste,n=(0,a.Z)(e,["onPaste"]);return(0,l.jsx)(p,(0,o.Z)((0,i.Z)({},n),{shortcutKey:"v",asyncFn:(0,r.Z)((function(){var e;return(0,s.__generator)(this,(function(n){switch(n.label){case 0:return[4,navigator.clipboard.readText()];case 1:return e=n.sent(),[4,t(e)];case 2:return n.sent(),[2]}}))}))}))}function f(e){var t=e.onCopy,n=(0,a.Z)(e,["onCopy"]);return(0,l.jsx)(p,(0,o.Z)((0,i.Z)({},n),{shortcutKey:"c",asyncFn:(0,r.Z)((function(){var e;return(0,s.__generator)(this,(function(n){switch(n.label){case 0:return e=t(),[4,navigator.clipboard.writeText(e)];case 1:return n.sent(),[2]}}))}))}))}},61916:function(e,t,n){n.d(t,{n:function(){return i}});var r=n(85893);function i(){return(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",className:"bi bi-check",viewBox:"0 0 16 16",children:(0,r.jsx)("path",{d:"M10.97 4.97a.75.75 0 0 1 1.07 1.05l-3.99 4.99a.75.75 0 0 1-1.08.02L4.324 8.384a.75.75 0 1 1 1.06-1.06l2.094 2.093 3.473-4.425a.267.267 0 0 1 .02-.022z"})})}},68617:function(e,t,n){n.d(t,{p:function(){return i}});var r=n(85893);function i(){return(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",className:"bi bi-trash3",viewBox:"0 0 16 16",children:(0,r.jsx)("path",{d:"M6.5 1h3a.5.5 0 0 1 .5.5v1H6v-1a.5.5 0 0 1 .5-.5ZM11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3A1.5 1.5 0 0 0 5 1.5v1H2.506a.58.58 0 0 0-.01 0H1.5a.5.5 0 0 0 0 1h.538l.853 10.66A2 2 0 0 0 4.885 16h6.23a2 2 0 0 0 1.994-1.84l.853-10.66h.538a.5.5 0 0 0 0-1h-.995a.59.59 0 0 0-.01 0H11Zm1.958 1-.846 10.58a1 1 0 0 1-.997.92h-6.23a1 1 0 0 1-.997-.92L3.042 3.5h9.916Zm-7.487 1a.5.5 0 0 1 .528.47l.5 8.5a.5.5 0 0 1-.998.06L5 5.03a.5.5 0 0 1 .47-.53Zm5.058 0a.5.5 0 0 1 .47.53l-.5 8.5a.5.5 0 1 1-.998-.06l.5-8.5a.5.5 0 0 1 .528-.47ZM8 4.5a.5.5 0 0 1 .5.5v8.5a.5.5 0 0 1-1 0V5a.5.5 0 0 1 .5-.5Z"})})}}}]);